{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","system/main.js","public/js/mithril.animate.js","system/miso.permissions.js","mvc/layout.js","mvc/user.js","mvc/home.js","mvc/doc.js","mvc/hello.js","mvc/login.js","mvc/todo.js","modules/miso.util.client.js","system/api/authentication/api.client.js","public/js/mithril.smoothscroll.js","public/miso.documentation.js","system/api/session/api.client.js","system/api/flatfiledb/api.client.js","node_modules/mithril/mithril.js","node_modules/mithril.sugartags/mithril.sugartags.js","node_modules/mithril.bindings/dist/mithril.bindings.js","node_modules/validator.modelbinder/index.js","node_modules/validator/validator.js"],"names":["m","require","sugartags","bindings","animate","permissions","layout","restrict","route","permissionObj","user","home","doc","hello","login","todo","window","mode","document","getElementById","/users/new","/","index","/doc/:doc_id","edit","/docs","/hello/:hello_id","/login","/todos","/user/:user_id","/users","misoGlobal","renderHeader","obj","render","headerContent","mithrilAnimate","prefixes","transitionProps","transformProps","defaultDuration","err","msg","console","error","cap","str","charAt","toUpperCase","substr","div","createElement","vp","prop","pf","style","i","length","toLowerCase","supportsTransitions","b","body","documentElement","s","p","getTimeinMS","tmp","result","indexOf","split","Number","Math","round","setStyleProps","props","hasOwnProperty","setTransitionProps","args","tmp2","found","TransitionTimingFunction","TransitionDuration","TransitionProperty","normaliseTransformProps","normal","value","aniName","JSON","stringify","join","animations","canTrans","animateProperties","el","cb","time","$","fn","setTimeout","trigger","name","options","ani","e","target","addAnimation","duration","addBinding","bindAnimation","this","addKFAnimation","arg","init","kf","aniId","hasAni","id","setAttribute","textContent","head","appendChild","isInitialised","animateImmediately","animateKF","undefined","endAni","removeEventListener","requestAnimationFrame","addEventListener","triggerKF","oldConfig","config","isInit","apply","arguments","basicBindings","degBindings","isNaN","skew","display","unwrap","onclick","onmouseover","onmouseout","module","exports","define","amd","miso","hasRole","userRoles","roles","each","userRole","role","app","actionName","pass","deny","allow","api","authentication","ctrl","DIV","class","A","alt","href","IMG","src","NAV","UL","LI","authenticationEnabled","isLoggedIn","userName","log","logout","then","preventDefault","view","trust","HTML","HEAD","LINK","rel","SCRIPT","BODY","HEADER","SECTION","misoAttachmentNode","content","reload","validate","self","editView","H2","header","LABEL","INPUT","isValid","showErrors","email","password","type","BUTTON","save","remove","controller","vm","userList","users","findUsers","data","list","Object","keys","map","key","models","c","u","saveUser","model","_id","bind","isRequired","isEmail","params","userId","getParam","query","confirm","smoothScroll","intro","text","demoImgSrc","replay","tmpSrc","o","SPAN","P","PRE","CODE","docs","niceName","lastIndexOf","data-manual","doc_id","H1","ARTICLE","who","session","url","username","FORM","onsubmit","placeholder","authenticate","db","done","find","background","initialValue","addTodo","input","newTodo","push","res","archive","response","left","count","STYLE","isServer","prototype","toString","call","readyBinder","ready","def","param","routeInfo","path","req","getModelData","requestObj","method","rootNode","className","myDeferred","deferred","request","resolve","redraw","promise","root","navigator","test","userAgent","easeInOutSine","t","d","cos","PI","element","isInitialized","startTime","startPos","scrollTop","endPos","exec","getBoundingClientRect","top","hash","maxScroll","scrollHeight","innerHeight","scrollEndValue","scrollFunc","timestamp","elapsed","progress","history","pushState","location","Api.md","Contributing.md","Creating-a-todo-app-part-2-persistence.md","Creating-a-todo-app.md","Getting-started.md","Goals.md","Home.md","How-miso-works.md","Patterns.md","get","set","initialize","$document","$location","$cancelAnimationFrame","cancelAnimationFrame","clearTimeout","$requestAnimationFrame","match","slice","hasAttrs","OBJECT","attrs","classAttrName","cell","tag","classes","STRING","Error","parser","pair","attrParser","children","ARRAY","attrName","build","parentElement","parentTag","parentCache","parentIndex","cached","shouldReattach","editable","namespace","configs","subtree","cachedType","dataType","nodes","offset","end","clear","constructor","len","concat","intact","subArrayCount","DELETION","INSERTION","MOVE","existing","unkeyed","shouldMaintainIdentities","action","filter","x","keysDiffer","cachedCell","dataCell","from","childNodes","actions","change","changes","sort","sortChanges","newCached","Array","splice","dummy","insertBefore","child","cacheCount","item","$trusted","node","parentNode","dataAttrKeys","hasKeys","configContext","onunload","FUNCTION","isNew","xmlns","is","createElementNS","setAttributes","contenteditable","context","callback","injectHTML","createTextNode","nodeName","voidElements","valueOf","activeElement","innerHTML","nodeType","nodeValue","a","dataAttrs","cachedAttrs","dataAttr","cachedAttr","autoredraw","rule","setAttributeNS","message","removeChild","unload","nextSibling","isElement","insertAdjacentHTML","object","event","strategy","startComputation","endFirstComputation","getCellCacheKey","nodeCache","gettersetter","store","toJSON","forceRedraw","roots","controllers","modules","blank","computePostRedrawHook","lastRedrawId","lastRedrawCallTime","Date","normalizeRoute","modes","routeByValue","router","routeParams","queryStart","parseQueryString","matcher","RegExp","replace","values","decodeURIComponent","routeUnobtrusive","ctrlKey","metaKey","which","returnValue","currentTarget","search","setScroll","scrollTo","buildQueryString","prefix","valueType","encodeURIComponent","pairs","reset","cacheKey","cellCache","propify","reject","Deferred","successCallback","failureCallback","finish","state","REJECTED","next","RESOLVED","promiseValue","thennable","notThennableCallback","onerror","fire","REJECTING","RESOLVING","TypeError","identity","ajax","xhr","XMLHttpRequest","open","onreadystatechange","readyState","status","onload","serialize","setRequestHeader","deserialize","parse","maybeXhr","FormData","send","callbackKey","getTime","random","script","resp","responseText","bindData","xhrOptions","querystring","parameterizeUrl","tokens","html","documentNode","replaceChild","forceRecreation","isDocumentRoot","String","topModule","FRAME_BUDGET","isPrevented","currentModule","force","pendingRequests","endComputation","max","withAttr","withAttrCallback","getAttribute","currentRoute","pathname","redirect","defaultRoute","source","listener","oldRoute","queryIndex","currentPath","shouldReplaceHistoryEntry","title","myRedir","sync","synchronizer","pos","resolved","results","outstanding","isJSONP","extract","unwrapSuccess","unwrapError","deps","mock","factory","mithrilSugartags","scope","sugarTags","l1","l2","getClassList","makeSugarTag","tagList","lowerTagCache","lowerTag","lower","mithrilBindings","prevValue","subs","delay","notify","func","tmpPrev","val","subscribe","removeable","onchange","checked","tVal","isFunc","vals","events","createBinding","eve","argList","validator","vObj","hasInvalidField","isNotEmpty","getValue","validations","validation","definition","merge","defaults","version","creditCard","isbn10Maybe","isbn13Maybe","ipv4Maybe","ipv6","uuid","3","4","5","all","alpha","alphanumeric","numeric","int","float","hexadecimal","hexcolor","ascii","multibyte","fullWidth","halfWidth","surrogatePair","base64","phones","zh-CN","en-ZA","en-AU","extend","toDate","date","toFloat","parseFloat","toInt","radix","parseInt","toBoolean","strict","equals","comparison","contains","elem","matches","pattern","modifiers","default_url_options","protocols","require_tld","require_protocol","allow_underscores","allow_trailing_dot","isURL","protocol","auth","host","hostname","port","port_str","shift","isIP","isFQDN","host_whitelist","host_blacklist","parts","default_fqdn_options","substring","tld","pop","part","isAlpha","isAlphanumeric","isNumeric","isHexadecimal","isHexColor","isLowercase","isUppercase","isInt","isFloat","isDivisibleBy","num","isNull","isLength","min","surrogatePairs","isByteLength","isUUID","isDate","isAfter","original","isBefore","isIn","array","isCreditCard","sanitized","digit","tmpNum","shouldDouble","sum","isISBN","checksum","factor","isMobilePhone","locale","isJSON","isMultibyte","isAscii","isFullWidth","isHalfWidth","isVariableWidth","isSurrogatePair","isBase64","isMongoId","ltrim","chars","rtrim","trim","escape","stripLow","keep_new_lines","blacklist","whitelist","default_normalize_email_options","lowercase","normalizeEmail"],"mappings":"AAAA;AWEA,GAAIA,GAAIC,QAAQ,UAEhB+I,QAAOC,SAENiI,SAAU,WACT,OAAO,GAeR1H,KAAM,SAASvH,EAAKgE,GACnB,MAA2C,mBAAxCsH,OAAO4D,UAAUC,SAASC,KAAKpP,GAC1BA,EAAIwL,IAAIxH,GACQ,gBAAPhE,GACTsL,OAAOC,KAAKvL,GAAKwL,IAAI,SAASC,GACpC,MAAOzH,GAAGhE,EAAIyL,GAAMA,KAGdzH,EAAGhE,IAIZqP,YAAa,WACZ,GAAInR,KACJ,QACC8N,KAAM,SAASnI,GACd3F,EAASwQ,KAAK7K,IAEfyL,MAAO,WACN,IAAI,GAAI/N,GAAI,EAAGA,EAAIrD,EAASsD,OAAQD,GAAK,EACxCrD,EAASqD,QAOb8K,SAAU,SAASZ,EAAKU,EAAQoD,GAC/B,MAAqC,mBAAvBxR,GAAEQ,MAAMiR,MAAM/D,GAAsB1N,EAAEQ,MAAMiR,MAAM/D,GAAM8D,GAIvEE,UAAW,WASV,OACCC,KAAM3R,EAAEQ,QACR4N,OAAQwD,IAAIxD,OACZG,MAAOqD,IAAIrD,MACXqB,QAASA;;AJnEZ,GAAI5P,GAAIC,QAAQ,WACfmJ,KAAOnJ,QAAQ,kCACfC,UAAYD,QAAQ,qBAAqBD,GAEzCoP,KAAOnP,QAAQ,mCAEZqB,MAAQ0H,OAAOC,QAAQ3H,OAC1BqM,QAECyB,KAAM,SAAS/B,GACdxG,KAAKuI,KAAO/B,EAAK+B,KACjBvI,KAAKO,GAAKiG,EAAKjG,GACfP,KAAKwI,SAAW,SAASjJ,GACxB,MAAOA,GAAKnD,OAAO,EAAEmD,EAAKkJ,YAAY,QAAQjL,MAAM,KAAKoB,KAAK,QAIjEuH,WAAY,WAIX,MAHAnG,MAAKkH,MAAQ,GAAIzM,OAAMqM,OAAOyB,MAC7BA,KAAMA,SAEAvI,MAERuE,KAAM,SAASlB,MACd,GAAI6D,OAAQ7D,KAAK6D,KACjB,MAAK7N,UACJ,MAAOiK,MAAKC,QAAS,WACpBD,IAAI,8CACJQ,IACCvB,KAAKI,KAAKuE,MAAMqB,KAAM,SAASxO,EAAK8M,GAEnC,MAAW,YAARA,EACK9C,GACNP,GAAGE,KAAM,QAAUmD,EAAKvF,OAAQnI,EAAEQ,OAAQuN,MAAMsB,SAAS3B,KAF3D,WAOFvD,IAAI,aACJQ,IACCC,GAAGP,GAAGE,KAAM,SAAUpC,OAAQnI,EAAEQ,OAAQ,kBACxCoK,GAAGP,GAAGE,KAAM,SAAUpC,OAAQnI,EAAEQ,OAAQ,oBAGzCkL,QAAQjB,IAAK,2BAA4B8E,cAAe,SAMxD/N,KAAOwH,OAAOC,QAAQzH,MACzBwL,WAAY,SAASoB,GACpB,GAAIoB,GAASpG,KAAKkF,SAAS,SAAUF,EAKrC,OAJAvH,MAAKkH,MAAQ,GAAIzM,OAAMqM,OAAOyB,MAC7BA,KAAMA,OACNhI,GAAIoI,IAEE3I,MAERuE,KAAM,SAASlB,MACd,GAAI6D,OAAQ7D,KAAK6D,KACjB,MAAK7N,UACJ,MAAOiK,MAAKC,QAAS,WACpBoB,MAAMjB,KAAM,4BAA6BkB,IAAK,eAC9CgE,GAAG1B,MAAMsB,SAAStB,MAAM3G,KACxBsI,QAAQ1P,EAAEqL,MAAM0C,MAAMqB,KAAKrB,MAAM3G,MAEjCsE,QAAQjB,IAAK,2BAA4B8E,cAAe,KACxD7D,OAAO;;ACpEX,GAAI1L,GAAIC,QAAQ,WACfmJ,KAAOnJ,QAAQ,kCACfC,UAAYD,QAAQ,qBAAqBD,GAEtCwB,KAAOwH,OAAOC,QAAQzH,MACzBmM,QACC9M,MAAO,SAASwM,GACfxG,KAAK8I,IAAM3P,EAAEqD,KAAKgK,EAAKsC,OAGzB3C,WAAY,SAASoB,GACpB,GAAIuB,GAAMvG,KAAKkF,SAAS,WAAYF,EAEpC,OADAvH,MAAKkH,MAAQ,GAAIvM,MAAKmM,OAAO9M,OAAO8O,IAAKA,IAClC9I,MAERuE,KAAM,SAASlB,MACd,KAAKhK,UACJ,MAAOiK,KAAI,SAAWD,KAAK6D,MAAM4B;;AFjBpC,GAAI3P,GAAIC,QAAQ,WACfC,UAAYD,QAAQ,qBAAqBD,GACzCyO,aAAexO,QAAQ,wCAGpBiM,KAAOlD,OAAOC,QAAQ3H,OACzBqM,QACCe,MAAO,WACN7H,KAAK8H,KAAO3O,EAAEgE,EAAE,0BAChB6C,KAAKP,IAAMtG,EAAEgE,EAAE,GACf6C,KAAK+H,WAAa5O,EAAEgE,EAAE,sBAGxBgJ,WAAY,WACX,GAAI9C,GAAOrD,IAWX,OATAqD,GAAK2E,OAAS,WACb,GAAIC,GAAS5E,EAAK6D,MAAMa,YACxB1E,GAAK6D,MAAMa,WAAW,IACtB1I,WAAW,WACVgE,EAAK6D,MAAMa,WAAWE,IACrB,IAGH5E,EAAK6D,MAAQ,GAAI7B,MAAKyB,OAAOe,MACtB7H,MAGRuE,KAAM,SAASlB,MACd,GAAI6E,GAAI7E,KAAK6D,KACb,MAAK7N,UACJ,MAAOiK,MACNA,KAAKC,QAAS,UACbD,KAAKC,QAAS,aAAc2E,EAAEJ,QAC9BxE,KAAKC,QAAS,YACbI,KAAKpD,GAAI,UAAWqD,IAAKsE,EAAEH,eAC3BI,MAAM5E,QAAS,eAAgBvB,QAASqB,KAAK2E,QAAS,YAEvDxE,GAAGD,QAAS,gBAAiBjC,OAAQsG,aAAavE,MAAOK,KAAM,iBAAkB,sBAGlFJ,KAAKC,QAAS,OACbgC,GAAG/B,GAAGjE,KAAM,OAAQgE,QAAS,WAAW,kBACxC6E,EAAE,6JACDtE,IAAIP,QAAS,YACZQ,GAAG,mHACHA,GAAG,sGACHA,GAAG,qEACHA,GAAG,kEACHA,IAAI,8EAA+EP,GAAGE,KAAM,kDAAmD/D,OAAQ,UAAW,OAClKoE,GAAG,0EACHA,GAAG,kCAGLqE,EAAE,2IACF9E,KAAKC,QAAS,eACbD,KAAKC,QAAS,mBACbC,GAAGD,QAAS,SAAUG,KAAM,mCAAoC/D,OAAQ,UACxEwI,MAAM5E,QAAS,gBACfC,GAAGD,QAAS,SAAUG,KAAM,wBAAyB/D,OAAQ,UAAUwI,MAAM5E,QAAS,gBACtFC,GAAGD,QAAS,SAAUG,KAAM,yBAA0B/D,OAAQ,UAAUwI,MAAM5E,QAAS,mBACvFC,GAAGD,QAAS,SAAUG,KAAM,qBAAsB/D,OAAQ,UAAUwI,MAAM5E,QAAS,sBAKtFD,KAAKC,QAAS,OACbgC,IAAIhF,GAAI,gBAAiBiD,GAAGjE,KAAM,eAAgBgE,QAAS,WAAW,iBACtE6E,EAAE,6BACFC,KAAK9E,QAAS,eACb+E,KAAK,6BAIPhF,KAAKC,QAAS,OACbgC,GAAG/B,GAAGjE,KAAM,iBAAkBgE,QAAS,WAAW,oBAClD6E,EAAE,oDACFC,KAAK9E,QAAS,eACb+E,KAAK,uCAENF,EAAE,2FAGH9E,KAAKC,QAAS,OACbgC,GAAG/B,GAAGjE,KAAM,WAAYgE,QAAS,WAAW,aAC5CO,IACCC,GAAGP,GAAIE,KAAM,SAAUpC,OAAQnI,EAAEQ,OAAQ,mCACzCoK,GAAGP,GAAIE,KAAM,SAAUpC,OAAQnI,EAAEQ,OAAQ,uCAE1C4L,IAAIhG,KAAM,gBAAiBgE,QAAS,WAAY,iBAChDC,GAAGE,KAAK,SAAU;;AFlFvB,GAAIvK,GAAIC,QAAQ,WACfC,UAAYD,QAAQ,qBAAqBD,GACzCiK,eAAiBhK,QAAQ,8CAA8CD,EAGxEgJ,QAAOC,QAAQ9G,cAAgB,SAAS+H,MACvC,KAAKhK,UACJ,MAAOiK,MAAKC,QAAS,UACpBD,KAAKC,QAAS,QACbC,GAAGC,IAAK,OAAQC,KAAK,IAAKpC,OAAQnI,EAAEQ,QACnCgK,KAAKC,IAAK,0BAGZC,KAAKN,QAAS,QAASO,IACtBC,GAAGP,GAAGE,KAAM,yBAA0B/D,OAAQ,UAAW,qBAE1DkE,KAAKN,QAAS,SAAUO,IACvBC,GAAGP,GAAGE,KAAM,kCAAmC/D,OAAQ,UAAW,WAIjE0D,KAAKnI,WAAW8I,sBAEfD,GADAV,KAAKnI,WAAW+I,YAAcZ,KAAKnI,WAAWgJ,SAC3CV,GAAGxB,QAAS,SAAStC,GAQtB,MAPA5D,SAAQqI,IAAI,+BACZf,eAAegB,WAAWC,KAAK,WAC9BvI,QAAQqI,IAAI,0BACZhL,EAAEQ,MAAM,YAGT+F,EAAE4E,kBACK,GACLZ,KAAM,IAAKnD,GAAI,gBAClB,UAAY8C,KAAKnI,WAAWgJ,UAE1BV,GAAGE,KAAM,UAAW,UAExB,SASLvB,OAAOC,QAAQmC,KAAO,SAASlB,MAC9B,KAAKhK,UACJ,OACCF,EAAEqL,MAAM,mBACRC,MACCC,MACCC,MAAMjB,KAAM,iBAAkBkB,IAAI,eAElCC,OAAO,qBAAqBxB,KAAKnI,WAAYwD,KAAKC,UAAU0E,KAAKnI,gBAAiB,OAEnF4J,MAAMvB,QAAS,iBACdwB,QAAQxE,GAAI,kBAAmB8C,KAAK/H,cAAc+H,OAClD2B,SAASzE,GAAI8C,KAAK4B,oBAAqB5B,KAAK6B,SAC5CF,SAASzE,GAAI,WACZ+C,KAAKC,QAAS,aAEfyB,SAASzE,GAAI,WACZ+C,KAAKC,QAAS,SAAUpK,EAAEqL,MAAM,kCAGjCK,QAAQjB,IAAK,aACZP,KAAK8B,OAAQN,QAAQjB,IAAK,eAAgB;;AK1EhD,GAAIzK,GAAIC,QAAQ,WACfmJ,KAAOnJ,QAAQ,kCACfC,UAAYD,QAAQ,qBAAqBD,GACzCiK,eAAiBhK,QAAQ,8CAA8CD,GACvE4P,QAAU3P,QAAQ,uCAAuCD,GAEtDsB,MAAQ0H,OAAOC,QAAQ3H,OAC1BqM,QACC7M,MAAO,SAASuM,GACfxG,KAAKgJ,IAAMxC,EAAKwC,IAChBhJ,KAAKiE,WAAa9K,EAAEqD,MAAK,GACzBwD,KAAKiJ,SAAW9P,EAAEqD,KAAKgK,EAAKyC,UAAU,IACtCjJ,KAAK8F,SAAW3M,EAAEqD,KAAK,MAGzB2J,WAAY,SAASoB,GACpB,GAAIlE,GAAOrD,KACVgJ,EAAMzG,KAAKkF,SAAS,MAAOF,GAC3BnD,EAAS7B,KAAKkF,SAAS,SAAUF,EA4ClC,OA1CAlE,GAAK6D,MAAQ,GAAIzM,OAAMqM,OAAO7M,OAAO+O,IAAKA,IAI1C3F,EAAKpJ,MAAQ,SAASyF,GAuBrB,MAtBAA,GAAE4E,iBAEFlB,eAAenJ,OAAO8L,KAAM,oBAAqBmB,MAAO7D,EAAK6D,QAAQ7C,KAAK,SAASmC,GACrD,GAA1BA,EAAKlJ,OAAO2G,aAEd/I,WAAW+I,YAAa,EACxB/I,WAAWgJ,SAAWsC,EAAKlJ,OAAO4G,SAClCb,EAAK6D,MAAMjD,YAAW,GAEtBnI,QAAQqI,IAAI,WAAajJ,WAAWgJ,SAAW,2BAG/ChJ,WAAWC,eAGVhC,EAAEQ,MADAqP,EACMA,EAGA,SAIJ,GAGL5E,GACFhB,eAAegB,WAAWC,KAAK,WAC9BvI,QAAQqI,IAAI,0BAEZd,EAAK6D,MAAMjD,YAAW,GAItB/I,WAAWC,iBAINkI,GAERkB,KAAM,SAASlB,MACd,KAAKhK,UACJ,MAAOiK,MAAKC,QAAS,SACpBF,KAAK6D,MAAMjD,aAAc,yBACzBX,IAAID,KAAK6D,MAAM8B,IAAK,0BAA4B3F,KAAK6D,MAAM8B,IAAK,iBAChEE,MAAOC,SAAU9F,KAAKpJ,QACrByL,OAAQK,KAAM,OAAQvH,MAAO6E,KAAK6D,MAAM+B,SAAUG,YAAa,aAC/D1D,OAAQK,KAAM,WAAYvH,MAAO6E,KAAK6D,MAAMpB,WAC5CE,QAASD,KAAM,UAAW,cAK9BsD,cAAc;;AC9Ef,GAAIlQ,GAAIC,QAAQ,WACfC,UAAYD,QAAQ,qBAAqBD,GACzCmQ,GAAKlQ,QAAQ,0CAA0CD,GAEpDkM,KAAOlD,OAAOC,QAAQ3H,OACzBqM,QACC5M,KAAM,SAASsM,GACdxG,KAAK8H,KAAOtB,EAAKsB,KACjB9H,KAAKuJ,KAAOpQ,EAAEqD,KAAkB,SAAbgK,EAAK+C,MAAiB,EAAO/C,EAAK+C,MACrDvJ,KAAKmH,IAAMX,EAAKW,MAGlBhB,WAAY,WACX,GAAI9C,GAAOrD,IAyDX,OAvDAqD,GAAKoD,QAEL6C,GAAGE,MAAMzD,KAAM,oBAAqB0D,YAAY,EAAMC,kBAAmBrF,KAAK,SAASmC,GACtFnD,EAAKoD,KAAOC,OAAOC,KAAKH,EAAKlJ,QAAQsJ,IAAI,SAASC,GACjD,MAAO,IAAIxB,MAAKyB,OAAO5M,KAAKsM,EAAKlJ,OAAOuJ,QAI1CxD,EAAKsG,QAAU,SAASjK,GACvB,GAAIlB,GAAQ6E,EAAK+C,GAAGwD,OACpB,IAAGpL,EAAO,CACT,GAAIqL,GAAU,GAAIxE,MAAKyB,OAAO5M,MAC7B4N,KAAMzE,EAAK+C,GAAGwD,QACdL,MAAM,GAEPlG,GAAKoD,KAAKqD,KAAKD,GACfxG,EAAK+C,GAAGwD,MAAM,IACdN,GAAGrD,MAAOF,KAAM,kBAAmBmB,MAAO2C,IAAYxF,KAAK,SAAS0F,GACnEF,EAAQ1C,IAAM4C,EAAIzM,SAIpB,MADAoC,GAAE4E,kBACK,GAGRjB,EAAK2G,QAAU,WACd,GAAIvD,KACJpD,GAAKoD,KAAKG,IAAI,SAAS1M,GAClBA,EAAKqP,OAGRD,GAAGpD,QAASH,KAAM,kBAAmBoB,IAAKjN,EAAKiN,MAAO9C,KAAK,SAAS4F,GACnEnO,QAAQqI,IAAI8F,EAAS3M,UAHtBmJ,EAAKqD,KAAK5P,KAOZmJ,EAAKoD,KAAOA,GAGbpD,EAAK+C,IACJ8D,KAAM,WACL,GAAIC,GAAQ,CAIZ,OAHA9G,GAAKoD,KAAKG,IAAI,SAAS1M,GACtBiQ,GAASjQ,EAAKqP,OAAS,EAAI,IAErBY,GAERZ,KAAM,SAASrP,GACd,MAAO,YACNA,EAAKqP,MAAMrP,EAAKqP,UAGlBK,MAAOzQ,EAAEqD,KAAK,KAGR6G,GAERkB,KAAM,SAASlB,MACd,KAAKhK,UACJ,MAAOiK,MAAKC,QAAS,UACpB6G,MAAM,yCACNxB,GAAG,WAAavF,KAAK+C,GAAG8D,OAAS,OAAS7G,KAAKoD,KAAK7J,OAAS,cAC7DoJ,QAAShE,QAASqB,KAAK2G,SAAW,WAClClG,IACCT,KAAKoD,KAAKG,IAAI,SAAS1M,GACtB,MAAO6J,KAAKR,QAAOrJ,EAAKqP,OAAQ,OAAQ,GAAIvH,QAASqB,KAAK+C,GAAGmD,KAAKrP,IAASA,EAAK4N,UAGlFoB,MAAOC,SAAU9F,KAAKsG,UACrBjE,OAAQK,KAAM,OAAQvH,MAAO6E,KAAK+C,GAAGwD,MAAOR,YAAa,aACzDpD,QAASD,KAAM,UAAW;;ALjF/B,GAAIxD,MAAOnJ,QAAQ,kCAClBgM,SAAWhM,QAAQ,yBACnBD,EAAIC,QAAQ,WACZC,UAAYD,QAAQ,qBAAqBD,GACzCG,SAAWF,QAAQ,oBAAoBD,GACvCgK,IAAM/J,QAAQ,8CAA8CD,GAC5DkM,KAAOlD,OAAOC,QAGXkD,SAAW,SAASjC,MACvB,KAAKhK,UACJ,MAAOiK,MAAMC,QAAO,OACnBgC,IAAIhC,QAAS,cAAeF,KAAKmC,QACjCnC,KAAKxJ,MACJyJ,KACCmC,MAAM,QAASC,OAAOlH,MAAO6E,KAAKxJ,KAAK0F,OACvC+D,KAAKC,SAAuC,GAA7BF,KAAKxJ,KAAK8L,QAAQ,SAAoBtC,KAAKuC,WAAqB,UAAT,SAAsB,cAC9D,GAA7BvC,KAAKxJ,KAAK8L,QAAQ,SAAoBtC,KAAKuC,WAAgBvC,KAAKxJ,KAAK8L,QAAQ,QAAQ/G,KAAK,MAAnC,OAGzD0E,KACCmC,MAAM,SAAUC,OAAOlH,MAAO6E,KAAKxJ,KAAKgM,QACxCvC,KAAKC,SAAwC,GAA9BF,KAAKxJ,KAAK8L,QAAQ,UAAqBtC,KAAKuC,WAAqB,UAAT,SAAsB,cAC9D,GAA9BvC,KAAKxJ,KAAK8L,QAAQ,UAAqBtC,KAAKuC,WAAgBvC,KAAKxJ,KAAK8L,QAAQ,SAAS/G,KAAK,MAApC,OAG1D0E,KACCmC,MAAM,YAAaC,OAAOlH,MAAO6E,KAAKxJ,KAAKiM,SAAUC,KAAM,aAC3DzC,KAAKC,SAA2C,GAAjCF,KAAKxJ,KAAK8L,QAAQ,aAAwBtC,KAAKuC,WAAqB,UAAT,SAAsB,cAC9D,GAAjCvC,KAAKxJ,KAAK8L,QAAQ,aAAwBtC,KAAKuC,WAAgBvC,KAAKxJ,KAAK8L,QAAQ,YAAY/G,KAAK,MAAvC,OAG7D0E,KAAKC,QAAS,aACbyC,QAAQhE,QAASqB,KAAK4C,KAAM1C,QAAO,YAAa,aAChDyC,QAAQhE,QAASqB,KAAK6C,OAAQ3C,QAAO,YAAa,kBAEjDD,IAAI,oBAOVnB,QAAOC,QAAQ3H,OACd0L,WAAY,WACX,GAAI9C,GAAOrD,IA0BX,OAxBAqD,GAAK+C,IACJC,SAAU,SAASC,GAClBtG,KAAKsG,MAAQnN,EAAEgE,EAAEmJ,KAInBnD,IAAIoD,WAAWR,KAAM,mBAAmB1B,KAAK,SAASmC,GACrD,GAAGA,EAAKzK,MAEP,WADAD,SAAQqI,IAAI,SAAWqC,EAAKzK,MAG7B,IAAGyK,EAAKlJ,OAAQ,CACf,GAAImJ,GAAOC,OAAOC,KAAKH,EAAKlJ,QAAQsJ,IAAI,SAASC,GAChD,MAAO,IAAIxB,MAAK1K,KAAKmM,OAAOjN,KAAK2M,EAAKlJ,OAAOuJ,KAG9CxD,GAAKiD,MAAQ,GAAIjD,GAAK+C,GAAGC,SAASI,OAElCpD,GAAKiD,MAAQ,GAAIjD,GAAK+C,GAAGC,cAExB,WACFvK,QAAQqI,IAAI,QAAS1C,aAGfzB,MAERuE,KAAM,SAASlB,MACd,GAAI0D,GAAI1D,KACP2D,EAAID,EAAET,KAEP,MAAKjN,UACJ,MAAOiK,MAAMC,QAAO,OACnBO,IACCkD,EAAEV,QAAQM,IAAI,SAAS/M,GACtB,MAAOkK,IAAGP,GAAIE,KAAM,SAAW7J,EAAK0G,KAAMe,OAAQnI,EAAEQ,OAAQE,EAAK0F,OAAS,MAAQ1F,EAAKgM,cAGzFrC,GAAGD,QAAQ,uBAAwBG,KAAK,aAAcpC,OAAQnI,EAAEQ,OAAQ,oBAQ5EwI,OAAOC,QAAPD,QACCgE,WAAY,WACX,GAAI9C,GAAOrD,IAiBX,OAhBAqD,GAAKxJ,KAAO,GAAIwL,MAAK1K,KAAKmM,OAAOjN,MAAM0F,KAAM,GAAIsG,MAAO,KACxDxC,EAAKmC,OAAS,WACdnC,EAAKuC,YAAa,EAElBvC,EAAK4C,KAAO,WACR5C,EAAKxJ,KAAK8L,aAAc,GAC1BtC,EAAKuC,YAAa,EAClB9J,QAAQqI,IAAI,sBAEZhB,IAAI8D,UAAWlB,KAAM,iBAAkBmB,MAAO7D,EAAKxJ,OAASwK,KAAK,WAChEvI,QAAQqI,IAAI,aAAc1C,WAC1BtI,EAAEQ,MAAM,aAKJ0J,GAERkB,KAAMe,UAKPnD,OAAOC,QAAQzH,MACdmM,QACCjN,KAAM,SAAS2M,GAqBd,MApBAxG,MAAKT,KAAOpG,EAAEgE,EAAEqJ,EAAKjH,MAAM,IAC3BS,KAAK6F,MAAQ1M,EAAEgE,EAAEqJ,EAAKX,OAAO,IAE7B7F,KAAK8F,SAAW3M,EAAEgE,EAAEqJ,EAAKV,UAAU,IACnC9F,KAAKO,GAAKpH,EAAEgE,EAAEqJ,EAAKW,KAAK,IAGxBnH,KAAK2F,QAAUP,SAASgC,KAAKpH,MAC5BT,MACC8H,WAAY,yBAEbvB,UACCuB,WAAY,6BAEbxB,OACCwB,WAAY,kCACZC,QAAS,mCAIJtH,OAGTmG,WAAY,SAASoB,GACpB,GAAIlE,GAAOrD,KACVwH,EAASjF,KAAKkF,SAAS,UAAWF,EAqCnC,OAnCAlE,GAAKmC,OAAS,aAAegC,EAG7BrE,IAAIoD,WAAWR,KAAM,iBAAkB2B,OAAQP,IAAKK,KAAUnD,KAAK,SAASmC,GAC3E,GAAI3M,GAAO2M,EAAKlJ,MACbzD,IAAQA,EAAK+C,OAAS,EACxByG,EAAKxJ,KAAO,GAAIwL,MAAK1K,KAAKmM,OAAOjN,KAAKA,EAAK,IAE3CiC,QAAQqI,IAAI,iBAAkBqD,IAE7B,WACF1L,QAAQqI,IAAI,QAAS1C,aAGtB4B,EAAK4C,KAAO,WACR5C,EAAKxJ,KAAK8L,aAAc,GAC1BtC,EAAKuC,YAAa,EAClB9J,QAAQqI,IAAI,sBAEZhB,IAAI8D,UAAWlB,KAAM,iBAAkBmB,MAAO7D,EAAKxJ,OAASwK,KAAK,WAChEvI,QAAQqI,IAAI,aAAc1C,WAC1BtI,EAAEQ,MAAM,aAKX0J,EAAK6C,OAAS,WACVyB,QAAQ,iBACVxE,IAAI+C,QAASH,KAAM,iBAAkBoB,IAAKK,IAAUnD,KAAK,SAASmC,GACjE1K,QAAQqI,IAAIqC,EAAKlJ,QACjBnE,EAAEQ,MAAM,aAKJ0J,GAERkB,KAAMe;;Cc1LN,WACD,GAAIgZ,GAAkB,SAASnlB,GAC9BA,EAAEG,SAAWH,EAAEG,aAGfH,EAAEgE,EAAI,SAASqB,GACd,GAEC+f,GAFGlZ,EAAOrF,KACVwe,KAEAC,GAAQ,EAERC,EAAS,SAAUlgB,EAAO+f,GACzB,GAAI5hB,EACJ,KAAKA,EAAI,EAAGA,EAAI6hB,EAAK5hB,OAAQD,GAAK,EACjC6hB,EAAK7hB,GAAGgiB,KAAKnd,MAAMgd,EAAK7hB,GAAGgX,SAAUnV,EAAO+f,KAG9C/hB,EAAO,WACN,GAAIiF,UAAU7E,SACb4B,EAAQiD,UAAU,GACd8c,IAAc/f,GAAO,CACxB,GAAIogB,GAAUL,CACdA,GAAY/f,EACZkgB,EAAOlgB,EAAOogB,GAGhB,MAAOpgB,GAkCT,OA9BAhC,GAAKsN,KAAO,SAAS+U,GACjBrgB,EAAMsL,MAAgC,mBAAjBtL,GAAM5B,QAC7B4B,EAAMsL,KAAK+U,GAEZriB,EAAKgC,IAINhC,EAAKsiB,UAAY,SAAUH,EAAMhL,GAEhC,MADA6K,GAAK1U,MAAO6U,KAAMA,EAAMhL,QAASA,GAAWtO,IACrC7I,GAIRA,EAAKiiB,MAAQ,SAASjgB,GAErB,MADAigB,KAAUjgB,EACHhC,GAMRA,EAAKsiB,UAAU,WAKd,MAJIL,KACHtlB,EAAEoc,mBACFpc,EAAE0iB,kBAEIrf,IAGDA,GAORrD,EAAEuG,EAAI,SAAS0M,EAAS2C,EAAOU,GAC9B,IAAK,GAAIlQ,KAAQwP,GACZ5V,EAAEG,SAASiG,KACdpG,EAAEG,SAASiG,GAAMof,KAAKnd,MAAMuN,GAAQA,EAAMxP,KACvCpG,EAAEG,SAASiG,GAAMwf,kBACZhQ,GAAMxP,GAIhB,OAAOpG,GAAEiT,EAAS2C,EAAOU,IAM1BtW,EAAE2G,WAAa,SAASP,EAAMof,EAAMI,GACnC5lB,EAAEG,SAASiG,IACVof,KAAMA,EACNI,WAAYA,IAKd5lB,EAAE4I,OAAS,SAASvF,GACnB,MAAuB,kBAARA,GAAqBA,IAAQA,GAI7CrD,EAAE2G,WAAW,QAAS,SAAStD,GACX,kBAARA,IACVwD,KAAKxB,MAAQhC,IACbwD,KAAKgf,SAAW7lB,EAAE4iB,SAAS,QAASvf,IAEpCwD,KAAKxB,MAAQhC,IAKfrD,EAAE2G,WAAW,UAAW,SAAStD,GACb,kBAARA,IACVwD,KAAKif,QAAUziB,IACfwD,KAAKgf,SAAW7lB,EAAE4iB,SAAS,UAAWvf,IAEtCwD,KAAKif,QAAUziB,IAKjBrD,EAAE2G,WAAW,OAAQ,SAAStD,GAC7BwD,KAAKtD,OACJoF,QAAS3I,EAAE4I,OAAOvF,GAAO,OAAS,MAEjC,GAGHrD,EAAE2G,WAAW,SAAU,SAAStD,GAC/BwD,KAAKgC,QAAU,WAEd,GAAyC3E,GAAKV,EAAckiB,EAAKK,EAA7DC,EAAyB,kBAAT3iB,GAA6B4iB,IAGjD,IAAGD,EACF3gB,MAAQhC,IACRA,GAAMgC,WACA,CAON,IALAnB,EAAMb,EAAK,GACXqiB,EAAMxhB,IACN+hB,EAAO5iB,EAAKoS,MAAM,GAClBsQ,EAAOE,EAAK,GAERziB,EAAI,EAAGA,EAAIyiB,EAAKxiB,OAAQD,GAAK,EAChC,GAAGkiB,GAAOO,EAAKziB,GAAI,CACM,mBAAdyiB,GAAKziB,EAAE,KAChBuiB,EAAOE,EAAKziB,EAAE,GAEf,OAGFU,EAAI6hB,OAGJ,GAGH/lB,EAAE2G,WAAW,QAAS,SAAStD,GAC9BwD,KAAKiC,YAAczF,EAAK,GACrBA,EAAK,KACPwD,KAAKkC,WAAa1F,EAAK,MAEtB,EAgBH,KAAI,GAbA6iB,IAAU,QAAS,QAAS,YAC/BC,EAAgB,SAAS/f,EAAMggB,GAE9BpmB,EAAE2G,WAAWP,EAAM,SAAS/C,GACR,kBAARA,IACVwD,KAAKxB,MAAQhC,IACbwD,KAAKuf,GAAOpmB,EAAE4iB,SAAS,QAASvf,IAEhCwD,KAAKxB,MAAQhC,IAEZ,IAGGG,EAAI,EAAGA,EAAI0iB,EAAOziB,OAAQD,GAAK,EAAG,CACzC,GAAI4iB,GAAMF,EAAO1iB,EACjB2iB,GAAc,QAAUC,EAAK,KAAOA,EAAI1iB,eAyBzC,MApBA1D,GAAEgV,IAAM,SAAS3R,EAAMgC,GACtB,MAAO,YACNhC,EAAKgC,KAOPrF,EAAEmG,QAAU,WACX,GAAItB,GAAOsU,MAAMhI,UAAUsE,MAAMpE,KAAK/I,UACtC,OAAO,YACN,GAAIlC,GAAOvB,EAAK,GACfwhB,EAAUxhB,EAAK4Q,MAAM,EAClBzV,GAAEG,SAASiG,IACdpG,EAAEG,SAASiG,GAAMof,KAAKnd,MAAMxB,KAAMwf,KAK9BrmB,EAAEG,SAGW,oBAAV6I,SAAoC,OAAXA,QAAmBA,OAAOC,QAC7DD,OAAOC,QAAUkc,EACW,kBAAXjc,SAAyBA,OAAOC,IACjDD,OAAO,WACN,MAAOic,KAGRA,EAAiC,mBAAVnkB,QAAuBA,OAAOhB;;CDlNrD,WACD,GAAIwkB,GAAmB,SAASxkB,EAAGykB,GAClCzkB,EAAE0kB,UAAY1kB,EAAE0kB,cAChBD,EAAQA,GAASzkB,CAEjB,IAsCCwD,GAtCGuD,EAAM,SAAS4d,EAAIC,GACrB,GAAIphB,EACJ,KAAKA,IAAKohB,GAAQA,EAAGjgB,eAAenB,IACnCmhB,EAAGhU,KAAKiU,EAAGphB,GAEZ,OAAOmhB,IAERE,EAAe,SAAShgB,GACvB,GAAIrB,EACJ,KAAIA,IAAKqB,GACR,GAAGA,EAAKrB,IAAMqB,EAAKrB,GAALqB,SACb,MACCA,GAAKrB,GAALqB,SAAcR,MAAM,MAKxBygB,EAAe,SAAS/O,GACvB,GAAInI,GAAG/H,CACP,OAAO,YACN,GAAIhB,GAAOsU,MAAMhI,UAAUsE,MAAMpE,KAAK/I,UAEtC,IAAGsF,EAAIiX,EAAahgB,GAAO,CAC1BgB,GAAMkQ,EAAM,IAAMnI,EAAEnI,KAAK,KAEzB,KAAI,GAAIjC,KAAKqB,GACTA,EAAKrB,IAAMqB,EAAKrB,GAALqB,gBACNA,GAAKrB,GAALqB,aAITgB,IAAMkQ,EAEP,QAAQ/V,EAAEuG,EAAGvG,EAAEuG,EAAGvG,GAAGqI,MAAMxB,KAAME,EAAIlB,EAAIhB,MAG3CkgB,GAAW,IAAI,OAAO,UAAU,UAAU,OAAO,UAAU,QAAQ,QAAQ,IAAI,MAAM,MAAM,MAAM,aAAa,OAAO,KAAK,SAAS,SAAS,UAAU,OAAO,OAAO,MAAM,WAAW,UAAU,WAAW,KAAK,MAAM,UAAU,MAAM,MAAM,KAAK,KAAK,KAAK,QAAQ,WAAW,aAAa,SAAS,SAAS,OAAO,QAAQ,WAAW,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,OAAO,SAAS,SAAS,KAAK,OAAO,IAAI,SAAS,MAAM,QAAQ,MAAM,MAAM,SAAS,QAAQ,SAAS,KAAK,OAAO,MAAM,OAAO,OAAO,QAAQ,MAAM,WAAW,SAAS,KAAK,WAAW,SAAS,SAAS,IAAI,QAAQ,MAAM,WAAW,IAAI,KAAK,KAAK,OAAO,OAAO,SAAS,UAAU,SAAS,QAAQ,SAAS,OAAO,QAAQ,SAAS,QAAQ,MAAM,UAAU,MAAM,QAAQ,QAAQ,KAAK,WAAW,QAAQ,KAAK,QAAQ,OAAO,QAAQ,KAAK,QAAQ,KAAK,KAAK,MAAM,QAAQ,OACnzBC,IAID,KAAKxhB,IAAKuhB,GAAaA,EAAQpgB,eAAenB,KAC5C,SAASuS,GACT,GAAIkP,GAAWlP,EAAIrS,aACnB+gB,GAAM1O,GAAOiP,EAAcC,GAAYH,EAAaG,IACnDF,EAAQvhB,GAQX,OAJAxD,GAAE0kB,UAAUQ,MAAQ,WACnB,MAAOF,IAGDP,EAGa,oBAAVzb,SAAoC,OAAXA,QAAmBA,OAAOC,QAC7DD,OAAOC,QAAUub,EACW,kBAAXtb,SAAyBA,OAAOC,IACjDD,OAAO,WACN,MAAOsb,KAGRA,EACkB,mBAAVxjB,QAAuBA,OAAOhB,SACpB,mBAAVgB,QAAuBA;;ADzEhC,GAAIhB,GAAI,QAAU2J,GAAI3I,EAAQ4G,GAU7B,QAASqN,GAAWjU,GACnBkU,EAAYlU,EAAOE,SACnBiU,EAAYnU,EAAOqT,SACnBe,EAAwBpU,EAAOqU,sBAAwBrU,EAAOsU,aAC9DC,EAAyBvU,EAAO+G,uBAAyB/G,EAAOkF,WAmBjE,QAASlG,KACR,GAKIwV,GALA3Q,KAAU4Q,MAAMpE,KAAK/I,WACrBoN,IAAsB,MAAX7Q,EAAK,IAAc+H,EAAKyE,KAAKxM,EAAK,MAAQ8Q,GAAY,OAAS9Q,GAAK,IAAS,WAAaA,GAAK,IAC1G+Q,EAAQF,EAAW7Q,EAAK,MACxBgR,EAAgB,SAAWD,GAAQ,QAAU,YAC7CE,GAAQC,IAAK,MAAOH,UACbI,IACX,IAAIpJ,EAAKyE,KAAKxM,EAAK,KAAOoR,EAAQ,KAAM,IAAIC,OAAM,8DAClD,MAAOV,EAAQW,EAAO5C,KAAK1O,EAAK,KAC/B,GAAiB,KAAb2Q,EAAM,IAAaA,EAAM,GAAIM,EAAKC,IAAMP,EAAM,OAC7C,IAAiB,MAAbA,EAAM,GAAYM,EAAKF,MAAMxO,GAAKoO,EAAM,OAC5C,IAAiB,MAAbA,EAAM,GAAYQ,EAAQrF,KAAK6E,EAAM,QACzC,IAAoB,MAAhBA,EAAM,GAAG,GAAY,CAC7B,GAAIY,GAAOC,EAAW9C,KAAKiC,EAAM,GACjCM,GAAKF,MAAMQ,EAAK,IAAMA,EAAK,KAAOA,EAAK,GAAK,IAAI,GAG9CJ,EAAQvS,OAAS,IAAGqS,EAAKF,MAAMC,GAAiBG,EAAQvQ,KAAK,KAGjE,IAAI6Q,GAAWZ,EAAW7Q,EAAK,GAAKA,EAAK,EAExCiR,GAAKQ,SADF1J,EAAKyE,KAAKiF,KAAcC,EACXD,EAGWzR,EAAK4Q,MAAhBC,EAAsB,EAAgB,EAGvD,KAAK,GAAIc,KAAYZ,GAChBY,IAAaX,EACQ,KAApBD,EAAMY,KAAkBV,EAAKF,MAAMY,IAAaV,EAAKF,MAAMY,IAAa,IAAM,IAAMZ,EAAMY,IAE1FV,EAAKF,MAAMY,GAAYZ,EAAMY,EAEnC,OAAOV,GAER,QAASW,GAAMC,EAAeC,EAAWC,EAAaC,EAAaxJ,EAAMyJ,EAAQC,EAAgBzV,EAAO0V,EAAUC,EAAWC,GA4B5H,IADY,MAAR7J,GAAmC,MAAnBA,EAAK+D,cAAoB/D,EAAO,IAC/B,WAAjBA,EAAK8J,QAAsB,MAAOL,EACtC,IAAIM,GAAaxK,EAAKyE,KAAKyF,GAASO,EAAWzK,EAAKyE,KAAKhE,EACzD,IAAc,MAAVyJ,GAAkBM,IAAeC,EAAU,CAC9C,GAAc,MAAVP,EACH,GAAIF,GAAeA,EAAYU,MAAO,CACrC,GAAIC,GAASjW,EAAQuV,EACjBW,EAAMD,GAAUF,IAAad,EAAQlJ,EAAOyJ,EAAOQ,OAAO7T,MAC9DgU,GAAMb,EAAYU,MAAM7B,MAAM8B,EAAQC,GAAMZ,EAAYnB,MAAM8B,EAAQC,QAE9DV,GAAOQ,OAAOG,EAAMX,EAAOQ,MAAOR,EAE5CA,GAAS,GAAIzJ,GAAKqK,YACdZ,EAAOf,MAAKe,MAChBA,EAAOQ,SAGR,GAAID,IAAad,EAAO,CAEvB,IAAK,GAAI/S,GAAI,EAAGmU,EAAMtK,EAAK5J,OAAYkU,EAAJnU,EAASA,IACvCoJ,EAAKyE,KAAKhE,EAAK7J,MAAQ+S,IAC1BlJ,EAAOA,EAAKuK,OAAOvP,SAAUgF,GAC7B7J,IAcF,KAAK,GAVD8T,MAAYO,EAASf,EAAOrT,SAAW4J,EAAK5J,OAAQqU,EAAgB,EAQpEC,EAAW,EAAGC,EAAY,EAAIC,EAAO,EACrCC,KAAeC,KAAcC,GAA2B,EACnD5U,EAAI,EAAGA,EAAIsT,EAAOrT,OAAQD,IAC9BsT,EAAOtT,IAAMsT,EAAOtT,GAAGoS,OAAgC,MAAvBkB,EAAOtT,GAAGoS,MAAMlI,MACnD0K,GAA2B,EAC3BF,EAASpB,EAAOtT,GAAGoS,MAAMlI,MAAQ2K,OAAQN,EAAUzW,MAAOkC,GAG5D,IAAI4U,EAA0B,CACzB/K,EAAKjJ,QAAQ,MAAQ,KAAIiJ,EAAOA,EAAKiL,OAAO,SAASC,GAAI,MAAY,OAALA,IAEpE,IAAIC,IAAa,CACjB,IAAInL,EAAK5J,QAAUqT,EAAOrT,OAAQ+U,GAAa,MAC1C,KAAK,GAAWC,GAAYC,EAAnBlV,EAAI,EAAyBiV,EAAa3B,EAAOtT,GAAIkV,EAAWrL,EAAK7J,GAAIA,IACtF,GAAIiV,EAAW7C,OAAS8C,EAAS9C,OAAS6C,EAAW7C,MAAMlI,KAAOgL,EAAS9C,MAAMlI,IAAK,CACrF8K,GAAa,CACb,OAIF,GAAIA,EAAY,CACf,IAAK,GAAIhV,GAAI,EAAGmU,EAAMtK,EAAK5J,OAAYkU,EAAJnU,EAASA,IAC3C,GAAI6J,EAAK7J,IAAM6J,EAAK7J,GAAGoS,MACtB,GAAyB,MAArBvI,EAAK7J,GAAGoS,MAAMlI,IAAa,CAC9B,GAAIA,GAAML,EAAK7J,GAAGoS,MAAMlI,GAEnBwK,GAASxK,GADTwK,EAASxK,IAEb2K,OAAQJ,EACR3W,MAAOkC,EACPmV,KAAMT,EAASxK,GAAKpM,MACpB2R,QAAS6D,EAAOQ,MAAMY,EAASxK,GAAKpM,QAAU4T,EAAU/R,cAAc,SALlCkV,OAAQL,EAAW1W,MAAOkC,OAQ3D2U,GAAQxH,MAAMrP,MAAOkC,EAAGyP,QAASyD,EAAckC,WAAWpV,IAAM0R,EAAU/R,cAAc,QAG/F,IAAI0V,KACJ,KAAK,GAAIxV,KAAQ6U,GAAUW,EAAQlI,KAAKuH,EAAS7U,GAIjD,KAAK,GAAWyV,GAHZC,EAAUF,EAAQG,KAAKC,GACvBC,EAAY,GAAIC,OAAMrC,EAAOrT,QAExBD,EAAI,EAAWsV,EAASC,EAAQvV,GAAIA,IAAK,CAKjD,GAJIsV,EAAOT,SAAWN,IACrBN,EAAMX,EAAOgC,EAAOxX,OAAOgW,MAAOR,EAAOgC,EAAOxX,QAChD4X,EAAUE,OAAON,EAAOxX,MAAO,IAE5BwX,EAAOT,SAAWL,EAAW,CAChC,GAAIqB,GAAQnE,EAAU/R,cAAc,MACpCkW,GAAM3L,IAAML,EAAKyL,EAAOxX,OAAOsU,MAAMlI,IACrCgJ,EAAc4C,aAAaD,EAAO3C,EAAckC,WAAWE,EAAOxX,QAAU,MAC5E4X,EAAUE,OAAON,EAAOxX,MAAO,GAAIsU,OAAQlI,IAAKL,EAAKyL,EAAOxX,OAAOsU,MAAMlI,KAAM4J,OAAQ+B,KAGpFP,EAAOT,SAAWJ,IACjBvB,EAAckC,WAAWE,EAAOxX,SAAWwX,EAAO7F,SAA8B,OAAnB6F,EAAO7F,SACvEyD,EAAc4C,aAAaR,EAAO7F,QAASyD,EAAckC,WAAWE,EAAOxX,QAAU,MAEtF4X,EAAUJ,EAAOxX,OAASwV,EAAOgC,EAAOH,OAG1C,IAAK,GAAInV,GAAI,EAAGmU,EAAMQ,EAAQ1U,OAAYkU,EAAJnU,EAASA,IAAK,CACnD,GAAIsV,GAASX,EAAQ3U,EACrBkT,GAAc4C,aAAaR,EAAO7F,QAASyD,EAAckC,WAAWE,EAAOxX,QAAU,MACrF4X,EAAUJ,EAAOxX,OAASwV,EAAOgC,EAAOxX,OAEzCwV,EAASoC,EACTpC,EAAOQ,MAAQ,GAAI6B,OAAMzC,EAAckC,WAAWnV,OAClD,KAAK,GAAW8V,GAAP/V,EAAI,EAAU+V,EAAQ7C,EAAckC,WAAWpV,GAAIA,IAAKsT,EAAOQ,MAAM9T,GAAK+V,GAKrF,IAAK,GAAI/V,GAAI,EAAGgW,EAAa,EAAG7B,EAAMtK,EAAK5J,OAAYkU,EAAJnU,EAASA,IAAK,CAEhE,GAAIiW,GAAOhD,EAAMC,EAAeC,EAAWG,EAAQxV,EAAO+L,EAAK7J,GAAIsT,EAAO0C,GAAazC,EAAgBzV,EAAQwW,GAAiBA,EAAed,EAAUC,EAAWC,EAChKuC,KAAS7R,IACR6R,EAAKnC,MAAMO,SAAQA,GAAS,GAKhCC,GAJG2B,EAAKC,UAIUD,EAAKjE,MAAM,0BAA4B/R,OAEpCmJ,EAAKyE,KAAKoI,KAAUlD,EAAQkD,EAAKhW,OAAS,EAChEqT,EAAO0C,KAAgBC,GAExB,IAAK5B,EAAQ,CAIZ,IAAK,GAAIrU,GAAI,EAAGmU,EAAMtK,EAAK5J,OAAYkU,EAAJnU,EAASA,IAC1B,MAAbsT,EAAOtT,IAAY8T,EAAM3G,KAAKtI,MAAMiP,EAAOR,EAAOtT,GAAG8T,MAI1D,KAAK,GAAWqC,GAAPnW,EAAI,EAASmW,EAAO7C,EAAOQ,MAAM9T,GAAIA,IACtB,MAAnBmW,EAAKC,YAAsBtC,EAAMlT,QAAQuV,GAAQ,GAAGlC,GAAOkC,IAAQ7C,EAAOtT,IAE3E6J,GAAK5J,OAASqT,EAAOrT,SAAQqT,EAAOrT,OAAS4J,EAAK5J,QACtDqT,EAAOQ,MAAQA,OAGZ,IAAY,MAARjK,GAAgBgK,IAAa1B,EAAQ,CACxCtI,EAAKuI,QAAOvI,EAAKuI,UACjBkB,EAAOlB,QAAOkB,EAAOlB,SAE1B,IAAIiE,GAAetM,OAAOC,KAAKH,EAAKuI,OAChCkE,GAAUD,EAAapW,QAAU,OAAS4J,GAAKuI,MAAQ,EAAI,EAM/D,KAJIvI,EAAK0I,KAAOe,EAAOf,KAAO8D,EAAapU,QAAU8H,OAAOC,KAAKsJ,EAAOlB,OAAOnQ,QAAU4H,EAAKuI,MAAMxO,IAAM0P,EAAOlB,MAAMxO,MAClH0P,EAAOQ,MAAM7T,QAAQgU,EAAMX,EAAOQ,OAClCR,EAAOiD,qBAAwBjD,GAAOiD,cAAcC,WAAaC,GAAUnD,EAAOiD,cAAcC,YAEjGpN,EAAKyE,KAAKhE,EAAK0I,MAAQE,EAAQ,MAEnC,IAAI0D,GAAMO,GAAgC,IAAxBpD,EAAOQ,MAAM7T,MA6B/B,IA5BI4J,EAAKuI,MAAMuE,MAAOlD,EAAY5J,EAAKuI,MAAMuE,MACvB,QAAb9M,EAAK0I,IAAekB,EAAY,6BACnB,SAAb5J,EAAK0I,MAAgBkB,EAAY,sCACtCiD,IACgBP,EAAftM,EAAKuI,MAAMwE,GAAWnD,IAAcrP,EAAYsN,EAAU/R,cAAckK,EAAK0I,IAAK1I,EAAKuI,MAAMwE,IAAMlF,EAAUmF,gBAAgBpD,EAAW5J,EAAK0I,IAAK1I,EAAKuI,MAAMwE,IACrJnD,IAAcrP,EAAYsN,EAAU/R,cAAckK,EAAK0I,KAAOb,EAAUmF,gBAAgBpD,EAAW5J,EAAK0I,KACpHe,GACCf,IAAK1I,EAAK0I,IAEVH,MAAOkE,GAAUQ,EAAcX,EAAMtM,EAAK0I,IAAK1I,EAAKuI,SAAWqB,GAAa5J,EAAKuI,MACjFU,SAA2B,MAAjBjJ,EAAKiJ,UAAoBjJ,EAAKiJ,SAAS7S,OAAS,EACzDgT,EAAMkD,EAAMtM,EAAK0I,IAAKnO,EAAWA,EAAWyF,EAAKiJ,SAAUQ,EAAOR,UAAU,EAAM,EAAGjJ,EAAKuI,MAAM2E,gBAAkBZ,EAAO3C,EAAUC,EAAWC,GAC9I7J,EAAKiJ,SACNgB,OAAQqC,IAEL7C,EAAOR,WAAaQ,EAAOR,SAASgB,QAAOR,EAAOR,SAASgB,UAE9C,WAAbjK,EAAK0I,KAAoB1I,EAAKuI,MAAMvQ,OAAOiV,EAAcX,EAAMtM,EAAK0I,KAAM1Q,MAAOgI,EAAKuI,MAAMvQ,UAAY4R,GAC5GP,EAAc4C,aAAaK,EAAMjD,EAAckC,WAAWtX,IAAU,QAGpEqY,EAAO7C,EAAOQ,MAAM,GAChBwC,IAASQ,EAAcX,EAAMtM,EAAK0I,IAAK1I,EAAKuI,MAAOkB,EAAOlB,MAAOqB,GACrEH,EAAOR,SAAWG,EAAMkD,EAAMtM,EAAK0I,IAAKnO,EAAWA,EAAWyF,EAAKiJ,SAAUQ,EAAOR,UAAU,EAAO,EAAGjJ,EAAKuI,MAAM2E,gBAAkBZ,EAAO3C,EAAUC,EAAWC,GACjKJ,EAAOQ,MAAMO,QAAS,EAClBd,KAAmB,GAAgB,MAAR4C,GAAcjD,EAAc4C,aAAaK,EAAMjD,EAAckC,WAAWtX,IAAU,aAGvG+L,GAAKuI,MAAc,SAAMqE,EAAU,CAC7C,GAAIO,IAAU1D,EAAOiD,cAAgBjD,EAAOiD,kBAGxCU,GAAW,SAASpN,EAAMxI,GAC7B,MAAO,YACN,MAAOwI,GAAKuI,MAAc,OAAEvN,MAAMgF,EAAMxI,IAG1CqS,GAAQvG,KAAK8J,GAASpN,GAAOsM,GAAOO,GAAOM,GAAS1D,UAGjD,UAAWO,IAAY4C,EAAU,CAErC,GAAI3C,EACwB,KAAxBR,EAAOQ,MAAM7T,QACZ4J,EAAKqM,SACRpC,EAAQoD,EAAWhE,EAAepV,EAAO+L,IAGzCiK,GAASpC,EAAUyF,eAAetN,IAC7BqJ,EAAckE,SAASpF,MAAMqF,IAAenE,EAAc4C,aAAahC,EAAM,GAAIZ,EAAckC,WAAWtX,IAAU,OAE1HwV,EAAS,wBAAwB1S,cAAeiJ,IAAQ,GAAK,GAAIA,GAAKqK,YAAYrK,GAAQA,EAC1FyJ,EAAOQ,MAAQA,GAEPR,EAAOgE,YAAczN,EAAKyN,WAAa/D,KAAmB,GAClEO,EAAQR,EAAOQ,MACVN,GAAYA,IAAa9B,EAAU6F,gBACnC1N,EAAKqM,UACRjC,EAAMH,EAAOR,GACbQ,EAAQoD,EAAWhE,EAAepV,EAAO+L,IAKvB,aAAdsJ,EAA0BD,EAAcrR,MAAQgI,EAC3C2J,EAAUA,EAASgE,UAAY3N,IAEb,IAAtBiK,EAAM,GAAG2D,UAAkB3D,EAAM7T,OAAS,KAC7CgU,EAAMX,EAAOQ,MAAOR,GACpBQ,GAASpC,EAAUyF,eAAetN,KAEnCqJ,EAAc4C,aAAahC,EAAM,GAAIZ,EAAckC,WAAWtX,IAAU,MACxEgW,EAAM,GAAG4D,UAAY7N,IAIxByJ,EAAS,GAAIzJ,GAAKqK,YAAYrK,GAC9ByJ,EAAOQ,MAAQA,GAEXR,EAAOQ,MAAMO,QAAS,EAG5B,MAAOf,GAER,QAASmC,GAAYkC,EAAGvX,GAAI,MAAOuX,GAAE9C,OAASzU,EAAEyU,QAAU8C,EAAE7Z,MAAQsC,EAAEtC,MACtE,QAASgZ,GAAcX,EAAM5D,EAAKqF,EAAWC,EAAapE,GACzD,IAAK,GAAIT,KAAY4E,GAAW,CAC/B,GAAIE,GAAWF,EAAU5E,GACrB+E,EAAaF,EAAY7E,EAC7B,IAAMA,IAAY6E,IAAiBE,IAAeD,EAuC5B,UAAb9E,GAAgC,UAART,GAAmB4D,EAAKtU,OAASiW,IACjE3B,EAAKtU,MAAQiW,OAxC+C,CAC5DD,EAAY7E,GAAY8E,CACxB,KAEC,GAAiB,WAAb9E,GAAqC,OAAZA,EAAmB,QAE3C,UAAW8E,KAAarB,GAAuC,IAA3BzD,EAASpS,QAAQ,MACzDuV,EAAKnD,GAAYgF,EAAWF,EAAU3B,OAGlC,IAAiB,UAAbnD,GAAoC,MAAZ8E,GAAoB1O,EAAKyE,KAAKiK,KAAc3F,EAAQ,CACpF,IAAK,GAAI8F,KAAQH,IACE,MAAdC,GAAsBA,EAAWE,KAAUH,EAASG,MAAO9B,EAAKpW,MAAMkY,GAAQH,EAASG,GAE5F,KAAK,GAAIA,KAAQF,GACVE,IAAQH,KAAW3B,EAAKpW,MAAMkY,GAAQ,QAIxB,OAAbxE,EACS,SAAbT,EAAqBmD,EAAK+B,eAAe,+BAAgC,OAAQJ,GAC/D,cAAb9E,EAA0BmD,EAAKtS,aAAa,QAASiU,GACzD3B,EAAKtS,aAAamP,EAAU8E,GAKzB9E,IAAYmD,IAAuB,SAAbnD,GAAoC,UAAbA,GAAqC,SAAbA,GAAoC,SAAbA,GAExF,UAART,GAAmB4D,EAAKnD,KAAc8E,KAAU3B,EAAKnD,GAAY8E,GAEjE3B,EAAKtS,aAAamP,EAAU8E,GAElC,MAAO/U,GAEN,GAAIA,EAAEoV,QAAQvX,QAAQ,oBAAsB,EAAG,KAAMmC,KAQxD,MAAO8U,GAER,QAAS5D,GAAMH,EAAOR,GACrB,IAAK,GAAItT,GAAI8T,EAAM7T,OAAS,EAAGD,EAAI,GAAIA,IACtC,GAAI8T,EAAM9T,IAAM8T,EAAM9T,GAAGoW,WAAY,CACpC,IAAKtC,EAAM9T,GAAGoW,WAAWgC,YAAYtE,EAAM9T,IAC3C,MAAO+C,IACPuQ,KAAYc,OAAOd,GACfA,EAAOtT,IAAIqY,EAAO/E,EAAOtT,IAGX,GAAhB8T,EAAM7T,SAAa6T,EAAM7T,OAAS,GAEvC,QAASoY,GAAO/E,GAEf,GADIA,EAAOiD,qBAAwBjD,GAAOiD,cAAcC,WAAaC,GAAUnD,EAAOiD,cAAcC,WAChGlD,EAAOR,SACV,GAAI1J,EAAKyE,KAAKyF,EAAOR,YAAcC,EAClC,IAAK,GAAWgD,GAAP/V,EAAI,EAAU+V,EAAQzC,EAAOR,SAAS9S,GAAIA,IAAKqY,EAAOtC,OAEvDzC,GAAOR,SAASP,KAAK8F,EAAO/E,EAAOR,UAG9C,QAASoE,GAAWhE,EAAepV,EAAO+L,GACzC,GAAIyO,GAAcpF,EAAckC,WAAWtX,EAC3C,IAAIwa,EAAa,CAChB,GAAIC,GAAoC,GAAxBD,EAAYb,SACxBhL,EAAciF,EAAU/R,cAAc,OACtC4Y,IACHrF,EAAc4C,aAAarJ,EAAa6L,GAAe,MACvD7L,EAAY+L,mBAAmB,cAAe3O,GAC9CqJ,EAAckF,YAAY3L,IAEtB6L,EAAYE,mBAAmB,cAAe3O,OAE/CqJ,GAAcsF,mBAAmB,YAAa3O,EAEnD,KADA,GAAIiK,MACGZ,EAAckC,WAAWtX,KAAWwa,GAC1CxE,EAAM3G,KAAK+F,EAAckC,WAAWtX,IACpCA,GAED,OAAOgW,GAER,QAASkE,GAAWf,EAAUwB,GAC7B,MAAO,UAAS1V,GACfA,EAAIA,GAAK2V,MACTlc,EAAEsS,OAAO6J,SAAS,QAClBnc,EAAEoc,kBACF,KAAK,MAAO3B,GAASpJ,KAAK4K,EAAQ1V,GAClC,QACC8V,OAiCH,QAASC,GAAgBrJ,GACxB,GAAI3R,GAAQib,EAAUnY,QAAQ6O,EAC9B,OAAe,GAAR3R,EAAYib,EAAU5L,KAAKsC,GAAW,EAAI3R,EASlD,QAASkb,GAAaC,GACrB,GAAIpZ,GAAO,WAEV,MADIiF,WAAU7E,SAAQgZ,EAAQnU,UAAU,IACjCmU,EAOR,OAJApZ,GAAKqZ,OAAS,WACb,MAAOD,IAGDpZ,EA2DR,QAASiP,KAER,IAAK,GAAWE,GADZmK,EAAsC,QAAxB3c,EAAEsS,OAAO6J,WAClB3Y,EAAI,EAASgP,EAAOoK,EAAMpZ,GAAIA,IAClCqZ,EAAYrZ,IACfxD,EAAEkC,OAAOsQ,EAAMsK,EAAQtZ,GAAG4H,KAAO0R,EAAQtZ,GAAG4H,KAAKyR,EAAYrZ,IAAMuZ,IAASJ,EAI1EK,KACHA,IACAA,EAAwB,MAEzBC,EAAe,KACfC,EAAqB,GAAIC,MACzBnd,EAAEsS,OAAO6J,SAAS,QA4FnB,QAASiB,GAAe5c,GACvB,MAAOA,GAAMiV,MAAM4H,GAAMrd,EAAEQ,MAAMS,MAAMwC,QAExC,QAAS6Z,GAAa9K,EAAM+K,EAAQ5L,GACnC6L,KAEA,IAAIC,GAAa9L,EAAKvN,QAAQ,IACX,MAAfqZ,IACHD,GAAcE,EAAiB/L,EAAK1O,OAAOwa,EAAa,EAAG9L,EAAKlO,SAChEkO,EAAOA,EAAK1O,OAAO,EAAGwa,GAGvB,KAAK,GAAIjd,KAAS+c,GAAQ,CACzB,GAAI/c,IAAUmR,EAEb,MADA3R,GAAEgJ,OAAOwJ,EAAM+K,EAAO/c,KACf,CAGR,IAAImd,GAAU,GAAIC,QAAO,IAAMpd,EAAMqd,QAAQ,iBAAkB,SAASA,QAAQ,WAAY,aAAe,MAE3G,IAAIF,EAAQjL,KAAKf,GAOhB,MANAA,GAAKkM,QAAQF,EAAS,WAGrB,IAAK,GAFDnQ,GAAOhN,EAAMgV,MAAM,gBACnBsI,KAAYrI,MAAMpE,KAAK/I,UAAW,EAAG,IAChC9E,EAAI,EAAGmU,EAAMnK,EAAK/J,OAAYkU,EAAJnU,EAASA,IAAKga,GAAYhQ,EAAKhK,GAAGqa,QAAQ,QAAS,KAAOE,mBAAmBD,EAAOta,GACvHxD,GAAEgJ,OAAOwJ,EAAM+K,EAAO/c,OAEhB,GAIV,QAASwd,GAAiBzX,GAEzB,GADAA,EAAIA,GAAK2V,OACL3V,EAAE0X,UAAW1X,EAAE2X,SAAuB,IAAZ3X,EAAE4X,MAAhC,CACI5X,EAAE4E,eAAgB5E,EAAE4E,iBACnB5E,EAAE6X,aAAc,CACrB,IAAIC,GAAgB9X,EAAE8X,eAAiBxX,KACnChC,EAAwB,aAAjB7E,EAAEQ,MAAMS,MAAuBod,EAAcC,OAASZ,EAAiBW,EAAcC,OAAO7I,MAAM,MAC7GzV,GAAEQ,MAAM6d,EAAcre,EAAEQ,MAAMS,MAAMwU,MAAM4H,GAAMrd,EAAEQ,MAAMS,MAAMwC,QAASoB,IAExE,QAAS0Z,KACY,QAAhBve,EAAEQ,MAAMS,MAAkBkU,EAAUzB,KAAMyB,EAAUzB,KAAOyB,EAAUzB,KACpE1S,EAAOwd,SAAS,EAAG,GAEzB,QAASC,GAAiBxC,EAAQyC,GACjC,GAAI5b,KACJ,KAAI,GAAIO,KAAQ4Y,GAAQ,CACvB,GAAIvO,GAAMgR,EAASA,EAAS,IAAMrb,EAAO,IAAMA,EAAMgC,EAAQ4W,EAAO5Y,GAChEsb,EAAY/R,EAAKyE,KAAKhM,GACtB+Q,EAAgB,MAAT/Q,GAAkBsZ,IAAchJ,EAC1C8I,EAAiBpZ,EAAOqI,GACxBiR,IAAcpI,EACblR,EAAMoI,IAAI,SAASgM,GAAO,MAAOmF,oBAAmBlR,EAAM,MAAQ,IAAMkR,mBAAmBnF,KAAQhU,KAAK,KACxGmZ,mBAAmBlR,GAAO,IAAMkR,mBAAmBvZ,EACrDvC,GAAI6N,KAAKyF,GAEV,MAAOtT,GAAI2C,KAAK,KAGjB,QAASiY,GAAiB5a,GAEzB,IAAK,GADD+b,GAAQ/b,EAAIuB,MAAM,KAAM+J,KACnB5K,EAAI,EAAGmU,EAAMkH,EAAMpb,OAAYkU,EAAJnU,EAASA,IAAK,CACjD,GAAI4S,GAAOyI,EAAMrb,GAAGa,MAAM,IAC1B+J,GAAO2P,mBAAmB3H,EAAK,KAAOA,EAAK,GAAK2H,mBAAmB3H,EAAK,IAAM,GAE/E,MAAOhI,GAER,QAAS0Q,GAAMtM,GACd,GAAIuM,GAAWzC,EAAgB9J,EAC/BiF,GAAMjF,EAAKoG,WAAYoG,EAAUD,IACjCC,EAAUD,GAAYnX,EAQvB,QAASqX,GAAQ1M,GAChB,GAAIlP,GAAOrD,EAAEqD,MAKb,OAJAkP,GAAQrH,KAAK7H,GACbA,EAAK6H,KAAO,SAASmH,EAAS6M,GAC7B,MAAOD,GAAQ1M,EAAQrH,KAAKmH,EAAS6M,KAE/B7b,EAMR,QAAS8b,GAASC,EAAiBC,GAwClC,QAASC,GAAO1S,GACf2S,EAAQ3S,GAAQ4S,EAChBC,EAAKhS,IAAI,SAAS0E,GACjBoN,IAAUG,GAAYvN,EAASE,QAAQsN,IAAiBxN,EAAS+M,OAAOS,KAI1E,QAASC,GAAU1U,EAAMkU,EAAiBC,EAAiBQ,GAC1D,IAAsB,MAAhBF,GAAwB/S,EAAKyE,KAAKsO,KAAkBhK,SAAkBgK,KAAiB1F,UAAoB/O,KAAS+O,EACzH,IAEC,GAAIjJ,GAAQ,CACZ9F,GAAKmG,KAAKsO,EAAc,SAASta,GAC5B2L,MACJ2O,EAAeta,EACf+Z,MACE,SAAU/Z,GACR2L,MACJ2O,EAAeta,EACfga,OAGF,MAAO9Y,GACNvG,EAAEmS,SAAS2N,QAAQvZ,GACnBoZ,EAAepZ,EACf8Y,QAGDQ,KAIF,QAASE,KAER,GAAI7U,EACJ,KACCA,EAAOyU,GAAgBA,EAAazU,KAErC,MAAO3E,GAIN,MAHAvG,GAAEmS,SAAS2N,QAAQvZ,GACnBoZ,EAAepZ,EACfgZ,EAAQS,EACDD,IAERH,EAAU1U,EAAM,WACfqU,EAAQU,EACRF,KACE,WACFR,EAAQS,EACRD,KACE,WACF,IACKR,IAAUU,SAAoBb,KAAoBnF,EACrD0F,EAAeP,EAAgBO,GAEvBJ,IAAUS,GAAwC,kBAApBX,KACtCM,EAAeN,EAAgBM,GAC/BJ,EAAQU,GAGV,MAAO1Z,GAGN,MAFAvG,GAAEmS,SAAS2N,QAAQvZ,GACnBoZ,EAAepZ,EACR+Y,IAGJK,IAAiBzT,GACpByT,EAAeO,YACfZ,KAGAM,EAAU1U,EAAM,WACfoU,EAAOI,IACLJ,EAAQ,WACVA,EAAOC,IAAUU,GAAaP,OAjHlC,GAAIO,GAAY,EAAGD,EAAY,EAAGN,EAAW,EAAGF,EAAW,EACvDtT,EAAOrF,KAAM0Y,EAAQ,EAAGI,EAAe,EAAGF,IAE9CvT,GAAc,WAEdA,EAAc,QAAI,SAAS7G,GAO1B,MANKka,KACJI,EAAeta,EACfka,EAAQU,EAERF,KAEMlZ,MAGRqF,EAAa,OAAI,SAAS7G,GAOzB,MANKka,KACJI,EAAeta,EACfka,EAAQS,EAERD,KAEMlZ,MAGRqF,EAAKqG,QAAc,KAAI,SAAS6M,EAAiBC,GAChD,GAAIlN,GAAW,GAAIgN,GAASC,EAAiBC,EAU7C,OATIE,KAAUG,EACbvN,EAASE,QAAQsN,GAETJ,IAAUC,EAClBrN,EAAS+M,OAAOS,GAGhBF,EAAK9O,KAAKwB,GAEJA,EAASI,SAiHlB,QAAS4N,GAAS9a,GAAQ,MAAOA,GAEjC,QAAS+a,GAAK/Z,GACb,IAAIA,EAAQgR,UAA+C,UAAnChR,EAAQgR,SAAS3T,cAyCpC,CACJ,GAAI2c,GAAM,GAAIrf,GAAOsf,cAcrB,IAbAD,EAAIE,KAAKla,EAAQ0L,OAAQ1L,EAAQwJ,KAAK,EAAMxJ,EAAQ3F,KAAM2F,EAAQsG,UAClE0T,EAAIG,mBAAqB,WACD,IAAnBH,EAAII,aACHJ,EAAIK,QAAU,KAAOL,EAAIK,OAAS,IAAKra,EAAQsa,QAAQ/T,KAAM,OAAQpG,OAAQ6Z,IAC5Eha,EAAQyZ,SAASlT,KAAM,QAASpG,OAAQ6Z,MAG3Cha,EAAQua,YAAcrb,KAAKC,WAAaa,EAAQgH,MAA2B,QAAnBhH,EAAQ0L,QACnEsO,EAAIQ,iBAAiB,eAAgB,mCAElCxa,EAAQya,cAAgBvb,KAAKwb,OAChCV,EAAIQ,iBAAiB,SAAU,kCAErBxa,GAAQ8B,SAAW8R,EAAU,CACvC,GAAI+G,GAAW3a,EAAQ8B,OAAOkY,EAAKha,EACnB,OAAZ2a,IAAkBX,EAAMW,GAG7B,GAAI3T,GAA0B,QAAnBhH,EAAQ0L,QAAqB1L,EAAQgH,KAAYhH,EAAQgH,KAAb,EACvD,IAAIA,GAAST,EAAKyE,KAAKhE,IAAS4I,GAAU5I,EAAKqK,aAAe1W,EAAOigB,SACpE,KAAM,oGAGP,OADAZ,GAAIa,KAAK7T,GACFgT,EAjEP,GAAIc,GAAc,qBAAsB,GAAIhE,OAAOiE,UAAY,IAAO7c,KAAKC,MAAsB,KAAhBD,KAAK8c,UAAkBjQ,SAAS,IAC7GkQ,EAASpM,EAAU/R,cAAc,SAErCnC,GAAOmgB,GAAe,SAASI,GAC9BD,EAAO1H,WAAWgC,YAAY0F,GAC9Bjb,EAAQsa,QACP/T,KAAM,OACNpG,QACCgb,aAAcD,KAGhBvgB,EAAOmgB,GAAevZ,GAGvB0Z,EAAOxB,QAAU,WAYhB,MAXAwB,GAAO1H,WAAWgC,YAAY0F,GAE9Bjb,EAAQyZ,SACPlT,KAAM,QACNpG,QACCka,OAAQ,IACRc,aAAcjc,KAAKC,WAAW5C,MAAO,kCAGvC5B,EAAOmgB,GAAevZ,GAEf,GAGR0Z,EAAOX,OAAS,WACf,OAAO,GAGRW,EAAO7W,IAAMpE,EAAQwJ,KACjBxJ,EAAQwJ,IAAIzL,QAAQ,KAAO,EAAI,IAAM,MACrCiC,EAAQ8a,YAAc9a,EAAQ8a,YAAc,YAC7C,IAAMA,EACN,IAAM1C,EAAiBpY,EAAQgH,UAClC6H,EAAUrR,KAAK2D,YAAY8Z,GA8B7B,QAASG,GAASC,EAAYrU,EAAMuT,GACnC,GAA0B,QAAtBc,EAAW3P,QAA2C,SAAvB2P,EAAWrK,SAAqB,CAClE,GAAIqH,GAASgD,EAAW7R,IAAIzL,QAAQ,KAAO,EAAI,IAAM,IACjDud,EAAclD,EAAiBpR,EACnCqU,GAAW7R,IAAM6R,EAAW7R,KAAO8R,EAAcjD,EAASiD,EAAc,QAEpED,GAAWrU,KAAOuT,EAAUvT,EACjC,OAAOqU,GAER,QAASE,GAAgB/R,EAAKxC,GAC7B,GAAIwU,GAAShS,EAAI2F,MAAM,cACvB,IAAIqM,GAAUxU,EACb,IAAK,GAAI7J,GAAI,EAAGA,EAAIqe,EAAOpe,OAAQD,IAAK,CACvC,GAAIkK,GAAMmU,EAAOre,GAAGiS,MAAM,EAC1B5F,GAAMA,EAAIgO,QAAQgE,EAAOre,GAAI6J,EAAKK,UAC3BL,GAAKK,GAGd,MAAOmC,GA/8BR,GAMIqF,GAAWC,EAAWI,EAAwBH,EAN9CO,EAAS,kBAAmBY,EAAQ,iBAAkBN,EAAS,kBAAmBgE,EAAW,WAC7FrN,KAAUwE,SACV+E,EAAS,uCAAwCE,EAAa,+BAC9DwE,EAAe,yFAanB5F,GAAWjU,EA+ZX,IAAI8gB,GACAC,GACHva,YAAa,SAASmS,GACjBmI,IAASla,IAAWka,EAAO5M,EAAU/R,cAAc,SACnD+R,EAAUpR,iBAAmBoR,EAAUpR,kBAAoB6V,EAC9DzE,EAAU8M,aAAarI,EAAMzE,EAAUpR,iBAEnCoR,EAAU1N,YAAYmS,GAC3B9S,KAAK+R,WAAa1D,EAAU0D,YAE7BU,aAAc,SAASK,GACtB9S,KAAKW,YAAYmS,IAElBf,eAEG2D,KAAgByC,IACpBhf,GAAEkC,OAAS,SAASsQ,EAAMsD,EAAMmM,GAC/B,GAAI/K,KACJ,KAAK1E,EAAM,KAAM,IAAI0D,OAAM,4EAC3B,IAAI9O,GAAKkV,EAAgB9J,GACrB0P,EAAiB1P,IAAS0C,EAC1ByE,EAAOuI,GAAkB1P,IAAS0C,EAAUpR,gBAAkBie,EAAevP,CAC7E0P,IAA8B,QAAZpM,EAAKC,MAAeD,GAAQC,IAAK,OAAQH,SAAWU,SAAUR,IAChFkJ,EAAU5X,KAAQQ,GAAW6P,EAAMkC,EAAKf,YACxCqJ,KAAoB,GAAMnD,EAAMtM,GACpCwM,EAAU5X,GAAMqP,EAAMkD,EAAM,KAAM/R,EAAWA,EAAWkO,EAAMkJ,EAAU5X,IAAK,EAAO,EAAG,KAAMQ,EAAWsP,EACxG,KAAK,GAAI1T,GAAI,EAAGmU,EAAMT,EAAQzT,OAAYkU,EAAJnU,EAASA,IAAK0T,EAAQ1T,MAO7DxD,EAAEqL,MAAQ,SAAShG,GAGlB,MAFAA,GAAQ,GAAI8c,QAAO9c,GACnBA,EAAMqU,UAAW,EACVrU,GAgBRrF,EAAEqD,KAAO,SAAUoZ,GAElB,OAAe,MAATA,GAAiB7P,EAAKyE,KAAKoL,KAAW9G,SAAkB8G,KAAUxC,UAAoBwC,GAAMvR,OAAS+O,EACnGgF,EAAQxC,GAGTD,EAAaC,GAGrB,IAA8I2F,GAA1IxF,KAAYE,KAAcD,KAAkBI,EAAe,KAAMC,EAAqB,EAAGF,EAAwB,KACjHqF,EAAe,EACnBriB,GAAEgJ,OAAS,SAASwJ,EAAMxJ,GACzB,IAAKwJ,EAAM,KAAM,IAAI0D,OAAM,4EAC3B,IAAI5U,GAAQsb,EAAMxY,QAAQoO,EACd,GAARlR,IAAWA,EAAQsb,EAAMnZ,OAC7B,IAAI6e,IAAc,CAClB,IAAIzF,EAAYvb,UAAiBub,GAAYvb,GAAO0Y,WAAaC,EAAU,CAC1E,GAAIiC,IACH/Q,eAAgB,WAAYmX,GAAc,GAE3CzF,GAAYvb,GAAO0Y,SAASkC,GAE7B,IAAKoG,EAAa,CACjBtiB,EAAEsS,OAAO6J,SAAS,OAClBnc,EAAEoc,mBACFQ,EAAMtb,GAASkR,CACf,IAAI+P,GAAgBH,EAAYpZ,EAASA,MACrCgE,EAAa,IAAKhE,EAAOgE,YAAc,aAQ3C,OALIuV,KAAkBH,IACrBvF,EAAYvb,GAAS0L,EACrB8P,EAAQxb,GAAS0H,GAElBqT,KACOQ,EAAYvb,KAGrBtB,EAAEsS,OAAS,SAASkQ,GAGfvF,GAAgBuF,KAAU,GAGzB,GAAIrF,MAAOD,EAAqBmF,GAAgB9M,IAA2BvU,EAAO+G,yBACjFkV,EAAe,GAAG7H,EAAsB6H,GAC5CA,EAAe1H,EAAuBjD,EAAQ+P,KAI/C/P,IACA2K,EAAe1H,EAAuB,WAAY0H,EAAe,MAAOoF,KAG1EriB,EAAEsS,OAAO6J,SAAWnc,EAAEqD,MACtB,IAAI0Z,GAAQ,WAAY,MAAO,IAkB3B0F,EAAkB,CACtBziB,GAAEoc,iBAAmB,WAAYqG,KACjCziB,EAAE0iB,eAAiB,WAClBD,EAAkBle,KAAKoe,IAAIF,EAAkB,EAAG,GACxB,IAApBA,GAAuBziB,EAAEsS,SAE9B,IAAI+J,IAAsB,WACE,QAAvBrc,EAAEsS,OAAO6J,YACZsG,IACAziB,EAAEsS,OAAO6J,SAAS,SAEdnc,EAAE0iB,iBAGR1iB,GAAE4iB,SAAW,SAASvf,EAAMwf,GAC3B,MAAO,UAAStc,GACfA,EAAIA,GAAK2V,KACT,IAAImC,GAAgB9X,EAAE8X,eAAiBxX,IACvCgc,GAAiBxf,IAAQgb,GAAgBA,EAAchb,GAAQgb,EAAcyE,aAAazf,KAK5F,IAC8Bma,IAAauF,GADvC1F,IAAS2F,SAAU,GAAItP,KAAM,IAAK4K,OAAQ,KAC1C2E,GAAW,YAybf,OAxbAjjB,GAAEQ,MAAQ,WAET,GAAyB,IAArB8H,UAAU7E,OAAc,MAAOsf,GAE9B,IAAyB,IAArBza,UAAU7E,QAAgBmJ,EAAKyE,KAAK/I,UAAU,MAAQ2N,EAAQ,CACtE,GAAIzD,GAAOlK,UAAU,GAAI4a,EAAe5a,UAAU,GAAIiV,EAASjV,UAAU,EACzE2a,IAAW,SAASE,GACnB,GAAIxR,GAAOoR,GAAe3F,EAAe+F,EACpC7F,GAAa9K,EAAM+K,EAAQ5L,IAC/B3R,EAAEQ,MAAM0iB,GAAc,GAGxB,IAAIE,GAA4B,SAAjBpjB,EAAEQ,MAAMS,KAAkB,eAAiB,YAC1DD,GAAOoiB,GAAY,WAClB,GAAIzR,GAAOwD,EAAUnV,EAAEQ,MAAMS,KACR,cAAjBjB,EAAEQ,MAAMS,OAAqB0Q,GAAQwD,EAAUmJ,QAC/CyE,IAAgB3F,EAAezL,IAClCsR,GAAStR,IAGXqL,EAAwBuB,EACxBvd,EAAOoiB,SAGH,IAAI9a,UAAU,GAAGN,iBAAkB,CACvC,CAAA,GAAIiL,GAAU3K,UAAU,EACJA,WAAU,GAChBA,UAAU,GACxB2K,EAAQ1I,MAAyB,aAAjBvK,EAAEQ,MAAMS,KAAsBkU,EAAU6N,SAAW,IAAM3F,GAAMrd,EAAEQ,MAAMS,MAAQ4F,KAAK+O,MAAMrL,KAC1G0I,EAAQnL,oBAAoB,QAASkW,GACrC/K,EAAQjL,iBAAiB,QAASgW,OAG9B,IAAIpR,EAAKyE,KAAK/I,UAAU,MAAQ2N,EAAQ,CAC5C,GAAIoN,GAAWN,EACfA,IAAeza,UAAU,EACzB,IAAIzD,GAAOyD,UAAU,OACjBgb,EAAaP,GAAa3e,QAAQ,KAClCgK,EAASkV,EAAa,GAAK5F,EAAiBqF,GAAatN,MAAM6N,EAAa,MAChF,KAAK,GAAI9f,KAAKqB,GAAMuJ,EAAO5K,GAAKqB,EAAKrB,EACrC,IAAIme,GAAclD,EAAiBrQ,GAC/BmV,EAAcD,EAAa,GAAKP,GAAatN,MAAM,EAAG6N,GAAcP,EACpEpB,KAAaoB,GAAeQ,GAA4C,KAA7BA,EAAYnf,QAAQ,KAAc,IAAM,KAAOud,EAE9F,IAAI6B,IAAkD,IAArBlb,UAAU7E,OAAe6E,UAAU,GAAKA,UAAU,OAAQ,GAAQ+a,IAAa/a,UAAU,EAE1H,IAAItH,EAAOmT,QAAQC,UAAW,CAC7B4I,EAAwB,WACvBhc,EAAOmT,QAAQqP,EAA4B,eAAiB,aAAa,KAAMtO,EAAUuO,MAAOpG,GAAMrd,EAAEQ,MAAMS,MAAQ8hB,IACtHxE,IAED,IAAImF,GAAUrG,GAAMrd,EAAEQ,MAAMS,MAAQ8hB,EACpCE,IAASS,OAGTvO,GAAUnV,EAAEQ,MAAMS,MAAQ8hB,KAI7B/iB,EAAEQ,MAAMiR,MAAQ,SAAS/D,GACxB,IAAK8P,GAAa,KAAM,IAAItH,OAAM,sFAClC,OAAOsH,IAAY9P,IAEpB1N,EAAEQ,MAAMS,KAAO,SA0EfjB,EAAEmS,SAAW,WACZ,GAAIA,GAAW,GAAIgN,EAEnB,OADAhN,GAASI,QAAU0M,EAAQ9M,EAASI,SAC7BJ,GAsIRnS,EAAEmS,SAAS2N,QAAU,SAASvZ,GAC7B,GAAqB,mBAAjBqG,EAAKyE,KAAK9K,KAA4BA,EAAEmR,YAAYtG,WAAWoE,MAAM,UAAW,KAAMjP,IAG3FvG,EAAE2jB,KAAO,SAAS9e,GAEjB,QAAS+e,GAAaC,EAAKC,GAC1B,MAAO,UAASze,GAOf,MANA0e,GAAQF,GAAOxe,EACVye,IAAU/R,EAAS,UACF,MAAhBiS,IACL7R,EAASI,QAAQwR,GACjB5R,EAASJ,GAAQgS,IAEX1e,GATT,GAAI0M,GAAS,UAaTI,EAAWnS,EAAEmS,WACb6R,EAAcnf,EAAKpB,OACnBsgB,EAAU,GAAI5K,OAAM6K,EACxB,IAAInf,EAAKpB,OAAS,EACjB,IAAK,GAAID,GAAI,EAAGA,EAAIqB,EAAKpB,OAAQD,IAChCqB,EAAKrB,GAAG0H,KAAK0Y,EAAapgB,GAAG,GAAOogB,EAAapgB,GAAG,QAGjD2O,GAASE,WAEd,OAAOF,GAASI,SA+FjBvS,EAAEoS,QAAU,SAASsP,GAChBA,EAAWpR,cAAe,GAAMtQ,EAAEoc,kBACtC,IAAIjK,GAAWnS,EAAEmS,WACb8R,EAAUvC,EAAWrK,UAAkD,UAAtCqK,EAAWrK,SAAS3T,cACrDkd,EAAYc,EAAWd,UAAYqD,EAAU9D,EAAWuB,EAAWd,WAAarb,KAAKC,UACrFsb,EAAcY,EAAWZ,YAAcmD,EAAU9D,EAAWuB,EAAWZ,aAAevb,KAAKwb,MAC3FmD,EAAUxC,EAAWwC,SAAW,SAAS7D,GAC5C,MAAmC,KAA5BA,EAAImB,aAAa/d,QAAgBqd,IAAgBvb,KAAKwb,MAAQ,KAAOV,EAAImB,aAyBjF,OAvBAE,GAAW7R,IAAM+R,EAAgBF,EAAW7R,IAAK6R,EAAWrU,MAC5DqU,EAAaD,EAASC,EAAYA,EAAWrU,KAAMuT,GACnDc,EAAWf,OAASe,EAAW5B,QAAU,SAASvZ,GACjD,IACCA,EAAIA,GAAK2V,KACT,IAAItT,IAAqB,SAAXrC,EAAEqG,KAAkB8U,EAAWyC,cAAgBzC,EAAW0C,cAAgBjE,EACpFrP,EAAWlI,EAAOkY,EAAYoD,EAAQ3d,EAAEC,OAAQkb,IACpD,IAAe,SAAXnb,EAAEqG,KACL,GAAIA,EAAKyE,KAAKP,KAAcyF,GAASmL,EAAW9U,KAC/C,IAAK,GAAIpJ,GAAI,EAAGA,EAAIsN,EAASrN,OAAQD,IAAKsN,EAAStN,GAAK,GAAIke,GAAW9U,KAAKkE,EAAStN,QAE7Eke,GAAW9U,OAAMkE,EAAW,GAAI4Q,GAAW9U,KAAKkE,GAE1DqB,GAAoB,SAAX5L,EAAEqG,KAAkB,UAAY,UAAUkE,GAEpD,MAAOvK,GACNvG,EAAEmS,SAAS2N,QAAQvZ,GACnB4L,EAAS+M,OAAO3Y,GAEbmb,EAAWpR,cAAe,GAAMtQ,EAAE0iB,kBAEvCtC,EAAKsB,GACLvP,EAASI,QAAQmP,EAAWnR,cACrB4B,EAASI,SAIjBvS,EAAEqkB,KAAO,SAASC,GAEjB,MADArP,GAAWjU,EAASsjB,GAAQtjB,GACrBA,GAGRhB,EAAEqkB,KAAKE,QAAU5a,EAEV3J,GACY,mBAAVgB,QAAwBA,UAEb,oBAAVgI,SAAoC,OAAXA,QAAmBA,OAAOC,QAASD,OAAOC,QAAUjJ,EAC7D,kBAAXkJ,SAAyBA,OAAOC,KAAKD,OAAO,WAAY,MAAOlJ;;AGlgC/E,GAAIsmB,WAAYrmB,QAAQ,YA4CxB+I,QAAOC,SACNgF,KAAM,SAAS/B,EAAMqa,GACpB,MAAO,UAASngB,GACf,GACClC,GADGC,KAEHqiB,GAAkB,EAElBC,EAAa,SAASphB,GACrB,MAAwB,mBAAVA,IAAmC,KAAVA,GAA0B,OAAVA,GAGxDqhB,EAAW,SAAStgB,GACnB,MAA4B,kBAAd8F,GAAK9F,GAAqB8F,EAAK9F,KAAS8F,EAAK9F,IAI5D6F,EAAW,SAAS7F,EAAMf,EAAOshB,GAChC,GAAIC,GACH1iB,EACAC,IACD,KAAIyiB,IAAcD,GAGhBziB,EAFgB,cAAd0iB,EAEIH,EAAWphB,IAAQ,EAAMshB,EAAYC,GAGrCN,UAAUM,GAAYvhB,IAAQ,EAAMshB,EAAYC,GAIpD1iB,KAAQ,GACVC,EAAUA,KAAW,GAAkB,aAAVA,KAA4BA,EACzDA,EAAOwM,KAAKzM,IAEZC,GAAS,CAGX,OAAOA,GAGT,IAAGiC,EACFjC,EAAS8H,EAAS7F,EAAMsgB,EAAStgB,GAAOmgB,EAAKngB,QACvC,CAEN,IAAIA,IAAQmgB,GACXriB,EAAM+H,EAAS7F,EAAMsgB,EAAStgB,GAAOmgB,EAAKngB,IACvClC,KAAQ,IACVsiB,GAAkB,GAEnBriB,EAAOiC,GAAQlC,CAEZsiB,KACHriB,GAAS,GAIX,MAAOA;;CC7EV,SAAWiC,EAAMygB,GACU,mBAAZ5d,UAA6C,mBAAXD,QACzCA,OAAOC,QAAU4d,IACQ,kBAAX3d,SAA+C,gBAAfA,QAAOC,IACrDD,OAAO2d,GAEPhgB,KAAKT,GAAQygB,KAElB,YAAa,SAAUP,GAEtB,YAugBA,SAASQ,GAAM7kB,EAAK8kB,GAChB9kB,EAAMA,KACN,KAAK,GAAIyL,KAAOqZ,GACY,mBAAb9kB,GAAIyL,KACXzL,EAAIyL,GAAOqZ,EAASrZ,GAG5B,OAAOzL,GA5gBXqkB,GAAcU,QAAS,SAEvB,IAAIta,GAAQ,04BAERua,EAAa,wJAEbC,EAAc,4BACdC,EAAc,kBAEdC,EAAY,mDACZC,EAAO,0DAEPC,GACAC,EAAK,mEACLC,EAAK,yEACLC,EAAK,yEACLC,IAAK,mEAGLC,EAAQ,cACRC,EAAe,iBACfC,EAAU,aACVC,EAAM,4BACNC,EAAQ,6DACRC,EAAc,iBACdC,EAAW,sCAEXC,EAAQ,iBACRC,EAAY,eACZC,EAAY,mEACZC,EAAY,kEAEZC,EAAgB,iCAEhBC,EAAS,uFAETC,GACFC,QAAS,mCACTC,QAAS,qBACTC,QAAS,qBAGXrC,GAAUsC,OAAS,SAAUxiB,EAAMH,GAC/BqgB,EAAUlgB,GAAQ,WACd,GAAIvB,GAAOsU,MAAMhI,UAAUsE,MAAMpE,KAAK/I,UAEtC,OADAzD,GAAK,GAAKyhB,EAAUlV,SAASvM,EAAK,IAC3BoB,EAAGoC,MAAMie,EAAWzhB,KAMnCyhB,EAAUtf,KAAO,WACb,IAAK,GAAIZ,KAAQkgB,GACkB,kBAApBA,GAAUlgB,IAAiC,aAATA,GAC5B,WAATA,GAA8B,WAATA,GAA8B,SAATA,GAGlDkgB,EAAUsC,OAAOxiB,EAAMkgB,EAAUlgB,KAIzCkgB,EAAUlV,SAAW,SAAUX,GAQ3B,MAPqB,gBAAVA,IAAgC,OAAVA,GAAkBA,EAAMW,SACrDX,EAAQA,EAAMW,WACG,OAAVX,GAAmC,mBAAVA,IAA0BhI,MAAMgI,KAAWA,EAAMhN,OACjFgN,EAAQ,GACgB,gBAAVA,KACdA,GAAS,IAENA,GAGX6V,EAAUuC,OAAS,SAAUC,GACzB,MAA6C,kBAAzCvb,OAAO4D,UAAUC,SAASC,KAAKyX,GACxBA,GAEXA,EAAO3L,KAAK4D,MAAM+H,GACVrgB,MAAMqgB,GAAyB,KAAjB,GAAI3L,MAAK2L,KAGnCxC,EAAUyC,QAAU,SAAUjmB,GAC1B,MAAOkmB,YAAWlmB,IAGtBwjB,EAAU2C,MAAQ,SAAUnmB,EAAKomB,GAC7B,MAAOC,UAASrmB,EAAKomB,GAAS,KAGlC5C,EAAU8C,UAAY,SAAUtmB,EAAKumB,GACjC,MAAIA,GACe,MAARvmB,GAAuB,SAARA,EAEX,MAARA,GAAuB,UAARA,GAA2B,KAARA,GAG7CwjB,EAAUgD,OAAS,SAAUxmB,EAAKymB,GAC9B,MAAOzmB,KAAQwjB,EAAUlV,SAASmY,IAGtCjD,EAAUkD,SAAW,SAAU1mB,EAAK2mB,GAChC,MAAO3mB,GAAIsB,QAAQkiB,EAAUlV,SAASqY,KAAU,GAGpDnD,EAAUoD,QAAU,SAAU5mB,EAAK6mB,EAASC,GAIxC,MAHgD,oBAA5Crc,OAAO4D,UAAUC,SAASC,KAAKsY,KAC/BA,EAAU,GAAI/L,QAAO+L,EAASC,IAE3BD,EAAQjX,KAAK5P,IAGxBwjB,EAAUnY,QAAU,SAAUrL,GAC1B,MAAO4J,GAAMgG,KAAK5P,GAGtB,IAAI+mB,IACAC,WAAa,OAAQ,QAAS,OAC9BC,aAAa,EACbC,kBAAkB,EAClBC,mBAAmB,EACnBC,oBAAoB,EAGxB5D,GAAU6D,MAAQ,SAAUta,EAAKxJ,GAC7B,IAAKwJ,GAAOA,EAAIpM,QAAU,KACtB,OAAO,CAEX,IAA+B,IAA3BoM,EAAIzL,QAAQ,WACZ,OAAO,CAEXiC,GAAUygB,EAAMzgB,EAASwjB,EACzB,IAAIO,GAAU1pB,EAAMmJ,EAAMwgB,EAAMC,EAAMC,EAAUC,EAC5CC,EAAU9Y,EAAMpD,EAAOmF,EAAMrP,CAEjC,IADAA,EAAQwL,EAAIxL,MAAM,OACdA,EAAMZ,OAAS,GAEf,GADA2mB,EAAW/lB,EAAMqmB,QAC2B,KAAxCrkB,EAAQyjB,UAAU1lB,QAAQgmB,GAC1B,OAAO,MAER,IAAI/jB,EAAQ2jB,iBACf,OAAO,CAMX,IAJAna,EAAMxL,EAAMoB,KAAK,OACjBpB,EAAQwL,EAAIxL,MAAM,KAClBwL,EAAMxL,EAAMqmB,QACZhX,EAAOrP,EAAMoB,KAAK,KACdiO,GAAQ,KAAKhB,KAAKgB,GAClB,OAAO,CAKX,IAHArP,EAAQwL,EAAIxL,MAAM,KAClBwL,EAAMxL,EAAMqmB,QACZnc,EAAQlK,EAAMoB,KAAK,KACf8I,GAAS,KAAKmE,KAAKnE,GACnB,OAAO,CAKX,IAHAlK,EAAQwL,EAAIxL,MAAM,KAClBwL,EAAMxL,EAAMqmB,QACZ/Y,EAAOtN,EAAMoB,KAAK,KACdkM,GAAQ,KAAKe,KAAKf,GAClB,OAAO,CAGX,IADAtN,EAAQwL,EAAIxL,MAAM,KACdA,EAAMZ,OAAS,IACf4mB,EAAOhmB,EAAMqmB,QACTL,EAAKjmB,QAAQ,MAAQ,GAAG,CAGxB,GAFAimB,EAAOA,EAAKhmB,MAAM,KAClB3D,EAAO2pB,EAAKK,SACP,QAAQhY,KAAKhS,GACd,OAAO,CAGX,IADAmJ,EAAOwgB,EAAK5kB,KAAK,MACZ,QAAQiN,KAAKhS,GACd,OAAO,EAOnB,MAHA6pB,GAAWlmB,EAAMoB,KAAK,KACtBpB,EAAQkmB,EAASlmB,MAAM,KACvBimB,EAAOjmB,EAAMqmB,QACTrmB,EAAMZ,SACNgnB,EAAWpmB,EAAMoB,KAAK,KACtB+kB,EAAOrB,SAASsB,EAAU,KACrB,WAAW/X,KAAK+X,IAAqB,GAARD,GAAaA,EAAO,QAC3C,EAGVlE,EAAUqE,KAAKL,IAAUhE,EAAUsE,OAAON,EAAMjkB,IACpC,cAATikB,EAGJjkB,EAAQwkB,gBACqC,KAAzCxkB,EAAQwkB,eAAezmB,QAAQkmB,IAC5B,EAEPjkB,EAAQykB,gBACqC,KAAzCzkB,EAAQykB,eAAe1mB,QAAQkmB,IAC5B,GAEJ,GAVI,GAafhE,EAAUqE,KAAO,SAAU7nB,EAAKkkB,GAE5B,GADAA,EAAUV,EAAUlV,SAAS4V,IACxBA,EACD,MAAOV,GAAUqE,KAAK7nB,EAAK,IAAMwjB,EAAUqE,KAAK7nB,EAAK,EAClD,IAAgB,MAAZkkB,EAAiB,CACxB,IAAKI,EAAU1U,KAAK5P,GAChB,OAAO,CAEX,IAAIioB,GAAQjoB,EAAIuB,MAAM,KAAK2U,KAAK,SAAUmC,EAAGvX,GACzC,MAAOuX,GAAIvX,GAEf,OAAOmnB,GAAM,IAAM,IAEvB,MAAmB,MAAZ/D,GAAmBK,EAAK3U,KAAK5P,GAGxC,IAAIkoB,IACAjB,aAAa,EACbE,mBAAmB,EACnBC,oBAAoB,EAGxB5D,GAAUsE,OAAS,SAAU9nB,EAAKuD,GAC9BA,EAAUygB,EAAMzgB,EAAS2kB,GAGrB3kB,EAAQ6jB,oBAA8C,MAAxBpnB,EAAIA,EAAIW,OAAS,KAC/CX,EAAMA,EAAImoB,UAAU,EAAGnoB,EAAIW,OAAS,GAExC,IAAIsnB,GAAQjoB,EAAIuB,MAAM,IACtB,IAAIgC,EAAQ0jB,YAAa,CACrB,GAAImB,GAAMH,EAAMI,KAChB,KAAKJ,EAAMtnB,SAAW,eAAeiP,KAAKwY,GACtC,OAAO,EAGf,IAAK,GAAIE,GAAM5nB,EAAI,EAAGA,EAAIunB,EAAMtnB,OAAQD,IAAK,CAEzC,GADA4nB,EAAOL,EAAMvnB,GACT6C,EAAQ4jB,kBAAmB,CAC3B,GAAImB,EAAKhnB,QAAQ,OAAS,EACtB,OAAO,CAEXgnB,GAAOA,EAAKvN,QAAQ,KAAM,IAE9B,IAAK,6BAA6BnL,KAAK0Y,GACnC,OAAO,CAEX,IAAgB,MAAZA,EAAK,IAAwC,MAA1BA,EAAKA,EAAK3nB,OAAS,IAClC2nB,EAAKhnB,QAAQ,QAAU,EAC3B,OAAO,EAGf,OAAO,GAGXkiB,EAAU+E,QAAU,SAAUvoB,GAC1B,MAAO6kB,GAAMjV,KAAK5P,IAGtBwjB,EAAUgF,eAAiB,SAAUxoB,GACjC,MAAO8kB,GAAalV,KAAK5P,IAG7BwjB,EAAUiF,UAAY,SAAUzoB,GAC5B,MAAO+kB,GAAQnV,KAAK5P,IAGxBwjB,EAAUkF,cAAgB,SAAU1oB,GAChC,MAAOklB,GAAYtV,KAAK5P,IAG5BwjB,EAAUmF,WAAa,SAAU3oB,GAC7B,MAAOmlB,GAASvV,KAAK5P,IAGzBwjB,EAAUoF,YAAc,SAAU5oB,GAC9B,MAAOA,KAAQA,EAAIY,eAGvB4iB,EAAUqF,YAAc,SAAU7oB,GAC9B,MAAOA,KAAQA,EAAIE,eAGvBsjB,EAAUsF,MAAQ,SAAU9oB,GACxB,MAAOglB,GAAIpV,KAAK5P,IAGpBwjB,EAAUuF,QAAU,SAAU/oB,GAC1B,MAAe,KAARA,GAAcilB,EAAMrV,KAAK5P,IAGpCwjB,EAAUwF,cAAgB,SAAUhpB,EAAKipB,GACrC,MAAOzF,GAAUyC,QAAQjmB,GAAOwjB,EAAU2C,MAAM8C,KAAS,GAG7DzF,EAAU0F,OAAS,SAAUlpB,GACzB,MAAsB,KAAfA,EAAIW,QAGf6iB,EAAU2F,SAAW,SAAUnpB,EAAKopB,EAAKvJ,GACrC,GAAIwJ,GAAiBrpB,EAAI0S,MAAM,uCAC3BmC,EAAM7U,EAAIW,OAAS0oB,EAAe1oB,MACtC,OAAOkU,IAAOuU,IAAuB,mBAARvJ,IAA8BA,GAAPhL,IAGxD2O,EAAU8F,aAAe,SAAUtpB,EAAKopB,EAAKvJ,GACzC,MAAO7f,GAAIW,QAAUyoB,IAAuB,mBAARvJ,IAAuB7f,EAAIW,QAAUkf,IAG7E2D,EAAU+F,OAAS,SAAUvpB,EAAKkkB,GAC9B,GAAI2C,GAAUrC,EAAKN,EAAUA,EAAU,MACvC,OAAO2C,IAAWA,EAAQjX,KAAK5P,IAGnCwjB,EAAUgG,OAAS,SAAUxpB,GACzB,OAAQ2F,MAAM0U,KAAK4D,MAAMje,KAG7BwjB,EAAUiG,QAAU,SAAUzpB,EAAKgmB,GAC/B,GAAIS,GAAajD,EAAUuC,OAAOC,GAAQ,GAAI3L,OAC1CqP,EAAWlG,EAAUuC,OAAO/lB,EAChC,UAAU0pB,GAAYjD,GAAciD,EAAWjD,IAGnDjD,EAAUmG,SAAW,SAAU3pB,EAAKgmB,GAChC,GAAIS,GAAajD,EAAUuC,OAAOC,GAAQ,GAAI3L,OAC1CqP,EAAWlG,EAAUuC,OAAO/lB,EAChC,OAAO0pB,IAAYjD,GAAyBA,EAAXiD,GAGrClG,EAAUoG,KAAO,SAAU5pB,EAAKuD,GAC5B,GAAI7C,EACJ,IAAgD,mBAA5C+J,OAAO4D,UAAUC,SAASC,KAAKhL,GAA+B,CAC9D,GAAIsmB,KACJ,KAAKnpB,IAAK6C,GACNsmB,EAAMnpB,GAAK8iB,EAAUlV,SAAS/K,EAAQ7C,GAE1C,OAAOmpB,GAAMvoB,QAAQtB,IAAQ,EAC1B,MAAuB,gBAAZuD,GACPA,EAAQ1B,eAAe7B,GACvBuD,GAAsC,kBAApBA,GAAQjC,QAC1BiC,EAAQjC,QAAQtB,IAAQ,GAE5B,GAGXwjB,EAAUsG,aAAe,SAAU9pB,GAC/B,GAAI+pB,GAAY/pB,EAAI+a,QAAQ,WAAY,GACxC,KAAKoJ,EAAWvU,KAAKma,GACjB,OAAO,CAGX,KAAK,GADQC,GAAOC,EAAQC,EAAxBC,EAAM,EACDzpB,EAAIqpB,EAAUppB,OAAS,EAAGD,GAAK,EAAGA,IACvCspB,EAAQD,EAAU5B,UAAUznB,EAAIA,EAAI,GACpCupB,EAAS5D,SAAS2D,EAAO,IACrBE,GACAD,GAAU,EAENE,GADAF,GAAU,GACDA,EAAS,GAAM,EAEjBA,GAGXE,GAAOF,EAEXC,GAAgBA,CAEpB,UAAWC,EAAM,KAAQ,EAAIJ,GAAY,IAG7CvG,EAAU4G,OAAS,SAAUpqB,EAAKkkB,GAE9B,GADAA,EAAUV,EAAUlV,SAAS4V,IACxBA,EACD,MAAOV,GAAU4G,OAAOpqB,EAAK,KAAOwjB,EAAU4G,OAAOpqB,EAAK,GAE9D,IACkBU,GADdqpB,EAAY/pB,EAAI+a,QAAQ,UAAW,IACnCsP,EAAW,CACf,IAAgB,OAAZnG,EAAkB,CAClB,IAAKE,EAAYxU,KAAKma,GAClB,OAAO,CAEX,KAAKrpB,EAAI,EAAO,EAAJA,EAAOA,IACf2pB,IAAa3pB,EAAI,GAAKqpB,EAAU9pB,OAAOS,EAO3C,IAJI2pB,GADwB,MAAxBN,EAAU9pB,OAAO,GACL,IAEA,GAAK8pB,EAAU9pB,OAAO,GAEjCoqB,EAAW,KAAQ,EACpB,QAASN,MAET,IAAgB,OAAZ7F,EAAkB,CAC1B,IAAKG,EAAYzU,KAAKma,GAClB,OAAO,CAEX,IAAIO,IAAW,EAAG,EAClB,KAAK5pB,EAAI,EAAO,GAAJA,EAAQA,IAChB2pB,GAAYC,EAAO5pB,EAAI,GAAKqpB,EAAU9pB,OAAOS,EAEjD,IAAIqpB,EAAU9pB,OAAO,KAAQ,GAAMoqB,EAAW,IAAO,KAAQ,EACzD,QAASN,EAGjB,OAAO,GAGXvG,EAAU+G,cAAgB,SAASvqB,EAAKwqB,GACpC,MAAIA,KAAU9E,GACHA,EAAO8E,GAAQ5a,KAAK5P,IAExB,GAGXwjB,EAAUiH,OAAS,SAAUzqB,GACzB,IACIyC,KAAKwb,MAAMje,GACb,MAAOyD,GACL,OAAO,EAEX,OAAO,GAGX+f,EAAUkH,YAAc,SAAU1qB,GAC9B,MAAOqlB,GAAUzV,KAAK5P,IAG1BwjB,EAAUmH,QAAU,SAAU3qB,GAC1B,MAAOolB,GAAMxV,KAAK5P,IAGtBwjB,EAAUoH,YAAc,SAAU5qB,GAC9B,MAAOslB,GAAU1V,KAAK5P,IAG1BwjB,EAAUqH,YAAc,SAAU7qB,GAC9B,MAAOulB,GAAU3V,KAAK5P,IAG1BwjB,EAAUsH,gBAAkB,SAAU9qB,GAClC,MAAOslB,GAAU1V,KAAK5P,IAAQulB,EAAU3V,KAAK5P,IAGjDwjB,EAAUuH,gBAAkB,SAAU/qB,GAClC,MAAOwlB,GAAc5V,KAAK5P,IAG9BwjB,EAAUwH,SAAW,SAAUhrB,GAC3B,MAAOylB,GAAO7V,KAAK5P,IAGvBwjB,EAAUyH,UAAY,SAAUjrB,GAC5B,MAAOwjB,GAAUkF,cAAc1oB,IAAuB,KAAfA,EAAIW,QAG/C6iB,EAAU0H,MAAQ,SAAUlrB,EAAKmrB,GAC7B,GAAItE,GAAUsE,EAAQ,GAAIrQ,QAAO,KAAOqQ,EAAQ,KAAM,KAAO,OAC7D,OAAOnrB,GAAI+a,QAAQ8L,EAAS,KAGhCrD,EAAU4H,MAAQ,SAAUprB,EAAKmrB,GAC7B,GAAItE,GAAUsE,EAAQ,GAAIrQ,QAAO,IAAMqQ,EAAQ,MAAO,KAAO,OAC7D,OAAOnrB,GAAI+a,QAAQ8L,EAAS,KAGhCrD,EAAU6H,KAAO,SAAUrrB,EAAKmrB,GAC5B,GAAItE,GAAUsE,EAAQ,GAAIrQ,QAAO,KAAOqQ,EAAQ,OAASA,EAAQ,MAAO,KAAO,YAC/E,OAAOnrB,GAAI+a,QAAQ8L,EAAS,KAGhCrD,EAAU8H,OAAS,SAAUtrB,GACzB,MAAQA,GAAI+a,QAAQ,KAAM,SACrBA,QAAQ,KAAM,UACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,QACdA,QAAQ,MAAO,WAGxByI,EAAU+H,SAAW,SAAUvrB,EAAKwrB,GAChC,GAAIL,GAAQK,EAAiB,gBAAmC,SAChE,OAAOhI,GAAUiI,UAAUzrB,EAAKmrB,IAGpC3H,EAAUkI,UAAY,SAAU1rB,EAAKmrB,GACjC,MAAOnrB,GAAI+a,QAAQ,GAAID,QAAO,KAAOqQ,EAAQ,KAAM,KAAM,KAG7D3H,EAAUiI,UAAY,SAAUzrB,EAAKmrB,GACjC,MAAOnrB,GAAI+a,QAAQ,GAAID,QAAO,IAAMqQ,EAAQ,KAAM,KAAM,IAG5D,IAAIQ,IACAC,WAAW,EAmCf,OAhCApI,GAAUqI,eAAiB,SAAUjiB,EAAOrG,GAExC,GADAA,EAAUygB,EAAMzgB,EAASooB,IACpBnI,EAAUnY,QAAQzB,GACnB,OAAO,CAEX,IAAIqe,GAAQre,EAAMrI,MAAM,IAAK,EAY7B,OAXA0mB,GAAM,GAAKA,EAAM,GAAGrnB,cAChB2C,EAAQqoB,YACR3D,EAAM,GAAKA,EAAM,GAAGrnB,gBAEP,cAAbqnB,EAAM,IAAmC,mBAAbA,EAAM,MAC7B1kB,EAAQqoB,YACT3D,EAAM,GAAKA,EAAM,GAAGrnB,eAExBqnB,EAAM,GAAKA,EAAM,GAAGlN,QAAQ,MAAO,IAAIxZ,MAAM,KAAK,GAClD0mB,EAAM,GAAK,aAERA,EAAMtlB,KAAK,MAatB6gB,EAAUtf,OAEHsf;;CnBhjBV,WACD,GAAIlkB,GAAiB,SAAUpC,GAE9B,GAAIqC,IAAY,MAAO,SAAU,QAAS,IAAK,MAC/CC,GAAmB,qBAAsB,2BAA4B,kBAAmB,qBAAsB,iBAC9GC,GAAkB,SAAU,UAAW,UAAW,QAAS,OAAQ,YAAa,aAAc,aAAc,UAE5GC,EAAkB,IAElBC,EAAM,SAASC,GACI,mBAAV1B,SAA0BA,OAAO2B,SAAWA,QAAQC,OAASD,QAAQC,MAAMF,IAIpFG,EAAM,SAASC,GACd,MAAOA,GAAIC,OAAO,GAAGC,cAAgBF,EAAIG,OAAO,IAIjDC,EAAMhC,SAASiC,cAAc,OAG7BC,EAAK,SAAUC,GACd,GAAIC,EAEJ,IAAID,IAAQH,GAAIK,MACf,MAAOF,EAIR,IAAW,cAARA,EAAsB,CACxB,IAAK,GAAIG,GAAI,EAAGA,EAAInB,EAASoB,OAAQD,GAAK,EAGzC,GADAF,EAAKjB,EAASmB,GAAK,aACfF,IAAMJ,GAAIK,MACb,MAAO,KAAOlB,EAASmB,GAAGE,cAAgB,YAG5C,OAAOL,GAGR,IAAK,GAAIG,GAAI,EAAGA,EAAInB,EAASoB,OAAQD,GAAK,EAEzC,GADAF,EAAKjB,EAASmB,GAAKX,EAAIQ,GACnBC,IAAMJ,GAAIK,MACb,MAAOD,EAIT,OAAOD,IAIRM,EAAsB,WACrB,GAAIC,GAAI1C,SAAS2C,MAAQ3C,SAAS4C,gBACjCC,EAAIH,EAAEL,MACNS,EAAI,YAEL,IAAmB,gBAARD,GAAEC,GAAkB,OAAO,CAGtCA,GAAIA,EAAEjB,OAAO,GAAGC,cAAgBgB,EAAEf,OAAO,EAEzC,KAAK,GAAIO,GAAE,EAAGA,EAAEnB,EAASoB,OAAQD,IAChC,GAAiC,gBAAtBO,GAAE1B,EAASmB,GAAKQ,GAAkB,OAAO,CAGrD,QAAO,GAIRC,EAAc,SAASnB,GACtB,GAAgBoB,GAAZC,EAAS,CAcb,OAbArB,IAAO,GACPA,EAAMA,EAAIY,cACe,KAAtBZ,EAAIsB,QAAQ,OACdF,EAAMpB,EAAIuB,MAAM,MAChBF,EAASG,OAAOJ,EAAI,KACU,KAArBpB,EAAIsB,QAAQ,MAErBF,EAAMpB,EAAIuB,MAAM,KAChBF,EAA0B,IAAjBG,OAAOJ,EAAI,KAEpBC,EAASG,OAAOxB,GAGVyB,KAAKC,MAAML,IAInBM,EAAgB,SAASxC,EAAKyC,GAC7B,IAAI,GAAIlB,KAAKkB,GAAWA,EAAMC,eAAenB,KAC5CvB,EAAIsB,MAAMH,EAAGI,IAAMkB,EAAMlB,KAK3BoB,EAAqB,SAASC,GAC7B,GAMCb,GAAGR,EAAGU,EAAKY,EAAMC,EANdL,GAEFM,yBAA0B,OAC1BC,mBAAoBzC,EAAkB,KACtC0C,mBAAoB,MAKtB,KAAIlB,IAAKa,GAAQ,GAAGA,EAAKF,eAAeX,GAAI,CAM3C,IALAE,EAAM,aAAerB,EAAImB,GACzBc,EAAOd,EAAEN,cACTqB,GAAQ,EAGJvB,EAAI,EAAGA,EAAIlB,EAAgBmB,OAAQD,GAAK,EAC3C,GAAGU,GAAO5B,EAAgBkB,GAAI,CAC7BkB,EAAMpC,EAAgBkB,IAAMqB,EAAKb,GACjCe,GAAQ,CACR,OAKF,IAAIvB,EAAI,EAAGA,EAAIjB,EAAekB,OAAQD,GAAK,EAC1C,GAAGsB,GAAQvC,EAAeiB,GAAI,CAC7BkB,EAAMtB,EAAG,cAAgBsB,EAAMtB,EAAG,eAAiB,GACnDsB,EAAMtB,EAAG,eAAiB,IAAKY,EAAI,IAAMa,EAAKb,GAAK,IACnDe,GAAQ,CACR,OAIEA,IACHL,EAAMV,GAAKa,EAAKb,IAGlB,MAAOU,IAKRS,EAA0B,SAASN,GAClC,GAECb,GAAGR,EAFAkB,KAGHU,EAAS,SAASV,EAAOV,EAAGqB,GAC3B,GACgB7B,GADZU,EAAMF,EAAEN,cACXqB,GAAQ,CAGT,KAAIvB,EAAI,EAAGA,EAAIjB,EAAekB,OAAQD,GAAK,EAC1C,GAAGU,GAAO3B,EAAeiB,GAAI,CAC5BkB,EAAMtB,EAAG,cAAgBsB,EAAMtB,EAAG,eAAiB,GACnDsB,EAAMtB,EAAG,eAAiB,IAAKY,EAAI,IAAMqB,EAAQ,IACjDN,GAAQ,CACR,OAIEA,QAIIL,GAAMV,GAHbU,EAAMV,GAAKqB,EAQd,KAAIrB,IAAKa,GAAQ,GAAGA,EAAKF,eAAeX,GAEvC,GAAsB,KAAnBA,EAAEI,QAAQ,KAAa,CACzB,IAAIZ,IAAKqB,GAAKb,GAASa,EAAKb,GAAGW,eAAenB,IAC7C4B,EAAOP,EAAKb,GAAIR,EAAGqB,EAAKb,GAAGR,GAE5BkB,GAAMV,GAAKa,EAAKb,OAEhBoB,GAAOV,EAAOV,EAAGa,EAAKb,GAIxB,OAAOU,IAaRY,EAAU,SAASZ,GAClB,MAAO,MAAQa,KAAKC,UAAUd,GAAOL,MAAM,YAAYoB,KAAK,KAE7DC,KAGAC,EAAWhC,GAGX3D,GAAE4F,kBAAoB,SAASC,EAAIhB,EAAMiB,GACxCD,EAAGtC,MAAQsC,EAAGtC,SACd,IAAsCwC,GAAlCrB,EAAQE,EAAmBC,EAG9BH,GAAMO,mBADgC,mBAA7BP,GAAMO,mBACYhB,EAAYS,EAAMO,oBAAsB,KAExCzC,EAAkB,KAG9CuD,EAAO9B,EAAYS,EAAMO,qBAAuB,EAG7CU,EACFlB,EAAcoB,EAAInB,GAIF,mBAANsB,IAAqBA,EAAEC,IAAMD,EAAEC,GAAG7F,SAC3C4F,EAAEH,GAAIzF,QAAQsE,EAAOqB,GAIpBD,GACFI,WAAWJ,EAAIC,EAAK,IAKtB/F,EAAEmG,QAAU,SAASC,EAAMf,EAAOgB,EAASP,GAC1CO,EAAUA,KACV,IAAIC,GAAMZ,EAAWU,EACrB,OAAIE,GAIG,SAASC,GACf,GAAI1B,GAAOyB,EAAIL,GAAG,WACjB,MAAuB,kBAATZ,GAAqBA,IAASA,GAI7C,KAAI7B,IAAK6C,GAAYA,EAAQ1B,eAAenB,KAC3CqB,EAAKrB,GAAK6C,EAAQ7C,GAGnBxD,GAAE4F,kBAAkBW,EAAEC,OAAQ3B,EAAMiB,IAb7BrD,EAAI,aAAe2D,EAAO,gBAkBnCpG,EAAEyG,aAAe,SAASL,EAAMH,EAAII,GAGnC,MAFAA,GAAUA,MAEPX,EAAWU,GACN3D,EAAI,aAAe2D,EAAO,qBACV,kBAAPH,GACTxD,EAAI,aAAe2D,EAAO,8EAGlCC,EAAQK,SAAWL,EAAQK,UAAYlE,EAEvCkD,EAAWU,IACVC,QAASA,EACTJ,GAAIA,OAILjG,GAAE2G,WAAWP,EAAM,SAAS/C,GAC3BrD,EAAE4G,cAAcR,EAAMS,KAAMZ,EAAI5C,KAC9B,KAGJrD,EAAE8G,eAAiB,SAASV,EAAMW,EAAKV,GAGtC,GAFAA,EAAUA,MAEPX,EAAWU,GACb,MAAO3D,GAAI,aAAe2D,EAAO,oBAGlC,IAAIY,GAAO,SAAStC,GACnB,GAECuC,GAFGC,EAAQ5B,EAAQZ,GACnByC,EAASjG,SAASC,eAAe+F,EAIlC,KAAIC,EAAQ,CACXzB,EAAWU,GAAMgB,GAAKF,EAEtBxC,EAAQS,EAAwBT,GAEhCuC,EAAK7D,EAAG,cAAgB,IAAM8D,EAAQ,IAAM3B,KAAKC,UAAUd,GACzDL,MAAM,KAAMoB,KAAK,IACjBpB,MAAM,MAAMoB,KAAK,OACjBpB,MAAM,KAAKoB,KAAK,KAChBpB,MAAM,MAAMoB,KAAK,KAEnB,IAAI1B,GAAI7C,SAASiC,cAAc,QAC/BY,GAAEsD,aAAa,KAAMH,GACrBnD,EAAEqD,GAAKF,EACPnD,EAAEuD,YAAcL,EAEhB/F,SAASqG,KAAKC,YAAYzD,GAG3B2B,EAAWU,GAAMqB,eAAgB,EACjC/B,EAAWU,GAAMC,QAAQqB,oBAAqB,EAG/CrB,GAAQK,SAAWL,EAAQK,UAAYlE,EACvC6D,EAAQqB,mBAAqBrB,EAAQqB,qBAAsB,EAE3DhC,EAAWU,IACVY,KAAMA,EACNX,QAASA,EACTU,IAAKA,GAIN/G,EAAE2G,WAAWP,EAAM,SAAS/C,GAC3BrD,EAAE4G,cAAcR,EAAMS,KAAME,EAAK1D,KAC/B,IAgBJrD,EAAE2H,UAAY,SAASvB,EAAMP,EAAIQ,EAASP,GACzCO,EAAUA,KACV,IAA4B7C,GAAxB8C,EAAMZ,EAAWU,GAAU1B,IAC/B,KAAI4B,EACH,MAAO7D,GAAI,aAAe2D,EAAO,cAIlCE,GAAID,QAAUC,EAAID,WAClB,KAAI7C,IAAK6C,GAAYA,EAAQ1B,eAAenB,KAC3C8C,EAAID,QAAQ7C,GAAK6C,EAAQ7C,KAGtB8C,EAAImB,eAAiBnB,EAAIU,MAC5BV,EAAIU,KAAKV,EAAIS,IAId,KAAIvD,IAAK8C,GAAID,QAAYC,EAAID,QAAQ1B,eAAenB,KACnDkB,EAAMtB,EAAG,YAAcP,EAAIW,KAAO8C,EAAID,QAAQ7C,GAI/CkB,GAAMtB,EAAG,kBAAoBkD,EAAIc,GACjC1C,EAAMtB,EAAG,uBAAyBsB,EAAMtB,EAAG,sBAAuBsB,EAAMtB,EAAG,sBAAuBZ,GAAmB,KACrHkC,EAAMtB,EAAG,mBAAqBsB,EAAMtB,EAAG,mBAAoBsB,EAAMtB,EAAG,sBAAwB,KAAMwE,OAClGlD,EAAMtB,EAAG,sBAAwBsB,EAAMtB,EAAG,uBAAyB,WAEnEyC,EAAGtC,MAAQsC,EAAGtC,SAGd,IAAIsE,GAAS,WAEZhC,EAAGiC,oBAAoB,eAAgBD,GAAQ,GAC5C/B,GACFA,EAAGD,GAKLA,GAAGtC,MAAMH,EAAG,cAAgB,GAC5ByC,EAAGtC,MAAMH,EAAG,kBAAoB,GAIhC2E,sBAAsB,WACrBA,sBAAsB,WAErB,IAAIvE,IAAKkB,GAAUA,EAAMC,eAAenB,KACvCqC,EAAGtC,MAAMC,GAAKkB,EAAMlB,GAGrBqC,GAAGmC,iBAAiB,eAAgBH,GAAQ,QAK/C7H,EAAEiI,UAAY,SAAS7B,EAAMC,GAC5B,MAAO,YACNrG,EAAE2H,UAAUvB,EAAMS,KAAMR,KAI1BrG,EAAE4G,cAAgB,SAASR,EAAMP,EAAIQ,EAAShD,GAC7C,GAAIiD,GAAMZ,EAAWU,EAErB,KAAIE,IAAQA,EAAIF,KACf,MAAO3D,GAAI,aAAe2D,EAAO,cAGlC,IAAGE,EAAIL,GACNjG,EAAE4F,kBAAkBC,EAAIS,EAAIL,GAAG5C,QACzB,CACN,GAAI6E,GAAYrC,EAAGsC,MACnBtC,GAAGsC,OAAS,SAAStC,EAAIuC,IACpB9B,EAAImB,eAAiBnB,EAAIU,MAC5BV,EAAIU,KAAKX,GAEPhD,KAAU+E,GACZpI,EAAE2H,UAAUvB,EAAMP,EAAIQ,GAEpB6B,GACFA,EAAUG,MAAMxC,EAAIyC,aASxB,IASmE9E,GAT/D+E,GAAiB,QAAS,SAAU,SAAU,YAAa,aAAc,aAC5E,SAAU,kBAAmB,qBAAsB,oBACnD,oBAAqB,kBAAmB,kBAAmB,mBAC3D,mBAAoB,gBAAiB,iBAAkB,iBAAkB,SACzE,OAAQ,QAAS,WAAY,aAAc,SAAU,OAAQ,gBAC7D,aAAc,eAAgB,aAAc,cAAe,YAAa,YACxE,WAAY,YAAa,WAAY,UAAW,eAAgB,eAChE,gBAAiB,cAAe,eAAgB,aAAc,QAAS,aACvE,aAAc,MAAO,gBAAiB,aAAc,QAAS,cAAe,UAC5EC,GAAe,SAAU,UAAW,UAAW,QAAS,QAGzD,KAAIhF,EAAI,EAAGA,EAAI+E,EAAc9E,OAAQD,GAAK,GACxC,SAAS4C,GACTpG,EAAEyG,aAAaL,EAAM,SAAS/C,GAC7B,GAAIgD,KAEJ,OADAA,GAAQD,GAAQ/C,IACTgD,KAEPkC,EAAc/E,GAIjB,KAAIA,EAAI,EAAGA,EAAIgF,EAAY/E,OAAQD,GAAK,GACtC,SAAS4C,GACTpG,EAAEyG,aAAaL,EAAM,SAAS/C,GAC7B,GAAIgD,MAAchB,EAAQhC,GAE1B,OADAgD,GAAQD,GAAQqC,MAAMpD,GAAQA,EAAOA,EAAQ,MACtCgB,KAEPmC,EAAYhF,GAIfxD,GAAEyG,aAAa,OAAQ,SAASpD,GAC/B,GAAIgC,GAAQhC,GACZ,QACCqF,MACCrD,EAAM,IAAMoD,MAAMpD,EAAM,IAAK,GAAG,OAChCA,EAAM,IAAMoD,MAAMpD,EAAM,IAAK,GAAG,WAQnCrF,EAAIA,MAEJA,EAAE2G,WAAW,OAAQ,SAAStD,GAC7BwD,KAAKtD,OACJoF,QAAS3I,EAAE4I,OAAOvF,GAAO,OAAS,MAEjC,GAGHrD,EAAE2G,WAAW,SAAU,SAAStD,GAC/BwD,KAAKgC,QAAU,WACd,GAAIxD,GAAQhC,GACZA,IAAMgC,MAEL,GAGHrF,EAAE2G,WAAW,QAAS,SAAStD,GAC9BwD,KAAKiC,YAAczF,EAAK,GACrBA,EAAK,KACPwD,KAAKkC,WAAa1F,EAAK,MAEtB,GAWiB,oBAAV2F,SAAoC,OAAXA,QAAmBA,OAAOC,QAC7DD,OAAOC,QAAU7G,EACW,kBAAX8G,SAAyBA,OAAOC,IACjDD,OAAO,WACN,MAAO9G,KAGRA,EAAgC,mBAAVpB,QAAuBA,OAAOhB;;AWrgBrDgJ,OAAOC,QAAU,SAASiB,GAEzB,GAAIsI,GAA6B,mBAAdC,WAA4B,mBAAmBC,KAAKD,UAAUE,WAAazR,SAAS4C,gBAAkB5C,SAAS2C,KAAM,KACvI+O,EAAgB,SAAUC,EAAGjP,EAAGgK,EAAGkF,GAElC,OAAQlF,EAAE,GAAKrJ,KAAKwO,IAAIxO,KAAKyO,GAAGH,EAAEC,GAAK,GAAKlP,EAG9C,OAAO,UAASqP,EAASC,GACpBA,GACHD,EAAQjL,iBAAiB,QAAS,SAASzB,GAC1C,GAAI4M,GACHC,EAAWZ,EAAKa,UAChBC,EAASpS,SAASC,eAAe,SAASoS,KAAK1M,KAAK0D,MAAM,IAAIiJ,wBAAwBC,IACtFC,EAAO7M,KAAK0D,KAAKtH,OAAO4D,KAAK0D,KAAK+E,YAAY,MAC9CqE,EAAYnB,EAAKoB,aAAe5S,OAAO6S,YACvCC,EAAsCH,EAApBP,EAAWE,EAAqBA,EAAQK,EAAYP,EACtE1M,EAAoC,mBAAlBwD,GAAKxD,SAA0BwD,EAAKxD,SAAU,KAChEqN,EAAa,SAASC,GACrBb,EAAYA,GAAaa,CACzB,IAAIC,GAAUD,EAAYb,EACzBe,EAAWtB,EAAcqB,EAASb,EAAUU,EAAgBpN,EAC7D8L,GAAKa,UAAYa,EACJxN,EAAVuN,EACFlM,sBAAsBgM,GAEnBI,QAAQC,UACVD,QAAQC,UAAU,KAAM,KAAMV,GAE9BW,SAASX,KAAOA,EAMpB3L,uBAAsBgM,GACtBxN,EAAE4E;;ACtCNnC,OAAOC,QAAU,WAAY,OAAQqL,SAAS,qyNAAy1NC,kBAAkB,ovBAA4vBC,4CAA4C,o/OAAwgPC,yBAAyB,wjZAAkoZC,qBAAqB,y0KAAq5KC,WAAW,0/CAA0hDC,UAAU,qjBAA6kBC,oBAAoB,0+mBAAkonBC,cAAc;;;AFC9iuD9L,OAAOC,QAAU,SAASjJ,GACzB,GAAI6R,GAAe,SAAS9D,GAC3B,GAAIvK,GAAGW,IACP,KAAIX,IAAKuK,GAAWA,EAAMpJ,eAAenB,IAC/B,YAANA,IACM,MAALA,EACFW,EAAY,IAAwB,kBAAZ4J,GAAMvK,GAAmBuK,EAAMvK,KAAMuK,EAAMvK,GAEnEW,EAAOX,GAAyB,kBAAZuK,GAAMvK,GAAmBuK,EAAMvK,KAAMuK,EAAMvK,GAIlE,OAAOW,GAER,QACDkM,KAAQ,SAASxL,EAAMwB,GACtBxB,EAAOA,MACPwB,EAAUA,KACV,IAAIyL,IACFC,OAAO,OACPlC,IAAK,2BACLxC,KAAMxI,GAEPmN,EAAW9Q,SAAS4C,iBAAmB5C,SAAS2C,IACjD,KAAI,GAAIL,KAAK6C,GAAaA,EAAQ1B,eAAenB,KAChDsO,EAAWtO,GAAK6C,EAAQ7C,GAEtBqB,GAAKkJ,QACNlJ,EAAKkJ,MAAQ8D,EAAahN,EAAKkJ,QAEjCiE,EAASC,WAAa,UACtB,IAAIC,GAAalS,EAAEmS,UAQnB,OAPAnS,GAAEoS,QAAQN,GAAY5G,KAAK,WAC1B8G,EAASC,UAAYD,EAASC,UAAU5N,MAAM,YAAYoB,KAAK,IAC/DyM,EAAWG,QAAQhK,MAAMxB,KAAMyB,WAC5BwJ,EAAWxB,YACbtQ,EAAEsS,QAAO,KAGJJ,EAAWK,SAEnBzF,KAAQ,SAASjI,EAAMwB,GACtBxB,EAAOA,MACPwB,EAAUA,KACV,IAAIyL,IACFC,OAAO,OACPlC,IAAK,2BACLxC,KAAMxI,GAEPmN,EAAW9Q,SAAS4C,iBAAmB5C,SAAS2C,IACjD,KAAI,GAAIL,KAAK6C,GAAaA,EAAQ1B,eAAenB,KAChDsO,EAAWtO,GAAK6C,EAAQ7C,GAEtBqB,GAAKkJ,QACNlJ,EAAKkJ,MAAQ8D,EAAahN,EAAKkJ,QAEjCiE,EAASC,WAAa,UACtB,IAAIC,GAAalS,EAAEmS,UAQnB,OAPAnS,GAAEoS,QAAQN,GAAY5G,KAAK,WAC1B8G,EAASC,UAAYD,EAASC,UAAU5N,MAAM,YAAYoB,KAAK,IAC/DyM,EAAWG,QAAQhK,MAAMxB,KAAMyB,WAC5BwJ,EAAWxB,YACbtQ,EAAEsS,QAAO,KAGJJ,EAAWK,SAEnBxF,OAAU,SAASlI,EAAMwB,GACxBxB,EAAOA,MACPwB,EAAUA,KACV,IAAIyL,IACFC,OAAO,OACPlC,IAAK,6BACLxC,KAAMxI,GAEPmN,EAAW9Q,SAAS4C,iBAAmB5C,SAAS2C,IACjD,KAAI,GAAIL,KAAK6C,GAAaA,EAAQ1B,eAAenB,KAChDsO,EAAWtO,GAAK6C,EAAQ7C,GAEtBqB,GAAKkJ,QACNlJ,EAAKkJ,MAAQ8D,EAAahN,EAAKkJ,QAEjCiE,EAASC,WAAa,UACtB,IAAIC,GAAalS,EAAEmS,UAQnB,OAPAnS,GAAEoS,QAAQN,GAAY5G,KAAK,WAC1B8G,EAASC,UAAYD,EAASC,UAAU5N,MAAM,YAAYoB,KAAK,IAC/DyM,EAAWG,QAAQhK,MAAMxB,KAAMyB,WAC5BwJ,EAAWxB,YACbtQ,EAAEsS,QAAO,KAGJJ,EAAWK,SAEnBrC,aAAgB,SAASrL,EAAMwB,GAC9BxB,EAAOA,MACPwB,EAAUA,KACV,IAAIyL,IACFC,OAAO,OACPlC,IAAK,mCACLxC,KAAMxI,GAEPmN,EAAW9Q,SAAS4C,iBAAmB5C,SAAS2C,IACjD,KAAI,GAAIL,KAAK6C,GAAaA,EAAQ1B,eAAenB,KAChDsO,EAAWtO,GAAK6C,EAAQ7C,GAEtBqB,GAAKkJ,QACNlJ,EAAKkJ,MAAQ8D,EAAahN,EAAKkJ,QAEjCiE,EAASC,WAAa,UACtB,IAAIC,GAAalS,EAAEmS,UAQnB,OAPAnS,GAAEoS,QAAQN,GAAY5G,KAAK,WAC1B8G,EAASC,UAAYD,EAASC,UAAU5N,MAAM,YAAYoB,KAAK,IAC/DyM,EAAWG,QAAQhK,MAAMxB,KAAMyB,WAC5BwJ,EAAWxB,YACbtQ,EAAEsS,QAAO,KAGJJ,EAAWK,SAEnBzR,MAAS,SAAS+D,EAAMwB,GACvBxB,EAAOA,MACPwB,EAAUA,KACV,IAAIyL,IACFC,OAAO,OACPlC,IAAK,4BACLxC,KAAMxI,GAEPmN,EAAW9Q,SAAS4C,iBAAmB5C,SAAS2C,IACjD,KAAI,GAAIL,KAAK6C,GAAaA,EAAQ1B,eAAenB,KAChDsO,EAAWtO,GAAK6C,EAAQ7C,GAEtBqB,GAAKkJ,QACNlJ,EAAKkJ,MAAQ8D,EAAahN,EAAKkJ,QAEjCiE,EAASC,WAAa,UACtB,IAAIC,GAAalS,EAAEmS,UAQnB,OAPAnS,GAAEoS,QAAQN,GAAY5G,KAAK,WAC1B8G,EAASC,UAAYD,EAASC,UAAU5N,MAAM,YAAYoB,KAAK,IAC/DyM,EAAWG,QAAQhK,MAAMxB,KAAMyB,WAC5BwJ,EAAWxB,YACbtQ,EAAEsS,QAAO,KAGJJ,EAAWK,SAEnBtH,OAAU,SAASpG,EAAMwB,GACxBxB,EAAOA,MACPwB,EAAUA,KACV,IAAIyL,IACFC,OAAO,OACPlC,IAAK,6BACLxC,KAAMxI,GAEPmN,EAAW9Q,SAAS4C,iBAAmB5C,SAAS2C,IACjD,KAAI,GAAIL,KAAK6C,GAAaA,EAAQ1B,eAAenB,KAChDsO,EAAWtO,GAAK6C,EAAQ7C,GAEtBqB,GAAKkJ,QACNlJ,EAAKkJ,MAAQ8D,EAAahN,EAAKkJ,QAEjCiE,EAASC,WAAa,UACtB,IAAIC,GAAalS,EAAEmS,UAQnB,OAPAnS,GAAEoS,QAAQN,GAAY5G,KAAK,WAC1B8G,EAASC,UAAYD,EAASC,UAAU5N,MAAM,YAAYoB,KAAK,IAC/DyM,EAAWG,QAAQhK,MAAMxB,KAAMyB,WAC5BwJ,EAAWxB,YACbtQ,EAAEsS,QAAO,KAGJJ,EAAWK,SAEnBnF,UAAa,SAASvI,EAAMwB,GAC3BxB,EAAOA,MACPwB,EAAUA,KACV,IAAIyL,IACFC,OAAO,OACPlC,IAAK,gCACLxC,KAAMxI,GAEPmN,EAAW9Q,SAAS4C,iBAAmB5C,SAAS2C,IACjD,KAAI,GAAIL,KAAK6C,GAAaA,EAAQ1B,eAAenB,KAChDsO,EAAWtO,GAAK6C,EAAQ7C,GAEtBqB,GAAKkJ,QACNlJ,EAAKkJ,MAAQ8D,EAAahN,EAAKkJ,QAEjCiE,EAASC,WAAa,UACtB,IAAIC,GAAalS,EAAEmS,UAQnB,OAPAnS,GAAEoS,QAAQN,GAAY5G,KAAK,WAC1B8G,EAASC,UAAYD,EAASC,UAAU5N,MAAM,YAAYoB,KAAK,IAC/DyM,EAAWG,QAAQhK,MAAMxB,KAAMyB,WAC5BwJ,EAAWxB,YACbtQ,EAAEsS,QAAO,KAGJJ,EAAWK,SAEnBzE,SAAY,SAASjJ,EAAMwB,GAC1BxB,EAAOA,MACPwB,EAAUA,KACV,IAAIyL,IACFC,OAAO,OACPlC,IAAK,+BACLxC,KAAMxI,GAEPmN,EAAW9Q,SAAS4C,iBAAmB5C,SAAS2C,IACjD,KAAI,GAAIL,KAAK6C,GAAaA,EAAQ1B,eAAenB,KAChDsO,EAAWtO,GAAK6C,EAAQ7C,GAEtBqB,GAAKkJ,QACNlJ,EAAKkJ,MAAQ8D,EAAahN,EAAKkJ,QAEjCiE,EAASC,WAAa,UACtB,IAAIC,GAAalS,EAAEmS,UAQnB,OAPAnS,GAAEoS,QAAQN,GAAY5G,KAAK,WAC1B8G,EAASC,UAAYD,EAASC,UAAU5N,MAAM,YAAYoB,KAAK,IAC/DyM,EAAWG,QAAQhK,MAAMxB,KAAMyB,WAC5BwJ,EAAWxB,YACbtQ,EAAEsS,QAAO,KAGJJ,EAAWK;;AI7NnBvJ,OAAOC,QAAU,SAASjJ,GACzB,GAAI6R,GAAe,SAAS9D,GAC3B,GAAIvK,GAAGW,IACP,KAAIX,IAAKuK,GAAWA,EAAMpJ,eAAenB,IAC/B,YAANA,IACM,MAALA,EACFW,EAAY,IAAwB,kBAAZ4J,GAAMvK,GAAmBuK,EAAMvK,KAAMuK,EAAMvK,GAEnEW,EAAOX,GAAyB,kBAAZuK,GAAMvK,GAAmBuK,EAAMvK,KAAMuK,EAAMvK,GAIlE,OAAOW,GAER,QACDkM,KAAQ,SAASxL,EAAMwB,GACtBxB,EAAOA,MACPwB,EAAUA,KACV,IAAIyL,IACFC,OAAO,OACPlC,IAAK,uBACLxC,KAAMxI,GAEPmN,EAAW9Q,SAAS4C,iBAAmB5C,SAAS2C,IACjD,KAAI,GAAIL,KAAK6C,GAAaA,EAAQ1B,eAAenB,KAChDsO,EAAWtO,GAAK6C,EAAQ7C,GAEtBqB,GAAKkJ,QACNlJ,EAAKkJ,MAAQ8D,EAAahN,EAAKkJ,QAEjCiE,EAASC,WAAa,UACtB,IAAIC,GAAalS,EAAEmS,UAQnB,OAPAnS,GAAEoS,QAAQN,GAAY5G,KAAK,WAC1B8G,EAASC,UAAYD,EAASC,UAAU5N,MAAM,YAAYoB,KAAK,IAC/DyM,EAAWG,QAAQhK,MAAMxB,KAAMyB,WAC5BwJ,EAAWxB,YACbtQ,EAAEsS,QAAO,KAGJJ,EAAWK,SAEnBzF,KAAQ,SAASjI,EAAMwB,GACtBxB,EAAOA,MACPwB,EAAUA,KACV,IAAIyL,IACFC,OAAO,OACPlC,IAAK,uBACLxC,KAAMxI,GAEPmN,EAAW9Q,SAAS4C,iBAAmB5C,SAAS2C,IACjD,KAAI,GAAIL,KAAK6C,GAAaA,EAAQ1B,eAAenB,KAChDsO,EAAWtO,GAAK6C,EAAQ7C,GAEtBqB,GAAKkJ,QACNlJ,EAAKkJ,MAAQ8D,EAAahN,EAAKkJ,QAEjCiE,EAASC,WAAa,UACtB,IAAIC,GAAalS,EAAEmS,UAQnB,OAPAnS,GAAEoS,QAAQN,GAAY5G,KAAK,WAC1B8G,EAASC,UAAYD,EAASC,UAAU5N,MAAM,YAAYoB,KAAK,IAC/DyM,EAAWG,QAAQhK,MAAMxB,KAAMyB,WAC5BwJ,EAAWxB,YACbtQ,EAAEsS,QAAO,KAGJJ,EAAWK,SAEnBxF,OAAU,SAASlI,EAAMwB,GACxBxB,EAAOA,MACPwB,EAAUA,KACV,IAAIyL,IACFC,OAAO,OACPlC,IAAK,yBACLxC,KAAMxI,GAEPmN,EAAW9Q,SAAS4C,iBAAmB5C,SAAS2C,IACjD,KAAI,GAAIL,KAAK6C,GAAaA,EAAQ1B,eAAenB,KAChDsO,EAAWtO,GAAK6C,EAAQ7C,GAEtBqB,GAAKkJ,QACNlJ,EAAKkJ,MAAQ8D,EAAahN,EAAKkJ,QAEjCiE,EAASC,WAAa,UACtB,IAAIC,GAAalS,EAAEmS,UAQnB,OAPAnS,GAAEoS,QAAQN,GAAY5G,KAAK,WAC1B8G,EAASC,UAAYD,EAASC,UAAU5N,MAAM,YAAYoB,KAAK,IAC/DyM,EAAWG,QAAQhK,MAAMxB,KAAMyB,WAC5BwJ,EAAWxB,YACbtQ,EAAEsS,QAAO,KAGJJ,EAAWK,SAEnBrC,aAAgB,SAASrL,EAAMwB,GAC9BxB,EAAOA,MACPwB,EAAUA,KACV,IAAIyL,IACFC,OAAO,OACPlC,IAAK,+BACLxC,KAAMxI,GAEPmN,EAAW9Q,SAAS4C,iBAAmB5C,SAAS2C,IACjD,KAAI,GAAIL,KAAK6C,GAAaA,EAAQ1B,eAAenB,KAChDsO,EAAWtO,GAAK6C,EAAQ7C,GAEtBqB,GAAKkJ,QACNlJ,EAAKkJ,MAAQ8D,EAAahN,EAAKkJ,QAEjCiE,EAASC,WAAa,UACtB,IAAIC,GAAalS,EAAEmS,UAQnB,OAPAnS,GAAEoS,QAAQN,GAAY5G,KAAK,WAC1B8G,EAASC,UAAYD,EAASC,UAAU5N,MAAM,YAAYoB,KAAK,IAC/DyM,EAAWG,QAAQhK,MAAMxB,KAAMyB,WAC5BwJ,EAAWxB,YACbtQ,EAAEsS,QAAO,KAGJJ,EAAWK;;ADrHnBvJ,OAAOC,QAAU,SAASjJ,GACzB,GAAI6R,GAAe,SAAS9D,GAC3B,GAAIvK,GAAGW,IACP,KAAIX,IAAKuK,GAAWA,EAAMpJ,eAAenB,IAC/B,YAANA,IACM,MAALA,EACFW,EAAY,IAAwB,kBAAZ4J,GAAMvK,GAAmBuK,EAAMvK,KAAMuK,EAAMvK,GAEnEW,EAAOX,GAAyB,kBAAZuK,GAAMvK,GAAmBuK,EAAMvK,KAAMuK,EAAMvK,GAIlE,OAAOW,GAER,QACD4Q,IAAO,SAASlQ,EAAMwB,GACrBxB,EAAOA,MACPwB,EAAUA,KACV,IAAIyL,IACFC,OAAO,OACPlC,IAAK,mBACLxC,KAAMxI,GAEPmN,EAAW9Q,SAAS4C,iBAAmB5C,SAAS2C,IACjD,KAAI,GAAIL,KAAK6C,GAAaA,EAAQ1B,eAAenB,KAChDsO,EAAWtO,GAAK6C,EAAQ7C,GAEtBqB,GAAKkJ,QACNlJ,EAAKkJ,MAAQ8D,EAAahN,EAAKkJ,QAEjCiE,EAASC,WAAa,UACtB,IAAIC,GAAalS,EAAEmS,UAQnB,OAPAnS,GAAEoS,QAAQN,GAAY5G,KAAK,WAC1B8G,EAASC,UAAYD,EAASC,UAAU5N,MAAM,YAAYoB,KAAK,IAC/DyM,EAAWG,QAAQhK,MAAMxB,KAAMyB,WAC5BwJ,EAAWxB,YACbtQ,EAAEsS,QAAO,KAGJJ,EAAWK,SAEnByC,IAAO,SAASnQ,EAAMwB,GACrBxB,EAAOA,MACPwB,EAAUA,KACV,IAAIyL,IACFC,OAAO,OACPlC,IAAK,mBACLxC,KAAMxI,GAEPmN,EAAW9Q,SAAS4C,iBAAmB5C,SAAS2C,IACjD,KAAI,GAAIL,KAAK6C,GAAaA,EAAQ1B,eAAenB,KAChDsO,EAAWtO,GAAK6C,EAAQ7C,GAEtBqB,GAAKkJ,QACNlJ,EAAKkJ,MAAQ8D,EAAahN,EAAKkJ,QAEjCiE,EAASC,WAAa,UACtB,IAAIC,GAAalS,EAAEmS,UAQnB,OAPAnS,GAAEoS,QAAQN,GAAY5G,KAAK,WAC1B8G,EAASC,UAAYD,EAASC,UAAU5N,MAAM,YAAYoB,KAAK,IAC/DyM,EAAWG,QAAQhK,MAAMxB,KAAMyB,WAC5BwJ,EAAWxB,YACbtQ,EAAEsS,QAAO,KAGJJ,EAAWK;;AdlEqE,GAAIvS,GAAIC,QAAQ,WAAeC,UAAYD,QAAQ,qBAAqBD,GAAOG,SAAWF,QAAQ,oBAAoBD,GAAOI,QAAUH,QAAQ,mCAAmCD,GAAOK,YAAcJ,QAAQ,iCAAqCK,OAASL,QAAQ,oBAAwBM,SAAW,SAASC,GAAoB,MAAOA,IAAYC,iBAAuBC,KAAOT,QAAQ,kBACldU,KAAOV,QAAQ,kBACfW,IAAMX,QAAQ,iBAEdY,MAAQZ,QAAQ,mBAChBa,MAAQb,QAAQ,mBAChBc,KAAOd,QAAQ,iBAEE,oBAAXe,UAA0BA,OAAOhB,EAAIA,GAAIA,EAAEQ,MAAMS,KAAO,WAAWjB,EAAEQ,MAAMU,SAASC,eAAe,sBAAuB,KAAMC,aAAcb,SAASG,KAAAA,OAAU,YAC3KW,IAAKd,SAASI,KAAKW,MAAO,cAC1BC,eAAgBhB,SAASK,IAAIY,KAAM,YACnCC,QAASlB,SAASK,IAAIU,MAAO,aAC7BI,mBAAoBnB,SAASM,MAAMW,KAAM,cACzCG,SAAUpB,SAASO,MAAMQ,MAAO,eAChCM,SAAUrB,SAASQ,KAAKO,MAAO,cAC/BO,iBAAkBtB,SAASG,KAAKc,KAAM,aACtCM,SAAUvB,SAASG,KAAKY,MAAO,gBAAgBS,WAAWC,aAAe,SAASC,GAAMjC,EAAEkC,OAAOhB,SAASC,eAAe,kBAAmBb,OAAO6B,eAAeJ,WAAYE,GAAOF,eAAgBA,WAAWC;;AEbhN,GAAIoH,MAAOnJ,QAAQ,kCAClBoJ,QAAU,SAASC,EAAWC,GAC7B,GAAIF,IAAU,CAEd,OAAgB,KAAbC,GACK,GAGRF,KAAKI,KAAKF,EAAW,SAASG,GAC7BA,EAAgC,gBAAbA,GAAwBA,GAAWA,GAEtDL,KAAKI,KAAKD,EAAO,SAASG,GACzB,MAAGD,IAAYC,GACdL,GAAU,GACH,GAFR,WAMKA,GAKTL,QAAOC,QAAQU,IAAM,SAAStJ,EAAauJ,EAAYN,GAMtD,GAAIO,IAAO,CAYX,OATGxJ,IAAeiJ,IACdjJ,EAAYyJ,OACdD,GAASR,QAAQ3I,KAAK6I,MAAOlJ,EAAYyJ,OAEvCzJ,EAAY0J,QACdF,EAAOR,QAAQ3I,KAAK6I,MAAOlJ,EAAY0J,SAIlCF,GAMRb,OAAOC,QAAQe,IAAM,SAAS3J,EAAauJ,EAAYN,GAMtD,GAAIO,IAAO,CAYX,OATGxJ,IAAeiJ,IACdjJ,EAAYyJ,OACdD,GAASR,QAAQ3I,KAAK6I,MAAOlJ,EAAYyJ,OAEvCzJ,EAAY0J,QACdF,EAAOR,QAAQ3I,KAAK6I,MAAOlJ,EAAY0J,SAIlCF","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/* NOTE: This is a generated file, please do not modify it, your changes will be lost */var m = require('mithril');var sugartags = require('mithril.sugartags')(m);var bindings = require('mithril.bindings')(m);var animate = require('../public/js/mithril.animate.js')(m);var permissions = require('../system/miso.permissions.js');var layout = require('../mvc/layout.js');var restrict = function(route, actionName){\treturn route;};var permissionObj = {};var user = require('../mvc/user.js');\nvar home = require('../mvc/home.js');\nvar doc = require('../mvc/doc.js');\n\nvar hello = require('../mvc/hello.js');\nvar login = require('../mvc/login.js');\nvar todo = require('../mvc/todo.js');\n\nif(typeof window !== 'undefined') {\twindow.m = m;}\tm.route.mode = 'pathname';m.route(document.getElementById('misoAttachmentNode'), '/', {'/users/new': restrict(user.new, 'user.new'),\n'/': restrict(home.index, 'home.index'),\n'/doc/:doc_id': restrict(doc.edit, 'doc.edit'),\n'/docs': restrict(doc.index, 'doc.index'),\n'/hello/:hello_id': restrict(hello.edit, 'hello.edit'),\n'/login': restrict(login.index, 'login.index'),\n'/todos': restrict(todo.index, 'todo.index'),\n'/user/:user_id': restrict(user.edit, 'user.edit'),\n'/users': restrict(user.index, 'user.index')});misoGlobal.renderHeader = function(obj){\tm.render(document.getElementById('misoHeaderNode'), layout.headerContent({misoGlobal: obj || misoGlobal}));};misoGlobal.renderHeader();","/*\n\tmithril.animate - Copyright 2014 jsguy\n\tMIT Licensed.\n*/\n(function(){\nvar mithrilAnimate = function (m) {\n\t//\tKnown prefiex\n\tvar prefixes = ['Moz', 'Webkit', 'Khtml', 'O', 'ms'],\n\ttransitionProps = ['TransitionProperty', 'TransitionTimingFunction', 'TransitionDelay', 'TransitionDuration', 'TransitionEnd'],\n\ttransformProps = ['rotate', 'rotatex', 'rotatey', 'scale', 'skew', 'translate', 'translatex', 'translatey', 'matrix'],\n\n\tdefaultDuration = 400,\n\n\terr = function(msg){\n\t\t(typeof window != \"undefined\") && window.console && console.error && console.error(msg);\n\t},\n\t\n\t//\tCapitalise\t\t\n\tcap = function(str){\n\t\treturn str.charAt(0).toUpperCase() + str.substr(1);\n\t},\n\n\t//\tFor checking what vendor prefixes are native\n\tdiv = document.createElement('div'),\n\n\t//\tvendor prefix, ie: transitionDuration becomes MozTransitionDuration\n\tvp = function (prop) {\n\t\tvar pf;\n\t\t//\tHandle unprefixed\n\t\tif (prop in div.style) {\n\t\t\treturn prop;\n\t\t}\n\n\t\t//\tHandle keyframes\n\t\tif(prop == \"@keyframes\") {\n\t\t\tfor (var i = 0; i < prefixes.length; i += 1) {\n\t\t\t\t//\tTesting using transition\n\t\t\t\tpf = prefixes[i] + \"Transition\";\n\t\t\t\tif (pf in div.style) {\n\t\t\t\t\treturn \"@-\" + prefixes[i].toLowerCase() + \"-keyframes\";\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn prop;\n\t\t}\n\n\t\tfor (var i = 0; i < prefixes.length; i += 1) {\n\t\t\tpf = prefixes[i] + cap(prop);\n\t\t\tif (pf in div.style) {\n\t\t\t\treturn pf;\n\t\t\t}\n\t\t}\n\t\t//\tCan't find it - return original property.\n\t\treturn prop;\n\t},\n\n\t//\tSee if we can use native transitions\n\tsupportsTransitions = function() {\n\t\tvar b = document.body || document.documentElement,\n\t\t\ts = b.style,\n\t\t\tp = 'transition';\n\n\t\tif (typeof s[p] == 'string') { return true; }\n\n\t\t// Tests for vendor specific prop\n\t\tp = p.charAt(0).toUpperCase() + p.substr(1);\n\n\t\tfor (var i=0; i<prefixes.length; i++) {\n\t\t\tif (typeof s[prefixes[i] + p] == 'string') { return true; }\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t//\tConverts CSS transition times to MS\n\tgetTimeinMS = function(str) {\n\t\tvar result = 0, tmp;\n\t\tstr += \"\";\n\t\tstr = str.toLowerCase();\n\t\tif(str.indexOf(\"ms\") !== -1) {\n\t\t\ttmp = str.split(\"ms\");\n\t\t\tresult = Number(tmp[0]);\n\t\t} else if(str.indexOf(\"s\") !== -1) {\n\t\t\t//\ts\n\t\t\ttmp = str.split(\"s\");\n\t\t\tresult = Number(tmp[0]) * 1000;\n\t\t} else {\n\t\t\tresult = Number(str);\n\t\t}\n\n\t\treturn Math.round(result);\n\t},\n\n\t//\tSet style properties\n\tsetStyleProps = function(obj, props){\n\t\tfor(var i in props) {if(props.hasOwnProperty(i)) {\n\t\t\tobj.style[vp(i)] = props[i];\n\t\t}}\n\t},\n\n\t//\tSet props for transitions and transforms with basic defaults\n\tsetTransitionProps = function(args){\n\t\tvar props = {\n\t\t\t\t//\tease, linear, ease-in, ease-out, ease-in-out, cubic-bezier(n,n,n,n) initial, inherit\n\t\t\t\tTransitionTimingFunction: \"ease\",\n\t\t\t\tTransitionDuration: defaultDuration + \"ms\",\n\t\t\t\tTransitionProperty: \"all\"\n\t\t\t},\n\t\t\tp, i, tmp, tmp2, found;\n\n\t\t//\tSet any allowed properties \n\t\tfor(p in args) { if(args.hasOwnProperty(p)) {\n\t\t\ttmp = 'Transition' + cap(p);\n\t\t\ttmp2 = p.toLowerCase();\n\t\t\tfound = false;\n\n\t\t\t//\tLook at transition props\n\t\t\tfor(i = 0; i < transitionProps.length; i += 1) {\n\t\t\t\tif(tmp == transitionProps[i]) {\n\t\t\t\t\tprops[transitionProps[i]] = args[p];\n\t\t\t\t\tfound = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//\tLook at transform props\n\t\t\tfor(i = 0; i < transformProps.length; i += 1) {\n\t\t\t\tif(tmp2 == transformProps[i]) {\n\t\t\t\t\tprops[vp(\"transform\")] = props[vp(\"transform\")] || \"\";\n\t\t\t\t\tprops[vp(\"transform\")] += \" \" +p + \"(\" + args[p] + \")\";\n\t\t\t\t\tfound = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(!found) {\n\t\t\t\tprops[p] = args[p];\n\t\t\t}\n\t\t}}\n\t\treturn props;\n\t},\n\n\t//\tFix animatiuon properties\n\t//\tNormalises transforms, eg: rotate, scale, etc...\n\tnormaliseTransformProps = function(args){\n\t\tvar props = {},\n\t\t\ttmpProp,\n\t\t\tp, i, found,\n\t\t\tnormal = function(props, p, value){\n\t\t\t\tvar tmp = p.toLowerCase(),\n\t\t\t\t\tfound = false, i;\n\n\t\t\t\t//\tLook at transform props\n\t\t\t\tfor(i = 0; i < transformProps.length; i += 1) {\n\t\t\t\t\tif(tmp == transformProps[i]) {\n\t\t\t\t\t\tprops[vp(\"transform\")] = props[vp(\"transform\")] || \"\";\n\t\t\t\t\t\tprops[vp(\"transform\")] += \" \" +p + \"(\" + value + \")\";\n\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif(!found) {\n\t\t\t\t\tprops[p] = value;\n\t\t\t\t} else {\n\t\t\t\t\t//\tRemove transform property\n\t\t\t\t\tdelete props[p];\n\t\t\t\t}\n\t\t\t};\n\n\t\t//\tSet any allowed properties \n\t\tfor(p in args) { if(args.hasOwnProperty(p)) {\n\t\t\t//\tIf we have a percentage, we have a key frame\n\t\t\tif(p.indexOf(\"%\") !== -1) {\n\t\t\t\tfor(i in args[p]) { if(args[p].hasOwnProperty(i)) {\n\t\t\t\t\tnormal(args[p], i, args[p][i]);\n\t\t\t\t}}\n\t\t\t\tprops[p] = args[p];\n\t\t\t} else {\n\t\t\t\tnormal(props, p, args[p]);\n\t\t\t}\n\t\t}}\n\n\t\treturn props;\n\t},\n\n\n\t//\tIf an object is empty\n\tisEmpty = function(obj) {\n\t\tfor(var i in obj) {if(obj.hasOwnProperty(i)) {\n\t\t\treturn false;\n\t\t}}\n\t\treturn true; \n\t},\n\t//\tCreates a hashed name for the animation\n\t//\tUse to create a unique keyframe animation style rule\n\taniName = function(props){\n\t\treturn \"ani\" + JSON.stringify(props).split(/[{},%\":]/).join(\"\");\n\t},\n\tanimations = {},\n\n\t//\tSee if we can use transitions\n\tcanTrans = supportsTransitions();\n\n\t//\tIE10+ http://caniuse.com/#search=css-animations\n\tm.animateProperties = function(el, args, cb){\n\t\tel.style = el.style || {};\n\t\tvar props = setTransitionProps(args), time;\n\n\t\tif(typeof props.TransitionDuration !== 'undefined') {\n\t\t\tprops.TransitionDuration = getTimeinMS(props.TransitionDuration) + \"ms\";\n\t\t} else {\n\t\t\tprops.TransitionDuration = defaultDuration + \"ms\";\n\t\t}\n\n\t\ttime = getTimeinMS(props.TransitionDuration) || 0;\n\n\t\t//\tSee if we support transitions\n\t\tif(canTrans) {\n\t\t\tsetStyleProps(el, props);\n\t\t} else {\n\t\t\t//\tTry and fall back to jQuery\n\t\t\t//\tTODO: Switch to use velocity, it is better suited.\n\t\t\tif(typeof $ !== 'undefined' && $.fn && $.fn.animate) {\n\t\t\t\t$(el).animate(props, time);\n\t\t\t}\n\t\t}\n\n\t\tif(cb){\n\t\t\tsetTimeout(cb, time+1);\n\t\t}\n\t};\n\n\t//\tTrigger a transition animation\n\tm.trigger = function(name, value, options, cb){\n\t\toptions = options || {};\n\t\tvar ani = animations[name];\n\t\tif(!ani) {\n\t\t\treturn err(\"Animation \" + name + \" not found.\");\n\t\t}\n\n\t\treturn function(e){\n\t\t\tvar args = ani.fn(function(){\n\t\t\t\treturn typeof value == 'function'? value(): value;\n\t\t\t});\n\n\t\t\t//\tAllow override via options\n\t\t\tfor(i in options) if(options.hasOwnProperty(i)) {{\n\t\t\t\targs[i] = options[i];\n\t\t\t}}\n\n\t\t\tm.animateProperties(e.target, args, cb);\n\t\t};\n\t};\n\n\t//\tAdds an animation for bindings and so on.\n\tm.addAnimation = function(name, fn, options){\n\t\toptions = options || {};\n\n\t\tif(animations[name]) {\n\t\t\treturn err(\"Animation \" + name + \" already defined.\");\n\t\t} else if(typeof fn !== \"function\") {\n\t\t\treturn err(\"Animation \" + name + \" is being added as a transition based animation, and must use a function.\");\n\t\t}\n\n\t\toptions.duration = options.duration || defaultDuration;\n\n\t\tanimations[name] = {\n\t\t\toptions: options,\n\t\t\tfn: fn\n\t\t};\n\n\t\t//\tAdd a default binding for the name\n\t\tm.addBinding(name, function(prop){\n\t\t\tm.bindAnimation(name, this, fn, prop);\n\t\t}, true);\n\t};\n\n\tm.addKFAnimation = function(name, arg, options){\n\t\toptions = options || {};\n\n\t\tif(animations[name]) {\n\t\t\treturn err(\"Animation \" + name + \" already defined.\");\n\t\t}\n\n\t\tvar init = function(props) {\n\t\t\tvar aniId = aniName(props),\n\t\t\t\thasAni = document.getElementById(aniId),\n\t\t\t\tkf;\n\n\t\t\t//\tOnly insert once\n\t\t\tif(!hasAni) {\n\t\t\t\tanimations[name].id = aniId;\n\n\t\t\t\tprops = normaliseTransformProps(props);\n\t\t\t\t//  Create keyframes\n\t\t\t\tkf = vp(\"@keyframes\") + \" \" + aniId + \" \" + JSON.stringify(props)\n\t\t\t\t\t.split(\"\\\"\").join(\"\")\n\t\t\t\t\t.split(\"},\").join(\"}\\n\")\n\t\t\t\t\t.split(\",\").join(\";\")\n\t\t\t\t\t.split(\"%:\").join(\"% \");\n\n\t\t\t\tvar s = document.createElement('style');\n\t\t\t\ts.setAttribute('id', aniId);\n\t\t\t\ts.id = aniId;\n\t\t\t\ts.textContent = kf;\n\t\t\t\t//  Might not have head?\n\t\t\t\tdocument.head.appendChild(s);\n\t\t\t}\n\n\t\t\tanimations[name].isInitialised = true;\n\t\t\tanimations[name].options.animateImmediately = true;\n\t\t};\n\n\t\toptions.duration = options.duration || defaultDuration;\n\t\toptions.animateImmediately = options.animateImmediately || false;\n\n\t\tanimations[name] = {\n\t\t\tinit: init,\n\t\t\toptions: options,\n\t\t\targ: arg\n\t\t};\n\n\t\t//\tAdd a default binding for the name\n\t\tm.addBinding(name, function(prop){\n\t\t\tm.bindAnimation(name, this, arg, prop);\n\t\t}, true);\n\t};\n\n\n\t/*\tOptions - defaults - what it does:\n\n\t\tDelay - unedefined - delays the animation\n\t\tDirection - \n\t\tDuration\n\t\tFillMode - \"forward\" makes sure it sticks: http://www.w3schools.com/cssref/css3_pr_animation-fill-mode.asp\n\t\tIterationCount, \n\t\tName, PlayState, TimingFunction\n\t\n\t*/\n\n\t//\tUseful to know, 'to' and 'from': http://lea.verou.me/2012/12/animations-with-one-keyframe/\n\tm.animateKF = function(name, el, options, cb){\n\t\toptions = options || {};\n\t\tvar ani = animations[name], i, props = {};\n\t\tif(!ani) {\n\t\t\treturn err(\"Animation \" + name + \" not found.\");\n\t\t}\n\n\t\t//\tAllow override via options\n\t\tani.options = ani.options || {};\n\t\tfor(i in options) if(options.hasOwnProperty(i)) {{\n\t\t\tani.options[i] = options[i];\n\t\t}}\n\n\t\tif(!ani.isInitialised && ani.init) {\n\t\t\tani.init(ani.arg);\n\t\t}\n\n\t\t//\tAllow animate overrides\n\t\tfor(i in ani.options) if(ani.options.hasOwnProperty(i)) {{\n\t\t\tprops[vp(\"animation\" + cap(i))] = ani.options[i];\n\t\t}}\n\n\t\t//\tSet required items and default values for props\n\t\tprops[vp(\"animationName\")] = ani.id;\n\t\tprops[vp(\"animationDuration\")] = (props[vp(\"animationDuration\")]? props[vp(\"animationDuration\")]: defaultDuration) + \"ms\";\n\t\tprops[vp(\"animationDelay\")] = props[vp(\"animationDelay\")]? props[vp(\"animationDuration\")] + \"ms\": undefined;\n\t\tprops[vp(\"animationFillMode\")] = props[vp(\"animationFillMode\")] || \"forwards\";\n\n\t\tel.style = el.style || {};\n\n\t\t//\tUse for callback\n\t\tvar endAni = function(){\n\t\t\t//\tRemove listener\n\t\t\tel.removeEventListener(\"animationend\", endAni, false);\n\t\t\tif(cb){\n\t\t\t\tcb(el);\n\t\t\t}\n\t\t};\n\n\t\t//\tRemove animation if any\n\t\tel.style[vp(\"animation\")] = \"\";\n\t\tel.style[vp(\"animationName\")] = \"\";\n\n\t\t//\tMust use two request animation frame calls, for FF to\n\t\t//\twork properly, does not seem to have any adverse effects\n\t\trequestAnimationFrame(function(){\n\t\t\trequestAnimationFrame(function(){\n\t\t\t\t//\tApply props\n\t\t\t\tfor(i in props) if(props.hasOwnProperty(i)) {{\n\t\t\t\t\tel.style[i] = props[i];\n\t\t\t\t}}\n\n\t\t\t\tel.addEventListener(\"animationend\", endAni, false);\n\t\t\t});\n\t\t});\n\t};\n\n\tm.triggerKF = function(name, options){\n\t\treturn function(){\n\t\t\tm.animateKF(name, this, options);\n\t\t};\n\t};\n\n\tm.bindAnimation = function(name, el, options, prop) {\n\t\tvar ani = animations[name];\n\n\t\tif(!ani && !ani.name) {\n\t\t\treturn err(\"Animation \" + name + \" not found.\");\n\t\t}\n\n\t\tif(ani.fn) {\n\t\t\tm.animateProperties(el, ani.fn(prop));\n\t\t} else {\n\t\t\tvar oldConfig = el.config;\n\t\t\tel.config = function(el, isInit){\n\t\t\t\tif(!ani.isInitialised && ani.init) {\n\t\t\t\t\tani.init(options);\n\t\t\t\t}\n\t\t\t\tif(prop() && isInit) {\n\t\t\t\t\tm.animateKF(name, el, options);\n\t\t\t\t}\n\t\t\t\tif(oldConfig) {\n\t\t\t\t\toldConfig.apply(el, arguments);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t};\n\n\n\n\t/* Default transform2d bindings */\n\tvar basicBindings = ['scale', 'scalex', 'scaley', 'translate', 'translatex', 'translatey', \n\t\t'matrix', 'backgroundColor', 'backgroundPosition', 'borderBottomColor', \n\t\t'borderBottomWidth', 'borderLeftColor', 'borderLeftWidth', 'borderRightColor', \n\t\t'borderRightWidth', 'borderSpacing', 'borderTopColor', 'borderTopWidth', 'bottom', \n\t\t'clip', 'color', 'fontSize', 'fontWeight', 'height', 'left', 'letterSpacing', \n\t\t'lineHeight', 'marginBottom', 'marginLeft', 'marginRight', 'marginTop', 'maxHeight', \n\t\t'maxWidth', 'minHeight', 'minWidth', 'opacity', 'outlineColor', 'outlineWidth', \n\t\t'paddingBottom', 'paddingLeft', 'paddingRight', 'paddingTop', 'right', 'textIndent', \n\t\t'textShadow', 'top', 'verticalAlign', 'visibility', 'width', 'wordSpacing', 'zIndex'],\n\t\tdegBindings = ['rotate', 'rotatex', 'rotatey', 'skewx', 'skewy'], i;\n\n\t//\tBasic bindings where we pass the prop straight through\n\tfor(i = 0; i < basicBindings.length; i += 1) {\n\t\t(function(name){\n\t\t\tm.addAnimation(name, function(prop){\n\t\t\t\tvar options = {};\n\t\t\t\toptions[name] = prop();\n\t\t\t\treturn options;\n\t\t\t});\n\t\t}(basicBindings[i]));\n\t}\n\n\t//\tDegree based bindings - conditionally postfix with \"deg\"\n\tfor(i = 0; i < degBindings.length; i += 1) {\n\t\t(function(name){\n\t\t\tm.addAnimation(name, function(prop){\n\t\t\t\tvar options = {}, value = prop();\n\t\t\t\toptions[name] = isNaN(value)? value: value + \"deg\";\n\t\t\t\treturn options;\n\t\t\t});\n\t\t}(degBindings[i]));\n\t}\n\n\t//\tAttributes that require more than one prop\n\tm.addAnimation(\"skew\", function(prop){\n\t\tvar value = prop();\n\t\treturn {\n\t\t\tskew: [\n\t\t\t\tvalue[0] + (isNaN(value[0])? \"\":\"deg\"), \n\t\t\t\tvalue[1] + (isNaN(value[1])? \"\":\"deg\")\n\t\t\t]\n\t\t};\n\t});\n\n\n\n\t//\tA few more bindings\n\tm = m || {};\n\t//\tHide node\n\tm.addBinding(\"hide\", function(prop){\n\t\tthis.style = {\n\t\t\tdisplay: m.unwrap(prop)? \"none\" : \"\"\n\t\t};\n\t}, true);\n\n\t//\tToggle boolean value on click\n\tm.addBinding('toggle', function(prop){\n\t\tthis.onclick = function(){\n\t\t\tvar value = prop();\n\t\t\tprop(!value);\n\t\t}\n\t}, true);\n\n\t//\tSet hover states, a'la jQuery pattern\n\tm.addBinding('hover', function(prop){\n\t\tthis.onmouseover = prop[0];\n\t\tif(prop[1]) {\n\t\t\tthis.onmouseout = prop[1];\n\t\t}\n\t}, true );\n\n\n};\n\n\n\n\n\n\n\nif (typeof module != \"undefined\" && module !== null && module.exports) {\n\tmodule.exports = mithrilAnimate;\n} else if (typeof define === \"function\" && define.amd) {\n\tdefine(function() {\n\t\treturn mithrilAnimate;\n\t});\n} else {\n\tmithrilAnimate(typeof window != \"undefined\"? window.m || {}: {});\n}\n\n}());","/*\tmiso permissions\n\tPermit users access to controller actions based on roles \n*/\nvar miso = require(\"../modules/miso.util.client.js\"),\n\thasRole = function(userRoles, roles){\n\t\tvar hasRole = false;\n\t\t//\tAll roles\n\t\tif(userRoles == \"*\") {\n\t\t\treturn true;\n\t\t}\n\t\t//\tSearch each user role\n\t\tmiso.each(userRoles, function(userRole){\n\t\t\tuserRole = (typeof userRole !== \"string\")? userRole: [userRole];\n\t\t\t//\tSearch each role\n\t\t\tmiso.each(roles, function(role){\n\t\t\t\tif(userRole == role) {\n\t\t\t\t\thasRole = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\treturn hasRole;\n\t};\n\n//\tDetermine if the user has access to an APP action\n//\tTODO: \nmodule.exports.app = function(permissions, actionName, userRoles){\n\t//\tTODO: Probably need to use pass=false by default, but first:\n\t//\n\t//\t* Add global config for pass default in server.json\n\t//\t* \n\t//\n\tvar pass = true;\n\n\t//\tApply deny first, then allow.\n\tif(permissions && userRoles){\n\t\tif(permissions.deny) {\n\t\t\tpass = ! hasRole(user.roles, permissions.deny);\n\t\t}\n\t\tif(permissions.allow) {\n\t\t\tpass = hasRole(user.roles, permissions.allow);\n\t\t}\n\t}\n\n\treturn pass;\n};\n\n\n//\tDetermine if the user has access to an API action\n//\tTODO: \nmodule.exports.api = function(permissions, actionName, userRoles){\n\t//\tTODO: Probably need to use pass=false by default, but first:\n\t//\n\t//\t* Add global config for pass default in server.json\n\t//\t* \n\t//\n\tvar pass = true;\n\n\t//\tApply deny first, then allow.\n\tif(permissions && userRoles){\n\t\tif(permissions.deny) {\n\t\t\tpass = ! hasRole(user.roles, permissions.deny);\n\t\t}\n\t\tif(permissions.allow) {\n\t\t\tpass = hasRole(user.roles, permissions.allow);\n\t\t}\n\t}\n\n\treturn pass;\n};","/*\tMiso layout page\n\n\tThis layout determines the HTML surround for each of your mvc routes.\n\tFeel free to modify as you see fit - as long as the attachemnt node is \n\tpresent, it should work.\n\n\tNote: this is the only mvc that does not require a controller.\n*/\nvar m = require('mithril'),\n\tsugartags = require('mithril.sugartags')(m),\n\tauthentication = require(\"../system/api/authentication/api.client.js\")(m);\n\n//\tThe header - this can also be rendered client side\nmodule.exports.headerContent = function(ctrl){\n\twith(sugartags) {\n\t\treturn DIV({\"class\": 'cw cf'}, [\n\t\t\tDIV({\"class\": 'logo'},\n\t\t\t\tA({alt: 'MISO', href:'/', config: m.route}, [\n\t\t\t\t\tIMG({src: '/img/miso_logo.png'})\n\t\t\t\t])\n\t\t\t),\n\t\t\tNAV({\"class\": \"left\"}, UL([\n\t\t\t\tLI(A({href: \"http://misojs.com/docs\", target: \"_blank\"}, \"Documentation\"))\n\t\t\t])),\n\t\t\tNAV({\"class\": \"right\"}, UL([\n\t\t\t\tLI(A({href: \"https://github.com/jsguy/misojs\", target: \"_blank\"}, \"Github\")),\n\t\t\t\t//\tThis link could go to an account \n\t\t\t\t//\tpage or something like that\n\n\t\t\t\t(ctrl.misoGlobal.authenticationEnabled?\n\t\t\t\t\t(ctrl.misoGlobal.isLoggedIn && ctrl.misoGlobal.userName? \n\t\t\t\t\t\tLI(A({onclick: function(e){\n\t\t\t\t\t\t\t\tconsole.log('logging out, please wait...');\n\t\t\t\t\t\t\t\tauthentication.logout({}).then(function(data){\n\t\t\t\t\t\t\t\t\tconsole.log(\"You've been logged out\");\n\t\t\t\t\t\t\t\t\tm.route(\"/login\");\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}, href: \"#\", id: \"misoUserName\"},\n\t\t\t\t\t\t\t\"Logout \" + ctrl.misoGlobal.userName)\n\t\t\t\t\t\t):\n\t\t\t\t\t\tLI(A({href: \"/login\"}, \"Login\"))\n\t\t\t\t\t): \n\t\t\t\t\t\"\"\n\t\t\t\t)\n\n\t\t\t]))\n\t\t]);\n\t}\n};\n\n//\tThe full layout - always only rendered server side\nmodule.exports.view = function(ctrl){\n\twith(sugartags) {\n\t\treturn [\n\t\t\tm.trust(\"<!doctype html>\"),\n\t\t\tHTML([\n\t\t\t\tHEAD([\n\t\t\t\t\tLINK({href: '/css/style.css', rel:'stylesheet'}),\n\t\t\t\t\t//\tAdd in the misoGlobal object...\n\t\t\t\t\tSCRIPT(\"var misoGlobal = \"+(ctrl.misoGlobal? JSON.stringify(ctrl.misoGlobal): {})+\";\")\n\t\t\t\t]),\n\t\t\t\tBODY({\"class\": 'fixed-header' }, [\n\t\t\t\t\tHEADER({id: \"misoHeaderNode\"}, ctrl.headerContent(ctrl)),\n\t\t\t\t\tSECTION({id: ctrl.misoAttachmentNode}, ctrl.content),\n\t\t\t\t\tSECTION({id: \"loader\"}, [\n\t\t\t\t\t\tDIV({\"class\": \"loader\"})\n\t\t\t\t\t]),\n\t\t\t\t\tSECTION({id: \"footer\"}, [\n\t\t\t\t\t\tDIV({\"class\": 'cw cf'}, m.trust(\"Copyright &copy; 2015 jsguy\"))\n\t\t\t\t\t]),\n\t\t\t\t\t//SCRIPT({src: '/miso.js' + (ctrl.reload? \"?cacheKey=\" + (new Date()).getTime(): \"\")}),\n\t\t\t\t\tSCRIPT({src: '/miso.js'}),\n\t\t\t\t\t(ctrl.reload? SCRIPT({src: '/reload.js'}): \"\")\n\t\t\t\t])\n\t\t\t])\n\t\t];\n\t}\n};","/*\n\tThis is a sample user management app that uses the\n\tmultiple url miso pattern.\n*/\nvar miso = require(\"../modules/miso.util.client.js\"),\n\tvalidate = require('validator.modelbinder'),\n\tm = require('mithril'),\n\tsugartags = require('mithril.sugartags')(m),\n\tbindings = require('mithril.bindings')(m),\n\tapi = require(\"../system/api/authentication/api.client.js\")(m),\n\tself = module.exports;\n\n//\tShared view\nvar editView = function(ctrl){\n\twith(sugartags) {\n\t\treturn DIV({ class: \"cw\" }, [\n\t\t\tH2({\"class\": \"pageHeader\"}, ctrl.header),\n\t\t\tctrl.user ? [\n\t\t\t\tDIV([\n\t\t\t\t\tLABEL(\"Name\"), INPUT({value: ctrl.user.name}),\n\t\t\t\t\tDIV({\"class\": (ctrl.user.isValid('name') == true || !ctrl.showErrors? \"valid\": \"invalid\") + \" indented\"}, [\n\t\t\t\t\t\tctrl.user.isValid('name') == true || !ctrl.showErrors? \"\": ctrl.user.isValid('name').join(\", \")\n\t\t\t\t\t])\n\t\t\t\t]),\n\t\t\t\tDIV([\n\t\t\t\t\tLABEL(\"Email\"), INPUT({value: ctrl.user.email}),\n\t\t\t\t\tDIV({\"class\": (ctrl.user.isValid('email') == true || !ctrl.showErrors? \"valid\": \"invalid\") + \" indented\" }, [\n\t\t\t\t\t\tctrl.user.isValid('email') == true || !ctrl.showErrors? \"\": ctrl.user.isValid('email').join(\", \")\n\t\t\t\t\t])\n\t\t\t\t]),\n\t\t\t\tDIV([\n\t\t\t\t\tLABEL(\"Password\"), INPUT({value: ctrl.user.password, type: 'password'}),\n\t\t\t\t\tDIV({\"class\": (ctrl.user.isValid('password') == true || !ctrl.showErrors? \"valid\": \"invalid\") + \" indented\" }, [\n\t\t\t\t\t\tctrl.user.isValid('password') == true || !ctrl.showErrors? \"\": ctrl.user.isValid('password').join(\", \")\n\t\t\t\t\t])\n\t\t\t\t]),\n\t\t\t\tDIV({\"class\": \"indented\"},[\n\t\t\t\t\tBUTTON({onclick: ctrl.save, class: \"positive\"}, \"Save user\"),\n\t\t\t\t\tBUTTON({onclick: ctrl.remove, class: \"negative\"}, \"Delete user\")\n\t\t\t\t])\n\t\t\t]: DIV(\"User not found\")\n\t\t]);\n\t}\n};\n\n\n//\tUser list\nmodule.exports.index = {\n\tcontroller: function(params) {\n\t\tvar ctrl = this;\n\n\t\tctrl.vm = {\n\t\t\tuserList: function(users){\n\t\t\t\tthis.users = m.p(users);\n\t\t\t}\n\t\t};\n\n\t\tapi.findUsers({type: 'user.edit.user'}).then(function(data) {\n\t\t\tif(data.error) {\n\t\t\t\tconsole.log(\"Error \" + data.error);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(data.result) {\n\t\t\t\tvar list = Object.keys(data.result).map(function(key) {\n\t\t\t\t\treturn new self.edit.models.user(data.result[key]);\n\t\t\t\t});\n\n\t\t\t\tctrl.users = new ctrl.vm.userList(list);\n\t\t\t} else {\n\t\t\t\tctrl.users = new ctrl.vm.userList([]);\n\t\t\t}\n\t\t}, function(){\n\t\t\tconsole.log('Error', arguments);\n\t\t});\n\n\t\treturn this;\n\t},\n\tview: function(ctrl){\n\t\tvar c = ctrl,\n\t\t\tu = c.users;\n\n\t\twith(sugartags) {\n\t\t\treturn DIV({ class: \"cw\" }, [\n\t\t\t\tUL([\n\t\t\t\t\tu.users().map(function(user, idx){\n\t\t\t\t\t\treturn LI(A({ href: '/user/' + user.id(), config: m.route}, user.name() + \" - \" + user.email()));\n\t\t\t\t\t})\n\t\t\t\t]),\n\t\t\t\tA({\"class\":\"button positive mtop\", href:\"/users/new\", config: m.route}, \"Add new user\")\n\t\t\t]);\n\t\t}\n\t}\n};\n\n\n//\tNew user\nmodule.exports.new = {\n\tcontroller: function(params) {\n\t\tvar ctrl = this;\n\t\tctrl.user = new self.edit.models.user({name: \"\", email: \"\"});\n\t\tctrl.header = \"New user\";\n\t\tctrl.showErrors = false;\n\n\t\tctrl.save = function(){\n\t\t\tif(ctrl.user.isValid() !== true) {\n\t\t\t\tctrl.showErrors = true;\n\t\t\t\tconsole.log('User is not valid');\n\t\t\t} else {\n\t\t\t\tapi.saveUser({ type: 'user.edit.user', model: ctrl.user } ).then(function(){\n\t\t\t\t\tconsole.log(\"Added user\", arguments);\n\t\t\t\t\tm.route(\"/users\");\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\treturn ctrl;\n\t},\n\tview: editView\n};\n\n\n//\tEdit user\nmodule.exports.edit = {\n\tmodels: {\n\t\tuser: function(data){\n\t\t\tthis.name = m.p(data.name||\"\");\n\t\t\tthis.email = m.p(data.email||\"\");\n\t\t\t//\tPassword is always empty first\n\t\t\tthis.password = m.p(data.password||\"\");\n\t\t\tthis.id = m.p(data._id||\"\");\n\n\t\t\t//\tValidate the model\n\t\t\tthis.isValid = validate.bind(this, {\n\t\t\t\tname: {\n\t\t\t\t\tisRequired: \"You must enter a name\"\n\t\t\t\t},\n\t\t\t\tpassword: {\n\t\t\t\t\tisRequired: \"You must enter a password\"\n\t\t\t\t},\n\t\t\t\temail: {\n\t\t\t\t\tisRequired: \"You must enter an email address\",\n\t\t\t\t\tisEmail: \"Must be a valid email address\"\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn this;\n\t\t}\n\t},\n\tcontroller: function(params) {\n\t\tvar ctrl = this,\n\t\t\tuserId = miso.getParam('user_id', params);\n\n\t\tctrl.header = \"Edit user \" + userId;\n\n\t\t//\tLoad our user\n\t\tapi.findUsers({type: 'user.edit.user', query: {_id: userId}}).then(function(data) {\n\t\t\tvar user = data.result;\n\t\t\tif(user && user.length > 0) {\n\t\t\t\tctrl.user = new self.edit.models.user(user[0]);\n\t\t\t} else {\n\t\t\t\tconsole.log('User not found', userId);\n\t\t\t}\n\t\t}, function(){\n\t\t\tconsole.log('Error', arguments);\n\t\t});\n\n\t\tctrl.save = function(){\n\t\t\tif(ctrl.user.isValid() !== true) {\n\t\t\t\tctrl.showErrors = true;\n\t\t\t\tconsole.log('User is not valid');\n\t\t\t} else {\n\t\t\t\tapi.saveUser({ type: 'user.edit.user', model: ctrl.user } ).then(function(){\n\t\t\t\t\tconsole.log(\"Saved user\", arguments);\n\t\t\t\t\tm.route(\"/users\");\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tctrl.remove = function(){\n\t\t\tif(confirm(\"Delete user?\")) {\n\t\t\t\tapi.remove({ type: 'user.edit.user', _id: userId }).then(function(data){\n\t\t\t\t\tconsole.log(data.result);\n\t\t\t\t\tm.route(\"/users\");\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\treturn ctrl;\n\t},\n\tview: editView\n\t//\tAny authentication info\n\t//, authenticate: true\n};\n","var m = require('mithril'),\n\tsugartags = require('mithril.sugartags')(m),\n\tsmoothScroll = require('../public/js/mithril.smoothscroll.js');\n\n//\tHome page\nvar self = module.exports.index = {\n\tmodels: {\n\t\tintro: function() {\n\t\t\tthis.text = m.p(\"Create apps in a snap!\");\n\t\t\tthis.ani = m.p(0);\n\t\t\tthis.demoImgSrc = m.p(\"img/misodemo.gif\");\n\t\t}\n\t},\n\tcontroller: function(){\n\t\tvar ctrl = this;\n\n\t\tctrl.replay = function(){\n\t\t\tvar tmpSrc = ctrl.model.demoImgSrc();\n\t\t\tctrl.model.demoImgSrc(\"\");\n\t\t\tsetTimeout(function(){\n\t\t\t\tctrl.model.demoImgSrc(tmpSrc);\n\t\t\t},0);\n\t\t};\n\n\t\tctrl.model = new self.models.intro();\n\t\treturn this;\n\t},\n\n\tview: function(ctrl){\n\t\tvar o = ctrl.model;\n\t\twith(sugartags) {\n\t\t\treturn DIV([\n\t\t\t\tDIV({\"class\": \"intro\"}, [\n\t\t\t\t\tDIV({\"class\": \"introText\"}, o.text()),\n\t\t\t\t\tDIV({\"class\": \"demoImg\"}, [\n\t\t\t\t\t\tIMG({id: \"demoImg\", src: o.demoImgSrc()}),\n\t\t\t\t\t\tSPAN({\"class\": \"replayButton\", onclick: ctrl.replay}, \"Replay\")\n\t\t\t\t\t]),\n\t\t\t\t\tA({\"class\": \"installButton\", config: smoothScroll(ctrl), href: \"#installation\"}, \"Install miso now\")\n\t\t\t\t]),\n\n\t\t\t\tDIV({\"class\": \"cw\"}, [\n\t\t\t\t\tH2(A({name: \"what\", \"class\": \"heading\"},\"What is miso?\") ),\n\t\t\t\t\tP(\"Miso is an open source isomorphic javascript framework that allows you to write complete apps with much less effort than other frameworks. Miso features:\",[\n\t\t\t\t\t\tUL({\"class\": \"dotList\"}, [\n\t\t\t\t\t\t\tLI(\"Single page apps with serverside rendered HTML for the first page - works perfectly with SEO and older browsers\"),\n\t\t\t\t\t\t\tLI(\"Beautiful URLs - with a flexible routing system: automate some routes, take full control of others\"),\n\t\t\t\t\t\t\tLI(\"Tiny clientside footprint - less than 25kb (gzipped and minified)\"),\n\t\t\t\t\t\t\tLI(\"Fast live-code reload - smarter reload to help you work faster\"),\n\t\t\t\t\t\t\tLI([\"High performance - virtual dom engine, tiny footprint, faster than the rest\", A({href: \"http://lhorie.github.io/mithril/benchmarks.html\", target: \"_blank\"}, \"*\")]),\n\t\t\t\t\t\t\tLI(\"Much less code - create a deployable app in less than 30 lines of code\"),\n\t\t\t\t\t\t\tLI(\"Open source - MIT licensed\")\n\t\t\t\t\t\t])\n\t\t\t\t\t]),\n\t\t\t\t\tP(\"Miso utilises excellent open source libraries and frameworks to create an extremely efficient full web stack. These frameworks include:\"),\n\t\t\t\t\tDIV({\"class\": \"frameworks\"}, [\n\t\t\t\t\t\tDIV({\"class\": \"fwcontainer cf\"},[\n\t\t\t\t\t\t\tA({\"class\": \"fwLink\", href: \"http://lhorie.github.io/mithril/\", target: \"_blank\"},\n\t\t\t\t\t\t\tSPAN({\"class\": \"fw mithril\"})),\n\t\t\t\t\t\t\tA({\"class\": \"fwLink\", href: \"http://expressjs.com/\", target: \"_blank\"},SPAN({\"class\": \"fw express\"})),\n\t\t\t\t\t\t\tA({\"class\": \"fwLink\", href: \"http://browserify.org/\", target: \"_blank\"},SPAN({\"class\": \"fw browserify\"})),\n\t\t\t\t\t\t\tA({\"class\": \"fwLink\", href: \"http://nodemon.io/\", target: \"_blank\"},SPAN({\"class\": \"fw nodemon\"}))\n\t\t\t\t\t\t])\n\t\t\t\t\t])\n\t\t\t\t]),\n\n\t\t\t\tDIV({\"class\": \"cw\"}, [\n\t\t\t\t\tH2({id: \"installation\"}, A({name: \"installation\", \"class\": \"heading\"},\"Installation\") ),\n\t\t\t\t\tP(\"To install miso, use npm:\"),\n\t\t\t\t\tPRE({\"class\": \"javascript\"},[\n\t\t\t\t\t\tCODE(\"npm install misojs -g\")\n\t\t\t\t\t])\n\t\t\t\t]),\n\n\t\t\t\tDIV({\"class\": \"cw\"}, [\n\t\t\t\t\tH2(A({name: \"gettingstarted\", \"class\": \"heading\"},\"Getting started\") ),\n\t\t\t\t\tP(\"To create and run a miso app in a new directory:\"),\n\t\t\t\t\tPRE({\"class\": \"javascript\"},[\n\t\t\t\t\t\tCODE(\"miso -n myApp\\ncd myApp\\nmiso run\")\n\t\t\t\t\t]),\n\t\t\t\t\tP(\"Congratulations, you are now running your very own miso app in the 'myApp' directory!\")\n\t\t\t\t]),\n\n\t\t\t\tDIV({\"class\": \"cw\"}, [\n\t\t\t\t\tH2(A({name: \"examples\", \"class\": \"heading\"},\"Examples\")),\n\t\t\t\t\tUL([\n\t\t\t\t\t\tLI(A({ href: '/todos', config: m.route}, \"Todos example (single url SPA)\")),\n\t\t\t\t\t\tLI(A({ href: '/users', config: m.route}, \"Users example (multiple url SPA)\"))\n\t\t\t\t\t]),\n\t\t\t\t\tH2({name: \"documentation\", \"class\": \"heading\"}, \"Documentation\"),\n\t\t\t\t\tA({href:\"/docs\"}, \"Documentation can be found here\")\n\t\t\t\t])\n\t\t\t]);\n\t\t}\n\t}\n};\n","var m = require('mithril'),\n\tmiso = require(\"../modules/miso.util.client.js\"),\n\tsugartags = require('mithril.sugartags')(m),\n\t//\tGrab the generated client version...\n\tdocs = require('../public/miso.documentation.js');\n\nvar index = module.exports.index = {\n\tmodels: {\n\t\t//\tOur model\n\t\tdocs: function(data){\n\t\t\tthis.docs = data.docs;\n\t\t\tthis.id = data.id;\n\t\t\tthis.niceName = function(name){\n\t\t\t\treturn name.substr(0,name.lastIndexOf(\".md\")).split(\"-\").join(\" \");\n\t\t\t};\n\t\t}\n\t},\n\tcontroller: function(params) {\n\t\tthis.model = new index.models.docs({\n\t\t\tdocs: docs()\n\t\t});\n\t\treturn this;\n\t},\n\tview: function(ctrl) {\n\t\tvar model = ctrl.model;\n\t\twith(sugartags) {\n\t\t\treturn DIV({\"class\": \"doc cw\"}, [\n\t\t\t\tDIV(\"Below is a list of documentation for miso:\"),\n\t\t\t\tUL([\n\t\t\t\t\tmiso.each(model.docs, function(doc, key){\n\t\t\t\t\t\t//\tSkip home page...\n\t\t\t\t\t\tif(key !== \"Home.md\") {\n\t\t\t\t\t\t\treturn LI(\n\t\t\t\t\t\t\t\tA({href: \"/doc/\" + key, config: m.route}, model.niceName(key))\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} \n\t\t\t\t\t})\n\t\t\t\t]),\n\t\t\t\tDIV(\"Examples:\"),\n\t\t\t\tUL([\n\t\t\t\t\tLI(A({href: \"/todos\", config: m.route}, \"Todos example\")),\n\t\t\t\t\tLI(A({href: \"/users\", config: m.route}, \"Users example\"))\n\t\t\t\t]),\n\t\t\t\t//\tUse manual prism, so that it works in SPA mode\n\t\t\t\tSCRIPT({src: \"/external/prism/prism.js\", \"data-manual\": \"\"})\n\t\t\t]);\n\t\t}\n\t}\n};\n\nvar edit = module.exports.edit = {\n\tcontroller: function(params) {\n\t\tvar doc_id = miso.getParam('doc_id', params);\n\t\tthis.model = new index.models.docs({\n\t\t\tdocs: docs(),\n\t\t\tid: doc_id\n\t\t});\n\t\treturn this;\n\t},\n\tview: function(ctrl) {\n\t\tvar model = ctrl.model;\n\t\twith(sugartags) {\n\t\t\treturn DIV({\"class\": \"doc cw\"}, [\n\t\t\t\tLINK({href: \"/external/prism/prism.css\", rel: \"stylesheet\"}),\n\t\t\t\tH1(model.niceName(model.id)),\n\t\t\t\tARTICLE(m.trust(model.docs[model.id])),\n\t\t\t\t//\tUse manual prism, so that it works in SPA mode\n\t\t\t\tSCRIPT({src: \"/external/prism/prism.js\", \"data-manual\": \"\"}),\n\t\t\t\tSCRIPT(\"Prism.highlightAll();\")\n\t\t\t]);\n\t\t}\n\t}\n};","var m = require('mithril'),\n\tmiso = require(\"../modules/miso.util.client.js\"),\n\tsugartags = require('mithril.sugartags')(m);\n\nvar edit = module.exports.edit = {\n\tmodels: {\n\t\thello: function(data){\n\t\t\tthis.who = m.prop(data.who);\n\t\t}\n\t},\n\tcontroller: function(params) {\n\t\tvar who = miso.getParam('hello_id', params);\n\t\tthis.model = new edit.models.hello({who: who});\n\t\treturn this;\n\t},\n\tview: function(ctrl) {\n\t\twith(sugartags) {\n\t\t\treturn DIV(\"G'day \" + ctrl.model.who());\n\t\t}\n\t}\n};","/* Example login mvc */\nvar m = require('mithril'),\n\tmiso = require(\"../modules/miso.util.client.js\"),\n\tsugartags = require('mithril.sugartags')(m),\n\tauthentication = require(\"../system/api/authentication/api.client.js\")(m),\n\tsession = require(\"../system/api/session/api.client.js\")(m);\n\nvar index = module.exports.index = {\n\tmodels: {\n\t\tlogin: function(data){\n\t\t\tthis.url = data.url;\n\t\t\tthis.isLoggedIn = m.prop(false);\n\t\t\tthis.username = m.prop(data.username||\"\");\n\t\t\tthis.password = m.prop(\"\");\n\t\t}\n\t},\n\tcontroller: function(params) {\n\t\tvar ctrl = this,\n\t\t\turl = miso.getParam('url', params),\n\t\t\tlogout = miso.getParam('logout', params);\n\n\t\tctrl.model = new index.models.login({url: url});\n\n\t\t//\tNote: this does not execute on the server as it \n\t\t//\tis a DOM event.\n\t\tctrl.login = function(e){\n\t\t\te.preventDefault();\n\t\t\t//\tCall the server method to see if we're logged in\n\t\t\tauthentication.login({type: 'login.index.login', model: ctrl.model}).then(function(data){\n\t\t\t\tif(data.result.isLoggedIn == true) {\n\t\t\t\t\t//\tWoot, we're in!\n\t\t\t\t\tmisoGlobal.isLoggedIn = true;\n\t\t\t\t\tmisoGlobal.userName = data.result.userName;\n\t\t\t\t\tctrl.model.isLoggedIn(true);\n\n\t\t\t\t\tconsole.log(\"Welcome \" + misoGlobal.userName + \", you've been logged in\");\n\n\t\t\t\t\t//\tWill show the username when logged in\n\t\t\t\t\tmisoGlobal.renderHeader();\n\n\t\t\t\t\tif(url){\n\t\t\t\t\t\tm.route(url);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//\tGo to default URL?\n\t\t\t\t\t\tm.route(\"/\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn false;\n\t\t};\n\n\t\tif(logout) {\n\t\t\tauthentication.logout({}).then(function(data){\n\t\t\t\tconsole.log(\"You've been logged out\");\n\t\t\t\t//\tWoot, we're out!\n\t\t\t\tctrl.model.isLoggedIn(false);\n\t\t\t\t// misoGlobal.isLoggedIn = false;\n\t\t\t\t// delete misoGlobal.userName;\n\t\t\t\t//\tWill remove the username when logged out\n\t\t\t\tmisoGlobal.renderHeader();\n\t\t\t});\n\t\t}\n\n\t\treturn ctrl;\n\t},\n\tview: function(ctrl) {\n\t\twith(sugartags) {\n\t\t\treturn DIV({\"class\": \"cw cf\"}, \n\t\t\t\tctrl.model.isLoggedIn()? \"You've been logged in\": [\n\t\t\t\tDIV(ctrl.model.url? \"Please log in to go to \" + ctrl.model.url: \"Please log in\"),\n\t\t\t\tFORM({ onsubmit: ctrl.login }, [\n\t\t\t\t\tINPUT({ type: \"text\", value: ctrl.model.username, placeholder: \"Username\"}),\n\t\t\t\t\tINPUT({ type: \"password\", value: ctrl.model.password}),\n\t\t\t\t\tBUTTON({ type: \"submit\"}, \"Login\")\n\t\t\t\t])\n\t\t\t]);\n\t\t}\n\t},\n\tauthenticate: false\n};","var m = require('mithril'),\n\tsugartags = require('mithril.sugartags')(m),\n\tdb = require(\"../system/api/flatfiledb/api.client.js\")(m);\n\nvar self = module.exports.index = {\n\tmodels: {\n\t\ttodo: function(data){\n\t\t\tthis.text = data.text;\n\t\t\tthis.done = m.prop(data.done == \"false\"? false: data.done);\n\t\t\tthis._id = data._id;\n\t\t}\n\t},\n\tcontroller: function(params) {\n\t\tvar ctrl = this;\n\n\t\tctrl.list = [];\n\n\t\tdb.find({type: 'todo.index.todo'}, {background: true, initialValue: []}).then(function(data) {\n\t\t\tctrl.list = Object.keys(data.result).map(function(key) {\n\t\t\t\treturn new self.models.todo(data.result[key]);\n\t\t\t});\n\t\t});\n\n\t\tctrl.addTodo = function(e){\n\t\t\tvar value = ctrl.vm.input();\n\t\t\tif(value) {\n\t\t\t\tvar newTodo = new self.models.todo({\n\t\t\t\t\ttext: ctrl.vm.input(),\n\t\t\t\t\tdone: false\n\t\t\t\t});\n\t\t\t\tctrl.list.push(newTodo);\n\t\t\t\tctrl.vm.input(\"\");\n\t\t\t\tdb.save({ type: 'todo.index.todo', model: newTodo } ).then(function(res){\n\t\t\t\t\tnewTodo._id = res.result;\n\t\t\t\t});\n\t\t\t}\n\t\t\te.preventDefault();\n\t\t\treturn false;\n\t\t};\n\n\t\tctrl.archive = function(){\n\t\t\tvar list = [];\n\t\t\tctrl.list.map(function(todo) {\n\t\t\t\tif(!todo.done()) {\n\t\t\t\t\tlist.push(todo); \n\t\t\t\t} else {\n\t\t\t\t\tdb.remove({ type: 'todo.index.todo', _id: todo._id }).then(function(response){\n\t\t\t\t\t\tconsole.log(response.result);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tctrl.list = list;\n\t\t};\n\n\t\tctrl.vm = {\n\t\t\tleft: function(){\n\t\t\t\tvar count = 0;\n\t\t\t\tctrl.list.map(function(todo) {\n\t\t\t\t\tcount += todo.done() ? 0 : 1;\n\t\t\t\t});\n\t\t\t\treturn count;\n\t\t\t},\n\t\t\tdone: function(todo){\n\t\t\t\treturn function() {\n\t\t\t\t\ttodo.done(!todo.done());\n\t\t\t\t}\n\t\t\t},\n\t\t\tinput: m.prop(\"\")\n\t\t};\n\n\t\treturn ctrl;\n\t},\n\tview: function(ctrl) {\n\t\twith(sugartags) {\n\t\t\treturn DIV({\"class\": \"cw cf\"}, [\n\t\t\t\tSTYLE(\".done{text-decoration: line-through;}\"),\n\t\t\t\tH1(\"Todos - \" + ctrl.vm.left() + \" of \" + ctrl.list.length + \" remaining\"),\n\t\t\t\tBUTTON({ onclick: ctrl.archive }, \"Archive\"),\n\t\t\t\tUL([\n\t\t\t\t\tctrl.list.map(function(todo){\n\t\t\t\t\t\treturn LI({ class: todo.done()? \"done\": \"\", onclick: ctrl.vm.done(todo) }, todo.text);\n\t\t\t\t\t})\n\t\t\t\t]),\n\t\t\t\tFORM({ onsubmit: ctrl.addTodo }, [\n\t\t\t\t\tINPUT({ type: \"text\", value: ctrl.vm.input, placeholder: \"Add todo\"}),\n\t\t\t\t\tBUTTON({ type: \"submit\"}, \"Add\")\n\t\t\t\t])\n\t\t\t]);\n\t\t}\n\t}\n\t//\tTest authenticate\n\t//,authenticate: true\n};","//\tVarious utilities that normalise usage between client and server\n//\tThis is the client version - see miso.util.js for server version\nvar m = require('mithril');\n\nmodule.exports = {\n\t//\tAre we on the server?\n\tisServer: function() {\n\t\treturn false;\n\t},\n\t\n\t//\tEach abstraction\n\t//\t\n\t//\tmiso.each(['hello', 'world'], function(value, key){\n\t//\t\tconsole.log(value, key);\n\t//\t});\n\t//\t//\thello 0\\nhello 1\n\t//\n\t// \tmiso.each({'hello': 'world'}, function(value, key){\n\t//\t\tconsole.log(value, key);\n\t//\t});\n\t//\t//\tworld hello\n\t//\n\teach: function(obj, fn) {\n\t\tif(Object.prototype.toString.call(obj) === '[object Array]' ) {\n\t\t\treturn obj.map(fn);\n\t\t} else if(typeof obj == 'object') {\n\t\t\treturn Object.keys(obj).map(function(key){\n\t\t\t\treturn fn(obj[key], key);\n\t\t\t});\n\t\t} else {\n\t\t\treturn fn(obj);\n\t\t}\n\t},\n\n\treadyBinder: function(){\n\t\tvar bindings = [];\n\t\treturn {\n\t\t\tbind: function(cb) {\n\t\t\t\tbindings.push(cb);\n\t\t\t},\n\t\t\tready: function(){\n\t\t\t\tfor(var i = 0; i < bindings.length; i += 1) {\n\t\t\t\t\tbindings[i]();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t},\n\n\t//\tGet parameters for an action\n\tgetParam: function(key, params, def){\n\t\treturn typeof m.route.param(key) !== \"undefined\"? m.route.param(key): def;\n\t},\n\n\t//\tGet info for an action from the params\n\trouteInfo: function(params){\n\t\t/*\n\n\t\t\tpath: req.path,\n\t\t\tparams: req.params, \n\t\t\tquery: req.query, \n\t\t\tsession: session\n\n\t\t*/\n\t\treturn {\n\t\t\tpath: m.route(),\n\t\t\tparams: req.params, \n\t\t\tquery: req.query, \n\t\t\tsession: session\n\t\t}\n\t}\n};","/* NOTE: This is a generated file, please do not modify it, your changes will be lost */\nmodule.exports = function(m){\n\tvar getModelData = function(model){\n\t\tvar i, result = {};\n\t\tfor(i in model) {if(model.hasOwnProperty(i)) {\n\t\t\tif(i !== 'isValid') {\n\t\t\t\tif(i == 'id') {\n\t\t\t\t\tresult['_id'] = (typeof model[i] == 'function')? model[i](): model[i];\n\t\t\t\t} else {\n\t\t\t\t\tresult[i] = (typeof model[i] == 'function')? model[i](): model[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}}\n\t\treturn result;\n\t};\n\treturn {\n'find': function(args, options){\n\targs = args || {};\n\toptions = options || {};\n\tvar requestObj = {\n\t\t\tmethod:'post', \n\t\t\turl: '/api/authentication/find',\n\t\t\tdata: args\n\t\t},\n\t\trootNode = document.documentElement || document.body;\n\tfor(var i in options) {if(options.hasOwnProperty(i)){\n\t\trequestObj[i] = options[i];\n\t}}\n\tif(args.model) {\n \t\targs.model = getModelData(args.model);\n\t}\n\trootNode.className += ' loading';\n\tvar myDeferred = m.deferred();\n\tm.request(requestObj).then(function(){\n\t\trootNode.className = rootNode.className.split(' loading').join('');\n\t\tmyDeferred.resolve.apply(this, arguments);\n\t\tif(requestObj.background){\n\t\t\tm.redraw(true);\n\t\t}\n\t});\n\treturn myDeferred.promise;\n},\n'save': function(args, options){\n\targs = args || {};\n\toptions = options || {};\n\tvar requestObj = {\n\t\t\tmethod:'post', \n\t\t\turl: '/api/authentication/save',\n\t\t\tdata: args\n\t\t},\n\t\trootNode = document.documentElement || document.body;\n\tfor(var i in options) {if(options.hasOwnProperty(i)){\n\t\trequestObj[i] = options[i];\n\t}}\n\tif(args.model) {\n \t\targs.model = getModelData(args.model);\n\t}\n\trootNode.className += ' loading';\n\tvar myDeferred = m.deferred();\n\tm.request(requestObj).then(function(){\n\t\trootNode.className = rootNode.className.split(' loading').join('');\n\t\tmyDeferred.resolve.apply(this, arguments);\n\t\tif(requestObj.background){\n\t\t\tm.redraw(true);\n\t\t}\n\t});\n\treturn myDeferred.promise;\n},\n'remove': function(args, options){\n\targs = args || {};\n\toptions = options || {};\n\tvar requestObj = {\n\t\t\tmethod:'post', \n\t\t\turl: '/api/authentication/remove',\n\t\t\tdata: args\n\t\t},\n\t\trootNode = document.documentElement || document.body;\n\tfor(var i in options) {if(options.hasOwnProperty(i)){\n\t\trequestObj[i] = options[i];\n\t}}\n\tif(args.model) {\n \t\targs.model = getModelData(args.model);\n\t}\n\trootNode.className += ' loading';\n\tvar myDeferred = m.deferred();\n\tm.request(requestObj).then(function(){\n\t\trootNode.className = rootNode.className.split(' loading').join('');\n\t\tmyDeferred.resolve.apply(this, arguments);\n\t\tif(requestObj.background){\n\t\t\tm.redraw(true);\n\t\t}\n\t});\n\treturn myDeferred.promise;\n},\n'authenticate': function(args, options){\n\targs = args || {};\n\toptions = options || {};\n\tvar requestObj = {\n\t\t\tmethod:'post', \n\t\t\turl: '/api/authentication/authenticate',\n\t\t\tdata: args\n\t\t},\n\t\trootNode = document.documentElement || document.body;\n\tfor(var i in options) {if(options.hasOwnProperty(i)){\n\t\trequestObj[i] = options[i];\n\t}}\n\tif(args.model) {\n \t\targs.model = getModelData(args.model);\n\t}\n\trootNode.className += ' loading';\n\tvar myDeferred = m.deferred();\n\tm.request(requestObj).then(function(){\n\t\trootNode.className = rootNode.className.split(' loading').join('');\n\t\tmyDeferred.resolve.apply(this, arguments);\n\t\tif(requestObj.background){\n\t\t\tm.redraw(true);\n\t\t}\n\t});\n\treturn myDeferred.promise;\n},\n'login': function(args, options){\n\targs = args || {};\n\toptions = options || {};\n\tvar requestObj = {\n\t\t\tmethod:'post', \n\t\t\turl: '/api/authentication/login',\n\t\t\tdata: args\n\t\t},\n\t\trootNode = document.documentElement || document.body;\n\tfor(var i in options) {if(options.hasOwnProperty(i)){\n\t\trequestObj[i] = options[i];\n\t}}\n\tif(args.model) {\n \t\targs.model = getModelData(args.model);\n\t}\n\trootNode.className += ' loading';\n\tvar myDeferred = m.deferred();\n\tm.request(requestObj).then(function(){\n\t\trootNode.className = rootNode.className.split(' loading').join('');\n\t\tmyDeferred.resolve.apply(this, arguments);\n\t\tif(requestObj.background){\n\t\t\tm.redraw(true);\n\t\t}\n\t});\n\treturn myDeferred.promise;\n},\n'logout': function(args, options){\n\targs = args || {};\n\toptions = options || {};\n\tvar requestObj = {\n\t\t\tmethod:'post', \n\t\t\turl: '/api/authentication/logout',\n\t\t\tdata: args\n\t\t},\n\t\trootNode = document.documentElement || document.body;\n\tfor(var i in options) {if(options.hasOwnProperty(i)){\n\t\trequestObj[i] = options[i];\n\t}}\n\tif(args.model) {\n \t\targs.model = getModelData(args.model);\n\t}\n\trootNode.className += ' loading';\n\tvar myDeferred = m.deferred();\n\tm.request(requestObj).then(function(){\n\t\trootNode.className = rootNode.className.split(' loading').join('');\n\t\tmyDeferred.resolve.apply(this, arguments);\n\t\tif(requestObj.background){\n\t\t\tm.redraw(true);\n\t\t}\n\t});\n\treturn myDeferred.promise;\n},\n'findUsers': function(args, options){\n\targs = args || {};\n\toptions = options || {};\n\tvar requestObj = {\n\t\t\tmethod:'post', \n\t\t\turl: '/api/authentication/findUsers',\n\t\t\tdata: args\n\t\t},\n\t\trootNode = document.documentElement || document.body;\n\tfor(var i in options) {if(options.hasOwnProperty(i)){\n\t\trequestObj[i] = options[i];\n\t}}\n\tif(args.model) {\n \t\targs.model = getModelData(args.model);\n\t}\n\trootNode.className += ' loading';\n\tvar myDeferred = m.deferred();\n\tm.request(requestObj).then(function(){\n\t\trootNode.className = rootNode.className.split(' loading').join('');\n\t\tmyDeferred.resolve.apply(this, arguments);\n\t\tif(requestObj.background){\n\t\t\tm.redraw(true);\n\t\t}\n\t});\n\treturn myDeferred.promise;\n},\n'saveUser': function(args, options){\n\targs = args || {};\n\toptions = options || {};\n\tvar requestObj = {\n\t\t\tmethod:'post', \n\t\t\turl: '/api/authentication/saveUser',\n\t\t\tdata: args\n\t\t},\n\t\trootNode = document.documentElement || document.body;\n\tfor(var i in options) {if(options.hasOwnProperty(i)){\n\t\trequestObj[i] = options[i];\n\t}}\n\tif(args.model) {\n \t\targs.model = getModelData(args.model);\n\t}\n\trootNode.className += ' loading';\n\tvar myDeferred = m.deferred();\n\tm.request(requestObj).then(function(){\n\t\trootNode.className = rootNode.className.split(' loading').join('');\n\t\tmyDeferred.resolve.apply(this, arguments);\n\t\tif(requestObj.background){\n\t\t\tm.redraw(true);\n\t\t}\n\t});\n\treturn myDeferred.promise;\n}\n\t};\n};","//  Smooth scrolling for links\n//  Usage:      A({config: smoothScroll(ctrl), href: \"#top\"}, \"Back to top\")\nmodule.exports = function(ctrl){\n\t//var root = (typeof document !== 'undefined')? document.body || document.documentElement: this,\n\tvar root = (typeof navigator !== 'undefined')? /firefox|trident/i.test(navigator.userAgent) ? document.documentElement : document.body: null,\n\t\teaseInOutSine = function (t, b, c, d) {\n\t\t\t//  http://gizma.com/easing/\n\t\t\treturn -c/2 * (Math.cos(Math.PI*t/d) - 1) + b;\n\t\t};\n\n\treturn function(element, isInitialized) {\n\t\tif(!isInitialized) {\n\t\t\telement.addEventListener(\"click\", function(e) {\n\t\t\t\tvar startTime,\n\t\t\t\t\tstartPos = root.scrollTop,\n\t\t\t\t\tendPos = document.getElementById(/[^#]+$/.exec(this.href)[0]).getBoundingClientRect().top,\n\t\t\t\t\thash = this.href.substr(this.href.lastIndexOf(\"#\")),\n\t\t\t\t\tmaxScroll = root.scrollHeight - window.innerHeight,\n\t\t\t\t\tscrollEndValue = (startPos + endPos < maxScroll)? endPos: maxScroll - startPos,\n\t\t\t\t\tduration = typeof ctrl.duration !== 'undefined'? ctrl.duration: 1500,\n\t\t\t\t\tscrollFunc = function(timestamp) {\n\t\t\t\t\t\tstartTime = startTime || timestamp;\n\t\t\t\t\t\tvar elapsed = timestamp - startTime,\n\t\t\t\t\t\t\tprogress = easeInOutSine(elapsed, startPos, scrollEndValue, duration);\n\t\t\t\t\t\troot.scrollTop = progress;\n\t\t\t\t\t\tif(elapsed < duration) {\n\t\t\t\t\t\t\trequestAnimationFrame(scrollFunc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif(history.pushState) {\n\t\t\t\t\t\t\t\thistory.pushState(null, null, hash);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlocation.hash = hash;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\trequestAnimationFrame(scrollFunc)\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t}\n\t};\n};","module.exports = function(){ return {\"Api.md\":\"<p>The data apis in miso are a way to create a RESTful endpoint that you can interact with via an easy to use API.</p>\\n<blockquote>\\nNote: you must enable your api by adding it to the &quot;api&quot; attribute in the <code>/cfg/server.development.json</code> file, or whatever environment you are using.\\n</blockquote>\\n\\n<h2><a name=\\\"how-does-an-api-work-\\\" class=\\\"anchor\\\" href=\\\"#how-does-an-api-work-\\\"><span class=\\\"header-link\\\">How does an api work?</span></a></h2><p>The apis in miso do a number of things:</p>\\n<ul>\\n<li>Allow database access via a thin wrapper, for example to access mongodb, we wrap the popular <a href=\\\"/doc/mongoose.md\\\">mongoose npm</a> ODM package</li>\\n<li>Waits till mithril is ready - mithril has a unique feature ensures the view doesn&#39;t render till data has been retrieved - the api makes sure we adhere to this</li>\\n<li>Apis can work as a proxy, so if you want to access a 3rd party service, an api is a good way to do that - you can then also build in caching, or any other features you may wish to add.</li>\\n<li>Apis can be restricted by permissions (coming soon) </li>\\n</ul>\\n<h2><a name=\\\"how-should-you-use-apis\\\" class=\\\"anchor\\\" href=\\\"#how-should-you-use-apis\\\"><span class=\\\"header-link\\\">How should you use apis</span></a></h2><p>There are numerous scenarios where you might want to use an api:</p>\\n<ul>\\n<li>For database access (miso comes with a bunch of database apis)</li>\\n<li>For calling 3rd party end-points - using an api will allow you to create caching and setup permissions on the end-point</li>\\n</ul>\\n<h2><a name=\\\"extending-an-existing-api\\\" class=\\\"anchor\\\" href=\\\"#extending-an-existing-api\\\"><span class=\\\"header-link\\\">Extending an existing api</span></a></h2><p>If you want to add your own methods to an api, you can simply extend one of the existing apis, for example, to extend the <code>flatfiledb</code> API, create a new directory and file in <code>/modules/api/adapt/adapt.api.js</code>:</p>\\n<pre><code class=\\\"lang-javascript\\\">var db = require(&#39;../../../system/api/flatfiledb/flatfiledb.api.js&#39;);\\n\\nmodule.exports = function(m){\\n    var ad = db(m);\\n    ad.hello = function(cb, err, args, req){\\n        cb(&quot;world&quot;);\\n    };\\n    return ad;\\n};\\n</code></pre>\\n<p>Then add the api to the <code>/cfg/server.development.json</code> file like so:</p>\\n<pre><code class=\\\"lang-javascript\\\">&quot;api&quot;: &quot;adapt&quot;\\n</code></pre>\\n<p>Then require the new api file in your mvc file like so:</p>\\n<pre><code class=\\\"lang-javascript\\\">db = require(&#39;../modules/api/adapt/api.server.js&#39;)(m);\\n</code></pre>\\n<p>You can now add an api call in the controller like so:</p>\\n<pre><code class=\\\"lang-javascript\\\">db.hello({}).then(function(data){\\n// do something with data.result\\n});\\n</code></pre>\\n<p>The arguments to each api endpoint must be the same, ie:</p>\\n<pre><code class=\\\"lang-javascript\\\">function(cb, err, args, req)\\n</code></pre>\\n<p>Where:</p>\\n<table>\\n<thead>\\n<tr>\\n<th>Argument</th>\\n<th>Purpose</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>cb</td>\\n<td>A callback you must call when you are done - any data you return will be available on <code>data.result</code> in the response</td>\\n</tr>\\n<tr>\\n<td>err</td>\\n<td>A callback you must call if an unrecoverable error occurred, eg: &quot;database connection timeout&quot;. Do not use for things like &quot;no data found&quot;</td>\\n</tr>\\n<tr>\\n<td>args</td>\\n<td>A set of arguments passed in to the api method</td>\\n</tr>\\n<tr>\\n<td>req</td>\\n<td>The request object from the request</td>\\n</tr>\\n</tbody>\\n</table>\\n<p>The complete mvc example looks like so:</p>\\n<pre><code class=\\\"lang-javascript\\\">var m = require(&#39;mithril&#39;),\\n    miso = require(&#39;../server/miso.util.js&#39;),\\n    sugartags = require(&#39;mithril.sugartags&#39;)(m),\\n    db = require(&#39;../modules/api/adapt/api.server.js&#39;)(m);\\n\\nvar edit = module.exports.edit = {\\n    models: {\\n        hello: function(data){\\n            this.who = m.prop(data.who);\\n        }\\n    },\\n    controller: function(params) {\\n        var ctrl = this,\\n            who = miso.getParam(&#39;adapt_id&#39;, params);\\n\\n        db.hello({}).then(function(data){\\n            ctrl.model.who(data.result);\\n        });\\n\\n        ctrl.model = new edit.models.hello({who: who});\\n        return ctrl;\\n    },\\n    view: function(ctrl) {\\n        with(sugartags) {\\n            return DIV(&quot;G&#39;day &quot; + ctrl.model.who());\\n        }\\n    }\\n};\\n</code></pre>\\n<h2><a name=\\\"creating-custom-apis\\\" class=\\\"anchor\\\" href=\\\"#creating-custom-apis\\\"><span class=\\\"header-link\\\">Creating custom apis</span></a></h2><p>You can add your own custom apis in the <code>/modules/apis</code> directory, they have the same format as the included apis, here is an example api that calls the flickr API:</p>\\n<pre><code class=\\\"lang-javascript\\\">//    endpoint api to make http requests via flickr\\nvar request = require(&#39;request&#39;),\\n    miso = require(&#39;../../../server/miso.util.js&#39;),\\n    //    Parse out the unwanted parts of the json\\n    //    typically this would be run on the client\\n    //    we run this using &quot;request&quot; on  the server, so\\n    //    no need for the jsonp callback\\n    jsonParser = function(jsonpData){\\n        var json, startPos, endPos;\\n        try {\\n            startPos = jsonpData.indexOf(&#39;({&#39;);\\n            endPos = jsonpData.lastIndexOf(&#39;})&#39;);\\n            json = jsonpData\\n                .substring(startPos+1, endPos+1)\\n                .split(&quot;\\\\n&quot;).join(&quot;&quot;)\\n                .split(&quot;\\\\\\\\&#39;&quot;).join(&quot;&#39;&quot;);\\n\\n            return JSON.parse(json);\\n        } catch(ex) {\\n            console.log(&quot;ERROR&quot;, ex);\\n            return &quot;{}&quot;;\\n        }\\n    };\\n\\nmodule.exports = function(utils){\\n    return {\\n        photos: function(cb, err, args, req){\\n            args = args || {};\\n            var url = &quot;http://api.flickr.com/services/feeds/photos_public.gne?format=json&quot;;\\n            //    Add parameters\\n            url += miso.each(args, function(value, key){\\n                return &quot;&amp;&quot; + key + &quot;=&quot; + value;\\n            });\\n\\n            request(url, function (error, response, body) {\\n                if (!error &amp;&amp; response.statusCode == 200) {\\n                    cb(jsonParser(body));\\n                } else {\\n                    err(error);\\n                }\\n            });\\n        }\\n    };\\n};\\n</code></pre>\\n<p>To use it in your mvc file, simply:</p>\\n<pre><code class=\\\"lang-javascript\\\">flickr = require(&#39;../modules/api/flickr/api.server.js&#39;)(m);\\n</code></pre>\\n<p>And then call it like so in your controller:</p>\\n<pre><code class=\\\"lang-javascript\\\">flickr.photos({tags: &quot;Sydney opera house&quot;, tagmode: &quot;any&quot;}).then(function(data){\\n    ctrl.model.flickrData(data.result.items);\\n});\\n</code></pre>\\n\",\"Contributing.md\":\"<p>In order to contribute to misojs, please keep the following in mind:</p>\\n<h2><a name=\\\"when-adding-a-pull-request\\\" class=\\\"anchor\\\" href=\\\"#when-adding-a-pull-request\\\"><span class=\\\"header-link\\\">When adding a pull request</span></a></h2><ul>\\n<li>Be sure to only make small changes, anything more than 4 files will need to be reviewed</li>\\n<li>Make sure you explain <em>why</em> you&#39;re making the change, so we understand what the change is for</li>\\n<li>Add a unit test if appropriate</li>\\n<li>Do not be offended if we ask you to add a unit test before accepting a pull request</li>\\n<li>Use tabs not spaces (we are not flexible on this - it is a moot discussion - I really don&#39;t care, we just needed to pick one, and tabs it is)</li>\\n</ul>\\n\",\"Creating-a-todo-app-part-2-persistence.md\":\"<p>In this article we will add data persistence functionality to our todo app from the <a href=\\\"/doc/Creating-a-todo-app.md\\\">Creating a todo app</a> article. We recommend you first read that as we are going to use the app you made in this article, so if you don&#39;t already have one, grab a copy of it <a href=\\\"/doc/Creating-a-todo-app#completed-todo-app.md\\\">from here</a>, and save it in <code>/mvc/todo.js</code>.</p>\\n<p>First add the <code>flatfiledb</code> api to the <code>cfg/server.development.json</code> file:</p>\\n<pre><code class=\\\"lang-javascript\\\">&quot;api&quot;: &quot;flatfiledb&quot;\\n</code></pre>\\n<p>This makes miso load the api and expose it at the configured API url, default is &quot;/api&quot; + api name, so for the flatfiledb it will be <code>/api/flatfiledb</code>. This is all abstracted away, so you do not need to worry about what the URL is when using the api - you simply call the method you want, and the miso api takes care of the rest.</p>\\n<p>Now require the db api at the the top of the todo.js file:</p>\\n<pre><code class=\\\"lang-javascript\\\">db = require(&#39;../system/api/flatfiledb/api.server.js&#39;)(m);\\n</code></pre>\\n<p>Next add the following in the <code>ctrl.addTodo</code> function underneath the line that reads <code>ctrl.vm.input(&quot;&quot;);</code>:</p>\\n<pre><code class=\\\"lang-javascript\\\">db.save({ type: &#39;todo.index.todo&#39;, model: newTodo } ).then(function(res){\\n    newTodo._id = res.result;\\n});\\n</code></pre>\\n<p>This will save the todo to the database when you click the &quot;Add&quot; button.</p>\\n<p>Let us take a quick look at how the api works - the way that you make requests to the api depends entirely on which api you are using, for example for the flatfiledb, we have:</p>\\n<table>\\n<thead>\\n<tr>\\n<th>Method</th>\\n<th>Action</th>\\n<th>Parameters</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>save</td>\\n<td>Save or updates a model</td>\\n<td>{ type: TYPE, model: MODEL }</td>\\n</tr>\\n<tr>\\n<td>find</td>\\n<td>Finds one or more models of the give type</td>\\n<td>{ type: TYPE, query: QUERY }</td>\\n</tr>\\n<tr>\\n<td>remove</td>\\n<td>Removes an instance of a model</td>\\n<td>{ type: TYPE, id: ID }</td>\\n</tr>\\n</tbody>\\n</table>\\n<p>Where the attributes are:</p>\\n<table>\\n<thead>\\n<tr>\\n<th>Attribute</th>\\n<th>Use</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>TYPE</td>\\n<td>The namespace of the model, say you have todo.js, and the model is on <code>module.exports.index.modules.todo</code>, the type would be &quot;todo.index.todo&quot;</td>\\n</tr>\\n<tr>\\n<td>MODEL</td>\\n<td>This is an object representing the model - eg: a standard mithril model</td>\\n</tr>\\n<tr>\\n<td>QUERY</td>\\n<td>An object with attributes to filter the query results</td>\\n</tr>\\n<tr>\\n<td>ID</td>\\n<td>A unique ID for a record</td>\\n</tr>\\n</tbody>\\n</table>\\n<p>Every method returns a <a href=\\\"/doc/mithril.deferred.html#differences-from-promises-a-.md\\\">mithril style promise</a>, which means you must attach a <code>.then</code> callback function.\\nBe sure to check the methods for each api, as each will vary, depending on the functionality.</p>\\n<p>Now, let us add the capability to load our todos, add the following to the start of the controller, just after the <code>var ctrl = this</code>:</p>\\n<pre><code class=\\\"lang-javascript\\\">db.find({type: &#39;todo.index.todo&#39;}).then(function(data) {\\n    ctrl.list = Object.keys(data.result).map(function(key) {\\n        return new self.models.todo(data.result[key]);\\n    });\\n});\\n</code></pre>\\n<p>This will load your todos when the app loads up. Be sure to remove the old static list, ie: remove these lines:</p>\\n<pre><code class=\\\"lang-javascript\\\">myTodos = [{text: &quot;Learn miso&quot;}, {text: &quot;Build miso app&quot;}];\\n\\nctrl.list = Object.keys(myTodos).map(function(key) {\\n    return new self.models.todo(myTodos[key]);\\n});\\n</code></pre>\\n<p>Now you can try adding a todo, and it will save and load!</p>\\n<p>Next let us add the ability to remove your completed todos in the archive method - extend the <code>if</code> statement by adding an <code>else</code> like so: </p>\\n<pre><code class=\\\"lang-javascript\\\">} else {\\n    api.remove({ type: &#39;todo.index.todo&#39;, _id: todo._id }).then(function(response){\\n        console.log(response.result);\\n    });\\n}\\n</code></pre>\\n<p>This will remove the todo from the data store.</p>\\n<p>You now have a complete todo app, your app should look like this:</p>\\n<pre><code class=\\\"lang-javascript\\\">var m = require(&#39;mithril&#39;),\\n    sugartags = require(&#39;mithril.sugartags&#39;)(m),\\n    db = require(&#39;../system/api/flatfiledb/api.server.js&#39;)(m);\\n\\nvar self = module.exports.index = {\\n    models: {\\n        todo: function(data){\\n            this.text = data.text;\\n            this.done = m.prop(data.done == &quot;false&quot;? false: data.done);\\n            this._id = data._id;\\n        }\\n    },\\n    controller: function(params) {\\n        var ctrl = this;\\n\\n        db.find({type: &#39;todo.index.todo&#39;}).then(function(data) {\\n            ctrl.list = Object.keys(data.result).map(function(key) {\\n                return new self.models.todo(data.result[key]);\\n            });\\n        });\\n\\n        ctrl.addTodo = function(e){\\n            var value = ctrl.vm.input();\\n            if(value) {\\n                var newTodo = new self.models.todo({\\n                    text: ctrl.vm.input(),\\n                    done: false\\n                });\\n                ctrl.list.push(newTodo);\\n                ctrl.vm.input(&quot;&quot;);\\n                db.save({ type: &#39;todo.index.todo&#39;, model: newTodo } ).then(function(res){\\n                    newTodo._id = res.result;\\n                });\\n            }\\n            e.preventDefault();\\n            return false;\\n        };\\n\\n        ctrl.archive = function(){\\n            var list = [];\\n            ctrl.list.map(function(todo) {\\n                if(!todo.done()) {\\n                    list.push(todo); \\n                } else {\\n                    db.remove({ type: &#39;todo.index.todo&#39;, _id: todo._id }).then(function(response){\\n                        console.log(response.result);\\n                    });\\n                }\\n            });\\n            ctrl.list = list;\\n        };\\n\\n        ctrl.vm = {\\n            left: function(){\\n                var count = 0;\\n                ctrl.list.map(function(todo) {\\n                    count += todo.done() ? 0 : 1;\\n                });\\n                return count;\\n            },\\n            done: function(todo){\\n                return function() {\\n                    todo.done(!todo.done());\\n                }\\n            },\\n            input: m.prop(&quot;&quot;)\\n        };\\n\\n        return ctrl;\\n    },\\n    view: function(ctrl) {\\n        with(sugartags) {\\n            return [\\n                STYLE(&quot;.done{text-decoration: line-through;}&quot;),\\n                H1(&quot;Todos - &quot; + ctrl.vm.left() + &quot; of &quot; + ctrl.list.length + &quot; remaining&quot;),\\n                BUTTON({ onclick: ctrl.archive }, &quot;Archive&quot;),\\n                UL([\\n                    ctrl.list.map(function(todo){\\n                        return LI({ class: todo.done()? &quot;done&quot;: &quot;&quot;, onclick: ctrl.vm.done(todo) }, todo.text);\\n                    })\\n                ]),\\n                FORM({ onsubmit: ctrl.addTodo }, [\\n                    INPUT({ type: &quot;text&quot;, value: ctrl.vm.input, placeholder: &quot;Add todo&quot;}),\\n                    BUTTON({ type: &quot;submit&quot;}, &quot;Add&quot;)\\n                ])\\n            ]\\n        };\\n    }\\n};\\n</code></pre>\\n\",\"Creating-a-todo-app.md\":\"<p>In this article we will create a functional todo app - we recommend you first read the <a href=\\\"/doc/Getting-started.md\\\">Getting started</a> article, and understand the miso fundamentals such as where to place models and how to create a miso controller.</p>\\n<h2><a name=\\\"todo-app\\\" class=\\\"anchor\\\" href=\\\"#todo-app\\\"><span class=\\\"header-link\\\">Todo app</span></a></h2><p>We will now create a new app using the <a href=\\\"/doc/Patterns#single-url-mvc.md\\\">single url pattern</a>, which means it handles all actions autonomously, plus looks a lot like a normal mithril app.</p>\\n<p>In <code>/mvc</code> save a new file as <code>todo.js</code> with the following content: </p>\\n<pre><code class=\\\"lang-javascript\\\">var m = require(&#39;mithril&#39;);\\n\\nvar self = module.exports.index = {\\n    models: {},\\n    controller: function(params) {\\n        var ctrl = this;\\n        return ctrl;\\n    },\\n    view: function(ctrl) {\\n        return &quot;TODO&quot;;\\n    }\\n};\\n</code></pre>\\n<p>Now open: <a href=\\\"/doc/todos.md\\\">http://localhost:6476/todos</a> and you&#39;ll see the word &quot;TODO&quot;. You&#39;ll notice that the url is &quot;/todos&quot; with an &#39;s&#39; on the end - as we are using <a href=\\\"/doc/How-miso-works#route-by-convention.md\\\">route by convention</a> to map our route.</p>\\n<p>Next let&#39;s create the model for our todos - change the <code>models</code> attribute to the following:</p>\\n<pre><code class=\\\"lang-javascript\\\">models: {\\n    todo: function(data){\\n        this.text = data.text;\\n        this.done = m.p(data.done == &quot;false&quot;? false: data.done);\\n        this._id = data._id;\\n    }\\n},\\n</code></pre>\\n<p>Each line in the model does the following:</p>\\n<ul>\\n<li><code>this.text</code> - The text that is shown on the todo</li>\\n<li><code>this.done</code> - This represents if the todo has been completed - we ensure that we handle the &quot;false&quot; values correctly, as ajax responses are always strings.</li>\\n<li><code>this._id</code> - The key for the todo</li>\\n</ul>\\n<p>The model can now be used to store and retreive todos - miso automatically picks up any objects on the <code>models</code> attribute of your mvc file, and maps it in the API. We will soon see how that works. Next add the following code as the controller:</p>\\n<pre><code class=\\\"lang-javascript\\\">controller: function(params) {\\n    var ctrl = this,\\n        myTodos = [{text: &quot;Learn miso&quot;}, {text: &quot;Build miso app&quot;}];\\n    ctrl.list = Object.keys(myTodos).map(function(key) {\\n        return new self.models.todo(myTodos[key]);\\n    });\\n    return ctrl;\\n},\\n</code></pre>\\n<p>This does the following:</p>\\n<ul>\\n<li>Creates <code>myTodos</code> which is a list of objects that represents todos</li>\\n<li><code>this.list</code> - creates a list of todo model objects by using <code>new self.models.todo(...</code> on each myTodos object.</li>\\n<li><code>return this</code> must be done in all controllers, it makes sure that miso can correctly get access to the controller object.</li>\\n</ul>\\n<p>Note: we always create a local variable <code>ctrl</code> that points to the controller, as it can be used to access variables in the controller from nested functions. You will see this usage later on in this article.</p>\\n<p>Now update the view like so:</p>\\n<pre><code class=\\\"lang-javascript\\\">view: function(ctrl) {\\n    return m(&quot;UL&quot;, [\\n        ctrl.list.map(function(todo){\\n            return m(&quot;LI&quot;, todo.text)\\n        })\\n    ]);\\n}\\n</code></pre>\\n<p>This will iterate on your newly created list of todo model objects and display the on screen. Your todo app should now look like this:</p>\\n<h3><a name=\\\"half-way-point\\\" class=\\\"anchor\\\" href=\\\"#half-way-point\\\"><span class=\\\"header-link\\\">Half-way point</span></a></h3><pre><code class=\\\"lang-javascript\\\">var m = require(&#39;mithril&#39;);\\n\\nvar self = module.exports.index = {\\n    models: {\\n        todo: function(data){\\n            this.text = data.text;\\n            this.done = m.p(data.done == &quot;false&quot;? false: data.done);\\n            this._id = data._id;\\n        }\\n    },\\n    controller: function(params) {\\n        var ctrl = this,\\n            myTodos = [{text: &quot;Learn miso&quot;}, {text: &quot;Build miso app&quot;}];\\n        ctrl.list = Object.keys(myTodos).map(function(key) {\\n            return new self.models.todo(myTodos[key]);\\n        });\\n        return ctrl;\\n    },\\n    view: function(ctrl) {\\n        return m(&quot;UL&quot;, [\\n            ctrl.list.map(function(todo){\\n                return m(&quot;LI&quot;, todo.text)\\n            })\\n        ]);\\n    }\\n};\\n</code></pre>\\n<blockquote>\\nSo far we have only used pure mithril to create our app - miso did do some of the grunt-work behind the scenes, but we can do much more.\\n</blockquote>\\n\\n\\n<p>Let us add some useful libraries, change the top section to:</p>\\n<pre><code class=\\\"lang-javascript\\\">var m = require(&#39;mithril&#39;),\\n    sugartags = require(&#39;mithril.sugartags&#39;)(m),\\n    bindings = require(&#39;../server/mithril.bindings.node.js&#39;)(m);\\n</code></pre>\\n<p>This will include the following libraries:</p>\\n<ul>\\n<li><a href=\\\"/doc/mithril.sugartags.md\\\">mithril.sugartags</a> - allows rendering HTML using tags that look a little more like HTML than standard mithril</li>\\n<li><a href=\\\"/doc/mithril.bindings.md\\\">mithril.bindings</a> Bi-directional data bindings for richer models</li>\\n</ul>\\n<p>Let us start with the sugar tags, update the view to read:</p>\\n<pre><code class=\\\"lang-javascript\\\">view: function(ctrl) {\\n    with(sugartags) {\\n        return UL([\\n            ctrl.list.map(function(todo){\\n                return LI(todo.text)\\n            })\\n        ])\\n    };\\n}\\n</code></pre>\\n<p>So using sugartags allows us to write more concise views, that look more like natural HTML.</p>\\n<p>Next let us add a <a href=\\\"/doc/what-is-a-view-model.html.md\\\">view model</a> to the controller. A view model is simply a model that contains data about the view, and auxillary functionality, ie: data and other things that we don&#39;t want to persist. Add this to the controller:</p>\\n<pre><code class=\\\"lang-javascript\\\">ctrl.vm = {\\n    done: function(todo){\\n        return function() {\\n            todo.done(!todo.done());\\n        }\\n    }\\n};\\n</code></pre>\\n<p>This method will return a function that toggles the <code>done</code> attribute on the passed in todo. </p>\\n<blockquote>\\nYou might be tempted to put this functionality into the model, but in miso, we need to strictly keep data in the data model, as we are able to persist it.\\n</blockquote>\\n\\n<p>Next update the view to:</p>\\n<pre><code class=\\\"lang-javascript\\\">view: function(ctrl) {\\n    with(sugartags) {\\n        return [\\n            STYLE(&quot;.done{text-decoration: line-through;}&quot;),\\n            UL([\\n                ctrl.list.map(function(todo){\\n                    return LI({ class: todo.done()? &quot;done&quot;: &quot;&quot;, onclick: ctrl.vm.done(todo) }, todo.text);\\n                })\\n            ])\\n        ]\\n    };\\n}\\n</code></pre>\\n<p>This will make the list of todos clickable, and put a strike-through the todo when it is set to &quot;done&quot;, neat!</p>\\n<p>Now let us add a counter, to show how many todos are left, put this into the view model you created in the previous step:</p>\\n<pre><code class=\\\"lang-javascript\\\">left: function(){\\n    var count = 0;\\n    ctrl.list.map(function(todo) {\\n        count += todo.done() ? 0 : 1;\\n    });\\n    return count;\\n}\\n</code></pre>\\n<p>And in the view, add the following above the UL:</p>\\n<pre><code class=\\\"lang-javascript\\\">H1(&quot;Todos - &quot; + ctrl.vm.left() + &quot; of &quot; + ctrl.list.length + &quot; remaining&quot;),\\n</code></pre>\\n<p>This will now display a nice header showing how many todos are left.</p>\\n<p>Next let us add an input field, so you can add new todos, in the view model, (the <code>ctrl.vm</code> object), add the following line:</p>\\n<pre><code class=\\\"lang-javascript\\\">input: m.p(&quot;&quot;)\\n</code></pre>\\n<p>In the controller, add:</p>\\n<pre><code class=\\\"lang-javascript\\\">ctrl.addTodo = function(e){\\n    var value = ctrl.vm.input();\\n    if(value) {\\n        var newTodo = new self.models.todo({\\n            text: ctrl.vm.input(),\\n            done: false\\n        });\\n        ctrl.list.push(newTodo);\\n        ctrl.vm.input(&quot;&quot;);\\n    }\\n    e.preventDefault();\\n    return false;\\n};\\n</code></pre>\\n<p>This function creates a new todo based on the input text, and adds it to the list of todos.</p>\\n<p>And in the view just below the UL, add:</p>\\n<pre><code class=\\\"lang-javascript\\\">FORM({ onsubmit: ctrl.addTodo }, [\\n    INPUT({ type: &quot;text&quot;, value: ctrl.vm.input, placeholder: &quot;Add todo&quot;}),\\n    BUTTON({ type: &quot;submit&quot;}, &quot;Add&quot;)\\n])\\n</code></pre>\\n<p>As you can see, we assign the <code>addTodo</code> method of the controller to the onsubmit function of the form, so that it will correctly add the todo when you click the &quot;Add&quot; button.</p>\\n<p>Next, let us add the ability to archive old todos, add the following into the controller:</p>\\n<pre><code class=\\\"lang-javascript\\\">ctrl.archive = function(){\\n    var list = [];\\n    ctrl.list.map(function(todo) {\\n        if(!todo.done()) {\\n            list.push(todo); \\n        }\\n    });\\n    ctrl.list = list;\\n};\\n</code></pre>\\n<p>And this button below the H1:</p>\\n<pre><code class=\\\"lang-javascript\\\">BUTTON({ onclick: ctrl.archive }, &quot;Archive&quot;),\\n</code></pre>\\n<h3><a name=\\\"completed-todo-app\\\" class=\\\"anchor\\\" href=\\\"#completed-todo-app\\\"><span class=\\\"header-link\\\">Completed todo app</span></a></h3><p>And you can now archive your todos. This completes the todo app functionally, your complete todo app should look like this:</p>\\n<pre><code class=\\\"lang-javascript\\\">var m = require(&#39;mithril&#39;),\\n    sugartags = require(&#39;mithril.sugartags&#39;)(m),\\n    bindings = require(&#39;../server/mithril.bindings.node.js&#39;)(m);\\n\\nvar self = module.exports.index = {\\n    models: {\\n        todo: function(data){\\n            this.text = data.text;\\n            this.done = m.prop(data.done == &quot;false&quot;? false: data.done);\\n            this._id = data._id;\\n        }\\n    },\\n    controller: function(params) {\\n        var ctrl = this,\\n            myTodos = [{text: &quot;Learn miso&quot;}, {text: &quot;Build miso app&quot;}];\\n\\n        ctrl.list = Object.keys(myTodos).map(function(key) {\\n            return new self.models.todo(myTodos[key]);\\n        });\\n\\n        ctrl.addTodo = function(e){\\n            var value = ctrl.vm.input();\\n            if(value) {\\n                var newTodo = new self.models.todo({\\n                    text: ctrl.vm.input(),\\n                    done: false\\n                });\\n                ctrl.list.push(newTodo);\\n                ctrl.vm.input(&quot;&quot;);\\n            }\\n            e.preventDefault();\\n            return false;\\n        };\\n\\n        ctrl.archive = function(){\\n            var list = [];\\n            ctrl.list.map(function(todo) {\\n                if(!todo.done()) {\\n                    list.push(todo); \\n                }\\n            });\\n            ctrl.list = list;\\n        };\\n\\n        ctrl.vm = {\\n            left: function(){\\n                var count = 0;\\n                ctrl.list.map(function(todo) {\\n                    count += todo.done() ? 0 : 1;\\n                });\\n                return count;\\n            },\\n            done: function(todo){\\n                return function() {\\n                    todo.done(!todo.done());\\n                }\\n            },\\n            input: m.p(&quot;&quot;)\\n        };\\n\\n        return ctrl;\\n    },\\n    view: function(ctrl) {\\n        with(sugartags) {\\n            return [\\n                STYLE(&quot;.done{text-decoration: line-through;}&quot;),\\n                H1(&quot;Todos - &quot; + ctrl.vm.left() + &quot; of &quot; + ctrl.list.length + &quot; remaining&quot;),\\n                BUTTON({ onclick: ctrl.archive }, &quot;Archive&quot;),\\n                UL([\\n                    ctrl.list.map(function(todo){\\n                        return LI({ class: todo.done()? &quot;done&quot;: &quot;&quot;, onclick: ctrl.vm.done(todo) }, todo.text);\\n                    })\\n                ]),\\n                FORM({ onsubmit: ctrl.addTodo }, [\\n                    INPUT({ type: &quot;text&quot;, value: ctrl.vm.input, placeholder: &quot;Add todo&quot;}),\\n                    BUTTON({ type: &quot;submit&quot;}, &quot;Add&quot;)\\n                ])\\n            ]\\n        };\\n    }\\n};\\n</code></pre>\\n<p>Next we recommend you read</p>\\n<p><a href=\\\"/doc/Creating-a-todo-app-part-2-persistence.md\\\">Creating a todo app part 2 - persistence</a>, where we will go through adding data persistence functionality.</p>\\n\",\"Getting-started.md\":\"<p>This guide will take you through making your first miso app, it is assumed that you know the basics of how to use nodejs and mithril.</p>\\n<h2><a name=\\\"installation\\\" class=\\\"anchor\\\" href=\\\"#installation\\\"><span class=\\\"header-link\\\">Installation</span></a></h2><p>To install miso, use npm:</p>\\n<pre><code class=\\\"lang-javascript\\\">npm install misojs -g\\n</code></pre>\\n<p>To create and run a miso app in a new directory:</p>\\n<pre><code class=\\\"lang-javascript\\\">miso -n myapp\\ncd myapp\\nmiso run\\n</code></pre>\\n<p>You should now see something like:</p>\\n<pre><code>Miso is listening at http://localhost:6476 in development mode\\n</code></pre><p>Open your browser at <code>http://localhost:6476</code> and you will see the default miso screen</p>\\n<h2><a name=\\\"hello-world-app\\\" class=\\\"anchor\\\" href=\\\"#hello-world-app\\\"><span class=\\\"header-link\\\">Hello world app</span></a></h2><p>Create a new file <code>hello.js</code> in <code>myapp/mvc</code> like so:</p>\\n<pre><code class=\\\"lang-javascript\\\">var m = require(&#39;mithril&#39;),\\n    miso = require(&#39;../server/miso.util.js&#39;),\\n    sugartags = require(&#39;mithril.sugartags&#39;)(m);\\n\\nvar edit = module.exports.edit = {\\n    models: {\\n        hello: function(data){\\n            this.who = m.prop(data.who);\\n        }\\n    },\\n    controller: function(params) {\\n        var who = miso.getParam(&#39;hello_id&#39;, params);\\n        this.model = new edit.models.hello({who: who});\\n        return this;\\n    },\\n    view: function(ctrl) {\\n        with(sugartags) {\\n            return DIV(&quot;Hello &quot; + ctrl.model.who());\\n        }\\n    }\\n};\\n</code></pre>\\n<p>Then open <a href=\\\"/doc/YOURNAME.md\\\">http://localhost:6476/hello/YOURNAME</a> and you should see &quot;Hello YOURNAME&quot;. Change the url to have your actual name instead of YOURNAME, you now know miso :)</p>\\n<p>Let us take a look at what each piece of the code is actually doing:</p>\\n<h3><a name=\\\"includes\\\" class=\\\"anchor\\\" href=\\\"#includes\\\"><span class=\\\"header-link\\\">Includes</span></a></h3><blockquote>\\nSummary: Mithril is the only required library when apps, but using other included libraries is very useful\\n</blockquote>\\n\\n<pre><code class=\\\"lang-javascript\\\">var m = require(&#39;mithril&#39;),\\n    miso = require(&#39;../server/miso.util.js&#39;),\\n    sugartags = require(&#39;mithril.sugartags&#39;)(m);\\n</code></pre>\\n<p>Here we grab mithril, then miso utilities and sugar tags - technically speaking, we really only need mithril, but the other libraries are very useful as well as we will see.</p>\\n<h3><a name=\\\"models\\\" class=\\\"anchor\\\" href=\\\"#models\\\"><span class=\\\"header-link\\\">Models</span></a></h3><blockquote>\\nSummary: Use the automatic routing when you can, always put models on the &#39;models&#39; attribute of your mvc file\\n</blockquote>\\n\\n<pre><code class=\\\"lang-javascript\\\">var edit = module.exports.edit = {\\n    models: {\\n        hello: function(data){\\n            this.who = m.prop(data.who);\\n        }\\n    },\\n</code></pre>\\n<p>Here a few important things are going on:</p>\\n<ul>\\n<li><p>By placing our <code>mvc</code> object on <code>module.exports.edit</code>, automatic routing is applied by miso - you can read more about <a href=\\\"/doc/How-miso-works#route-by-convention.md\\\">how the automatic routing works here</a>. </p>\\n</li>\\n<li><p>Placing our <code>hello</code> model on the <code>models</code> attribute of the object ensures that miso can figure out what your models are, and will create a persistence API automatically for you when the server starts up, so that you can save your models into the database.</p>\\n</li>\\n</ul>\\n<h3><a name=\\\"controller\\\" class=\\\"anchor\\\" href=\\\"#controller\\\"><span class=\\\"header-link\\\">Controller</span></a></h3><blockquote>\\nSummary: DO NOT forget to &#39;return this;&#39; in the controller, it is vital!\\n</blockquote>\\n\\n<pre><code class=\\\"lang-javascript\\\">controller: function(params) {\\n    var who = miso.getParam(&#39;hello_id&#39;, params);\\n    this.model = new edit.models.hello({who: who});\\n    return this;\\n},\\n</code></pre>\\n<p>The controller uses <code>miso.getParam</code> to retreive the parameter - this is so that it can work seamlessly on both the server and client side. We create a new model, and very importantly <code>return this</code> ensures that miso can get access to the controller correctly.</p>\\n<h3><a name=\\\"view\\\" class=\\\"anchor\\\" href=\\\"#view\\\"><span class=\\\"header-link\\\">View</span></a></h3><blockquote>\\nSummary: Use sugartags to make the view look more like HTML\\n</blockquote>\\n\\n<pre><code class=\\\"lang-javascript\\\">view: function(ctrl) {\\n    with(sugartags) {\\n        return DIV(&quot;Hello &quot; + ctrl.model.who());\\n    }\\n}\\n</code></pre>\\n<p>The view is simply a javascript function that returns a structure. Here we use the <code>sugartags</code> library to render the DIV tag - this is strictly not required, but I find that people tend to understand the sugartags syntax better than pure mithril, as it looks a little more like HTML, though of course you could use standard mithril syntax if you prefer.</p>\\n<h3><a name=\\\"next\\\" class=\\\"anchor\\\" href=\\\"#next\\\"><span class=\\\"header-link\\\">Next</span></a></h3><p>You now have a complete hello world app, and understand the fundamentals of the structure of a miso mvc application.</p>\\n<p>We have only just scraped the surface of what miso is capable of, so next we recommend you read:</p>\\n<p><a href=\\\"/doc/Creating-a-todo-app.md\\\">Creating a todo app</a></p>\\n\",\"Goals.md\":\"<h1><a name=\\\"primary-goals\\\" class=\\\"anchor\\\" href=\\\"#primary-goals\\\"><span class=\\\"header-link\\\">Primary goals</span></a></h1><ul>\\n<li>Easy setup of <a href=\\\"/doc/.md\\\">isomorphic</a> application based on <a href=\\\"/doc/mithril.js.md\\\">mithril</a></li>\\n<li>Skeleton / scaffold / Boilerplate to allow users to very quickly get up and running.</li>\\n<li>minimal core</li>\\n<li>easy extendible</li>\\n<li>DB agnostic (e. G. plugins for different ORM/ODM)</li>\\n</ul>\\n<h1><a name=\\\"components\\\" class=\\\"anchor\\\" href=\\\"#components\\\"><span class=\\\"header-link\\\">Components</span></a></h1><ul>\\n<li>Routing</li>\\n<li>View rendering</li>\\n<li>i18n/l10n</li>\\n<li>Rest-API (could use restify: <a href=\\\"/doc/.md\\\">http://mcavage.me/node-restify/</a>)</li>\\n<li>optional Websockets (could use restify: <a href=\\\"/doc/.md\\\">http://mcavage.me/node-restify/</a>)</li>\\n<li>easy testing (headless and Browser-Tests)</li>\\n<li>login/session handling</li>\\n<li>models with validation</li>\\n</ul>\\n<h1><a name=\\\"useful-libs\\\" class=\\\"anchor\\\" href=\\\"#useful-libs\\\"><span class=\\\"header-link\\\">Useful libs</span></a></h1><p>Here are some libraries we are considering using, (in no particular order):</p>\\n<ul>\\n<li>leveldb</li>\\n<li>mithril-query</li>\\n<li>translate.js</li>\\n<li>i18next</li>\\n</ul>\\n<p>And some that we&#39;re already using:</p>\\n<ul>\\n<li>express</li>\\n<li>browserify</li>\\n<li>mocha/expect</li>\\n<li>mithril-node-render</li>\\n<li>mithril-sugartags</li>\\n<li>mithril-bindings</li>\\n<li>mithril-animate</li>\\n<li>lodash</li>\\n<li>validator</li>\\n</ul>\\n\",\"Home.md\":\"<p>Welcome to the misojs wiki!</p>\\n<h2><a name=\\\"getting-started\\\" class=\\\"anchor\\\" href=\\\"#getting-started\\\"><span class=\\\"header-link\\\">Getting started</span></a></h2><p>Read the <a href=\\\"/doc/Getting-started.md\\\">Getting started</a> guide!</p>\\n<h2><a name=\\\"more-info\\\" class=\\\"anchor\\\" href=\\\"#more-info\\\"><span class=\\\"header-link\\\">More info</span></a></h2><p>See the <a href=\\\"/doc/misojs#install.md\\\">install guide</a>.\\nRead <a href=\\\"/doc/How-miso-works.md\\\">how miso works</a>, and check out <a href=\\\"/doc/Patterns.md\\\">the patterns</a>, then create something cool!</p>\\n\",\"How-miso-works.md\":\"<h2><a name=\\\"models-views-controllers\\\" class=\\\"anchor\\\" href=\\\"#models-views-controllers\\\"><span class=\\\"header-link\\\">Models, views, controllers</span></a></h2><p>When creating a route, you must assign a controller and a view to it - this is achieved by creating a file in the <code>/mvc</code> directory - by convention, you should name it as per the path you want, (see the <a href=\\\"/doc/#routing.md\\\">routing section</a> for details).</p>\\n<p>Here is a minimal example using the sugartags, and getting a parameter:</p>\\n<pre><code class=\\\"lang-javascript\\\">var m = require(&#39;mithril&#39;),\\n    miso = require(&#39;../server/miso.util.js&#39;),\\n    sugartags = require(&#39;../server/mithril.sugartags.node.js&#39;)(m);\\n\\nmodule.exports.index = {\\n    controller: function(params) {\\n        this.who = miso.getParam(&#39;who&#39;, params, &#39;world&#39;);\\n        return this;\\n    },\\n    view: function(ctrl){\\n        with(sugartags) {\\n            return DIV(&#39;Hello &#39; + ctrl.who);\\n        }\\n    }\\n};\\n</code></pre>\\n<p>Save this into a file <code>/mvc/hello.js</code>, and open <a href=\\\"/doc/hellos.md\\\">http://localhost/hellos</a>, this will show &quot;Hello world&quot;. Note the &#39;s&#39; on the end - this is due to how the <a href=\\\"/doc/#route-by-convention.md\\\">route by convention</a> works.</p>\\n<p>Now open <code>/cfg/routes.json</code>, and add the following routes:</p>\\n<pre><code class=\\\"lang-javascript\\\">    &quot;/hello&quot;: { &quot;method&quot;: &quot;get&quot;, &quot;name&quot;: &quot;hello&quot;, &quot;action&quot;: &quot;index&quot; },\\n    &quot;/hello/:who&quot;: { &quot;method&quot;: &quot;get&quot;, &quot;name&quot;: &quot;hello&quot;, &quot;action&quot;: &quot;index&quot; }\\n</code></pre>\\n<p>Save the file, and go back to the browser, and you&#39;ll see an error! This is because we have now overridden the automatic route. Open <a href=\\\"/doc/hello.md\\\">http://localhost/hello</a>, and you&#39;ll see our action. Now open <a href=\\\"/doc/YOURNAME.md\\\">http://localhost/hello/YOURNAME</a>, and you&#39;ll see it getting the first parameter, and greeting you!</p>\\n<h2><a name=\\\"routing\\\" class=\\\"anchor\\\" href=\\\"#routing\\\"><span class=\\\"header-link\\\">Routing</span></a></h2><p>The routing can be defined in one of two ways</p>\\n<h3><a name=\\\"route-by-convention\\\" class=\\\"anchor\\\" href=\\\"#route-by-convention\\\"><span class=\\\"header-link\\\">Route by convention</span></a></h3><p>You can use a naming convention as follows:</p>\\n<table>\\n<thead>\\n<tr>\\n<th>Action</th>\\n<th>Method</th>\\n<th>URL</th>\\n<th>Description</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>index</td>\\n<td>GET</td>\\n<td>[controller] + &#39;s&#39;</td>\\n<td>List the items</td>\\n</tr>\\n<tr>\\n<td>edit</td>\\n<td>GET</td>\\n<td>[controller]/[id]</td>\\n<td>Display a form to edit the item</td>\\n</tr>\\n<tr>\\n<td>new</td>\\n<td>GET</td>\\n<td>[controller] + &#39;s&#39; + &#39;/new&#39;</td>\\n<td>Display a form to add a new item</td>\\n</tr>\\n</tbody>\\n</table>\\n<p>Say you have a mvc file named &quot;user.js&quot;, and you define an action like so:</p>\\n<pre><code class=\\\"lang-javascript\\\">module.exports.index = {...\\n</code></pre>\\n<p>Miso will automatically map a &quot;GET&quot; to &quot;/users&quot;.<br>Now say you have a mvc file named &quot;user.js&quot;, and you define an action like so:</p>\\n<pre><code class=\\\"lang-javascript\\\">module.exports.edit = {...\\n</code></pre>\\n<p>Miso will automatically map a &quot;GET&quot; to &quot;/user/:user_id&quot;, so that users can access via a route such as &quot;/user/27&quot; for use with ID of 27. <em>Note:</em> You can get the user_id using a miso utility: <code>var userId = miso.getParam(&#39;user_id&#39;, params);</code>.</p>\\n<h3><a name=\\\"route-by-configuration\\\" class=\\\"anchor\\\" href=\\\"#route-by-configuration\\\"><span class=\\\"header-link\\\">Route by configuration</span></a></h3><p>By using <code>/cfg/routes.json</code> config file:</p>\\n<pre><code class=\\\"lang-javascript\\\">{\\n    &quot;[Pattern]&quot;: { &quot;method&quot;: &quot;[Method]&quot;, &quot;name&quot;: &quot;[Route name]&quot;, &quot;action&quot;: &quot;[Action]&quot; }\\n}\\n</code></pre>\\n<p>Where:</p>\\n<ul>\\n<li><strong>Pattern</strong> - the <a href=\\\"/doc/#routing-patterns.md\\\">route pattern</a> we want, including any parameters</li>\\n<li><strong>Method</strong> - one of &#39;GET&#39;, &#39;POST&#39;, &#39;PUT&#39;, &#39;DELETE&#39;</li>\\n<li><strong>Route</strong> name - name of your route file from /mvc</li>\\n<li><strong>Action</strong> - name of the action to call on your route file from /mvc</li>\\n</ul>\\n<p><strong>Example</strong></p>\\n<pre><code class=\\\"lang-javascript\\\">{\\n    &quot;/&quot;: { &quot;method&quot;: &quot;get&quot;, &quot;name&quot;: &quot;home&quot;, &quot;action&quot;: &quot;index&quot; }\\n}\\n</code></pre>\\n<p>This will map a &quot;GET&quot; to the root of the URL for the <code>index</code> action in <code>home.js</code></p>\\n<p><strong>Note:</strong> The routing config will override any automatically defined routes, so if you need multiple routes to point to the same action, you must manually define them. For example, if you have a mvc file named &quot;term.js&quot;, and you define an action like so:</p>\\n<pre><code class=\\\"lang-javascript\\\">module.exports.index = {...\\n</code></pre>\\n<p>Miso will automatically map a &quot;GET&quot; to &quot;/terms&quot;. Now, if you want to map it also to &quot;/AGB&quot;, you will need to add two entries in the routes config:</p>\\n<pre><code class=\\\"lang-javascript\\\">{\\n    &quot;/terms&quot;: { &quot;method&quot;: &quot;get&quot;, &quot;name&quot;: &quot;terms&quot;, &quot;action&quot;: &quot;index&quot; },\\n    &quot;/AGB&quot;: { &quot;method&quot;: &quot;get&quot;, &quot;name&quot;: &quot;terms&quot;, &quot;action&quot;: &quot;index&quot; }\\n}\\n</code></pre>\\n<p>This is because Miso assumes that if you override the defaulted routes, you actually want to replace them, not just override them. <em>Note:</em> this is correct behaviour, as it minority case is when you want more than one route pointing to the same action.</p>\\n<h3><a name=\\\"routing-patterns\\\" class=\\\"anchor\\\" href=\\\"#routing-patterns\\\"><span class=\\\"header-link\\\">Routing patterns</span></a></h3><table>\\n<thead>\\n<tr>\\n<th>Type</th>\\n<th>Example</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>Path</td>\\n<td>&quot;/abcd&quot; - match paths starting with /abcd</td>\\n</tr>\\n<tr>\\n<td>Path Pattern</td>\\n<td>&quot;/abc?d&quot; - match paths starting with /abcd and /abd</td>\\n</tr>\\n<tr>\\n<td>Path Pattern</td>\\n<td>&quot;/ab+cd&quot; - match paths starting with /abcd, /abbcd, /abbbbbcd and so on</td>\\n</tr>\\n<tr>\\n<td>Path Pattern</td>\\n<td>&quot;/ab*cd&quot; - match paths starting with /abcd, /abxcd, /abFOOcd, /abbArcd and so on</td>\\n</tr>\\n<tr>\\n<td>Path Pattern</td>\\n<td>&quot;/a(bc)?d&quot; - will match paths starting with /ad and /abcd</td>\\n</tr>\\n<tr>\\n<td>Regular Expression</td>\\n<td>/\\\\/abc&#124;\\\\/xyz/ - will match paths starting with /abc and /xyz</td>\\n</tr>\\n<tr>\\n<td>Array</td>\\n<td>[&quot;/abcd&quot;, &quot;/xyza&quot;, /\\\\/lmn&#124;\\\\/pqr/] - match paths starting with /abcd, /xyza, /lmn, and /pqr</td>\\n</tr>\\n</tbody>\\n</table>\\n<h3><a name=\\\"links\\\" class=\\\"anchor\\\" href=\\\"#links\\\"><span class=\\\"header-link\\\">Links</span></a></h3><p>When you create links, in order to get the app to work as an SPA, you must pass in m.route as a config, so that the history will be updated correctly, for example:</p>\\n<pre><code class=\\\"lang-javascript\\\">A({href:&quot;/users/new&quot;, config: m.route}, &quot;Add new user&quot;)\\n</code></pre>\\n<p>This will correctly work as a SPA. If you leave out <code>config: m.route</code>, the app will still work, but the page will reload every time the link is followed.</p>\\n<p>Note: if you are planning to manually route, ie: use <code>m.route</code>, be sure to use the name of the route, not a URL. Ie: if you have a route &quot;/account&quot;, using <code>m.route(&quot;http://p1.io/account&quot;)</code> won&#39;t match, mithril is expecting <code>m.route(&quot;/account&quot;)</code> instead of the full URL.</p>\\n<h2><a name=\\\"data-models\\\" class=\\\"anchor\\\" href=\\\"#data-models\\\"><span class=\\\"header-link\\\">Data models</span></a></h2><p>Data models are progressively enhanced mithril models - you simply create your model as usual, then add validation and type information as it becomes pertinent.\\nFor example, say you have a model like so:</p>\\n<pre><code class=\\\"lang-javascript\\\">var userModel = function(data){\\n    this.name = m.p(data.name||&quot;&quot;);\\n    this.email = m.p(data.email||&quot;&quot;);\\n    this.id = m.p(data._id||&quot;&quot;);\\n    return this;\\n}\\n</code></pre>\\n<p>In order to make it validatable, add the validator module:</p>\\n<pre><code class=\\\"lang-javascript\\\">var validate = require(&#39;validator.modelbinder&#39;);\\n</code></pre>\\n<p>Then add a <code>isValid</code> validation method to your model, with any declarations based on <a href=\\\"/doc/validator.js#validators.md\\\">node validator</a>:</p>\\n<pre><code class=\\\"lang-javascript\\\">var userModel = function(data){\\n    this.name = m.p(data.name||&quot;&quot;);\\n    this.email = m.p(data.email||&quot;&quot;);\\n    this.id = m.p(data._id||&quot;&quot;);\\n\\n    //    Validate the model        \\n    this.isValid = validate.bind(this, {\\n        name: {\\n            isRequired: &quot;You must enter a name&quot;\\n        },\\n        email: {\\n            isRequired: &quot;You must enter an email address&quot;,\\n            isEmail: &quot;Must be a valid email address&quot;\\n        }\\n    });\\n\\n    return this;\\n};\\n</code></pre>\\n<p>This creates a method that the miso database api can use to validate your model.\\nYou get full access to the validation info as well, so you can show an error message near your field, for example:</p>\\n<pre><code class=\\\"lang-javascript\\\">user.isValid(&#39;email&#39;)\\n</code></pre>\\n<p>Will return <code>true</code> if the <code>email</code> property of your user model is valid, or a list of errors messages if it is invalid:</p>\\n<pre><code class=\\\"lang-javascript\\\">[&quot;You must enter an email address&quot;, &quot;Must be a valid email address&quot;]\\n</code></pre>\\n<p>So you can for example add a class name to a div surrounding your field like so:</p>\\n<pre><code class=\\\"lang-javascript\\\">DIV({class: (ctrl.user.isValid(&#39;email&#39;) == true? &quot;valid&quot;: &quot;invalid&quot;)}, [...\\n</code></pre>\\n<p>And show the error messages like so:</p>\\n<pre><code class=\\\"lang-javascript\\\">SPAN(ctrl.user.isValid(&#39;email&#39;) == true? &quot;&quot;: ctrl.user.isValid(&#39;email&#39;).join(&quot;, &quot;))\\n</code></pre>\\n<h2><a name=\\\"database-api-and-model-interaction\\\" class=\\\"anchor\\\" href=\\\"#database-api-and-model-interaction\\\"><span class=\\\"header-link\\\">Database api and model interaction</span></a></h2><p>Miso uses the model definitions that you declare in your <code>mvc</code> file to build up a set of models that the API can use, the model definitions work like this:</p>\\n<ul>\\n<li>On the models attribute of the mvc, we  define a standard mithril data model, (ie: a javascript object where properties can be either standard javascript data types, or a function that works as a getter/setter, eg: <code>m.prop</code>)</li>\\n<li>On server startup, miso reads this and creates a cache of the model objects, including the name space of the model, eg: &quot;hello.edit.hello&quot;</li>\\n<li>Models can optionally include data validation information, and the database api will get access to this.</li>\\n</ul>\\n<p>Assuming we have a model in the hello.models object like so:</p>\\n<pre><code class=\\\"lang-javascript\\\">hello: function(data){\\n    this.who = m.prop(data.who);\\n    this.isValid = validate.bind(this, {\\n        who: {\\n            isRequired: &quot;You must know who you are talking to&quot;\\n        }\\n    });\\n}\\n</code></pre>\\n<p>The API works like this:</p>\\n<ul>\\n<li>We create an endpoint at <code>/api</code> where each we load whatever api is configured in <code>/cfg/server.json</code>, and expose each method. For example <code>/api/save</code> is available for the default <code>flatfiledb</code> api.</li>\\n<li>Next we create a set of API files - one for client, (/system/api.client.js), and one for server (/system/api.server.js) - each have the same methods, but do vastly different things:<ul>\\n<li>api.client.js is a thin wrapper that uses mithril&#39;s m.request to create an ajax request to the server API, it simply passes messages back and forth (in JSON RPC 2.0 format).</li>\\n<li>api.server.js calls the database api methods, which in turn handles models and validation so for example when a request is made and a <code>type</code> and <code>model</code> is included, we can re-construct the data model based on this info, for example you might send: {type: &#39;hello.edit.hello&#39;, model: {who: &#39;Dave&#39;}}, this can then be cast back into a model that we can call the <code>isValid</code> method on.</li>\\n</ul>\\n</li>\\n</ul>\\n<p><strong>Now, the important bit:</strong> The reason for all this functionality is that mithril internally delays rendering to the DOM whilst a request is going on, so we need to handle this within miso - in order to be able to render things on the server - so we have a binding system that delays rendering whilst an async request is still being executed. That means mithril-like code like this:</p>\\n<pre><code class=\\\"lang-javascript\\\">controller: function(){\\n    var ctrl = this;\\n    api.find({type: &#39;hello.index.hello&#39;}).then(function(data) {\\n        var list = Object.keys(data.result).map(function(key) {\\n            var myHello = data.result[key];\\n            return new self.models.hello(myHello);\\n        });\\n        ctrl.model = new ctrl.vm.todoList(list);\\n    });\\n    return ctrl;\\n}\\n</code></pre>\\n<p>Will still work. Note: the magic here is that there is absolutely nothing in the code above that runs a callback to let mithril know the data is ready - this is a design feature of mithril to delay rendering automatically whilst an <code>m.request</code> is in progress, so we cater for this to have the ability to render the page server-side first, so that SEO works out of the box.</p>\\n<h2><a name=\\\"client-vs-server-code\\\" class=\\\"anchor\\\" href=\\\"#client-vs-server-code\\\"><span class=\\\"header-link\\\">Client vs server code</span></a></h2><p>In miso, you include files using the standard nodejs <code>require</code> function. When you need to do something that works differently in the client than the server, there are a few ways you can achieve it:</p>\\n<ul>\\n<li>The recommended way is to create and require a file in the <code>modules/</code> directory, and then create the same file with a &quot;.client&quot; before the extension, and miso will automatically load that file for you on the client side instead. For example if you have <code>/modules/something.js</code>, if you create <code>/modules/something.client.js</code>, miso will automatically use that on the client.</li>\\n<li>Another option is to use <code>miso.util</code> - you can use <code>miso.util.isServer()</code> to test if you&#39;re on the server or not, though it is better practice to use the &quot;.client&quot; method mentioned above - only use <code>isServer</code> if you absolutely have no other option.</li>\\n</ul>\\n<h2><a name=\\\"first-page-load\\\" class=\\\"anchor\\\" href=\\\"#first-page-load\\\"><span class=\\\"header-link\\\">First page load</span></a></h2><p>When a new user enters your site via a URL, and miso loads the first page, a number of things happen:</p>\\n<ul>\\n<li>The server generates the page, including any data the user might have access to. This is mainly for SEO purposes, but also to make the perceptible loading time less, plus provide beautiful urls out of the box. </li>\\n<li>Once the page has loaded, mithril kicks in and creates a XHR (ajax) request to retreive the data, and setup any events and the virtual DOM, etc.</li>\\n</ul>\\n<p>Now you might be thinking: we don&#39;t really need that 2nd request for data - it&#39;s already in the page, right? Well, sort of - you see miso does not make any assumptions about the structure of your data, or how you want to use it in your models, so there is no way for us to re-use that data, as it could be any structure.\\nAnother key feature of miso is the fact that all actions can be bookmarkable - for example the <a href=\\\"/doc/users.md\\\">/users</a> app - click on a user, and see the url change - we didn&#39;t do another server round-trip, but rather just a XHR request that returned the data we required - the UI was completely rendered client side - so it&#39;s really on that first time we load the page that you end up loading the data twice.</p>\\n<p>So that is the reason the architecture works the way it does, and has that seemingly redundant 2nd request for the data - it is a small price to pay for SEO, and perceptibly quick loading pages and as mentioned, it only ever happens on the first page load.</p>\\n<p>Of course you could implement caching of the data yourself, if the 2nd request is an issue - after all you might be loading quite a bit of data. One way to do this would be like so (warning: rather contrived example follows):</p>\\n<pre><code class=\\\"lang-javascript\\\">var m = require(&#39;mithril&#39;),\\n    miso = require(&#39;../modules/miso.util.js&#39;),\\n    sugartags = require(&#39;mithril.sugartags&#39;)(m),\\n    db = require(&#39;../system/api/flatfiledb/api.server.js&#39;)(m);\\n\\nvar edit = module.exports.edit = {\\n    models: {\\n        hello: function(data){\\n            this.who = m.prop(data.who);\\n        }\\n    },\\n    controller: function(params) {\\n        var ctrl = this,\\n            who = miso.getParam(&#39;hello_id&#39;, params);\\n\\n        //    Check if our data is available, if so: use it.\\n        if(typeof myPerson !== &quot;undefined&quot;) {\\n            ctrl.model = new edit.models.hello({who: myPerson});\\n        } else {\\n        //    If not, load it first.\\n            db.find({type: &#39;user.edit.user&#39;}).then(function(data) {\\n                ctrl.model = new edit.models.hello({who: data.result[0].name});\\n            });\\n        }\\n\\n        return ctrl;\\n    },\\n    view: function(ctrl) {\\n        with(sugartags) {\\n            return [\\n                //    Add a client side global variable with our data\\n                SCRIPT(&quot;var myPerson = &#39;&quot; + ctrl.model.who() + &quot;&#39;&quot;),\\n                DIV(&quot;G&#39;day &quot; + ctrl.model.who())\\n            ]\\n        }\\n    }\\n};\\n</code></pre>\\n<p>So this will only load the data on the server side - as you can see, we need to know the shape of the data to use it, and we are using a global variable here to store the data client side - I don&#39;t really recommend this approach, as it seems like a lot of work to save a single XHR request. However I understand you might have unique circumstances where the first data load could be a problem, so at least this is an option you can use to cache the data on first page load.</p>\\n<h2><a name=\\\"requiring-files\\\" class=\\\"anchor\\\" href=\\\"#requiring-files\\\"><span class=\\\"header-link\\\">Requiring files</span></a></h2><p>When requiring files, be sure to do so in a static manner so that browserify is able to compile the client side script. Always use:</p>\\n<pre><code class=\\\"lang-javascript\\\">var miso = require(&#39;../server/miso.util.js&#39;);\\n</code></pre>\\n<p>NEVER DO ANY OF THESE:</p>\\n<pre><code class=\\\"lang-javascript\\\">//  DON&#39;T DO THIS!\\nvar miso = new require(&#39;../server/miso.util.js&#39;);\\n</code></pre>\\n<p>This will create an object, which means <a href=\\\"/doc/824.md\\\">browserify cannot resolve it statically</a>, and will ignore it.</p>\\n<pre><code class=\\\"lang-javascript\\\">//  DON&#39;T DO THIS!\\nvar thing = &#39;miso&#39;;\\nvar miso = require(&#39;../server/&#39;+thing+&#39;.util.js&#39;);\\n</code></pre>\\n<p>This will create an expression, which means <a href=\\\"/doc/824.md\\\">browserify cannot resolve it statically</a>, and will ignore it.</p>\\n\",\"Patterns.md\":\"<p>There are several ways you can write your app and miso is not opinionated about how you go about this so it is important that you choose a pattern that suits your needs. Below are a few suggested patterns to follow when developing apps.</p>\\n<p><strong>Note:</strong> miso is a single page app that loads server rendered HTML from any URL, so that SEO works out of the box.</p>\\n<h2><a name=\\\"single-url-mvc\\\" class=\\\"anchor\\\" href=\\\"#single-url-mvc\\\"><span class=\\\"header-link\\\">Single url mvc</span></a></h2><p>In this pattern everything that your mvc needs to do is done on a single url for all the associated actions. The advantage for this style of development is that you have everything in one mvc container, and you don&#39;t need to map any routes - of course the downside being that there are no routes for the user to bookmark. This is pattern works well for smaller entities where there are not too many interactions that the user can do - this is essentially how most mithril apps are written - self-contained, and at a single url.</p>\\n<p>Here is a &quot;hello world&quot; example using the single url pattern</p>\\n<pre><code class=\\\"lang-javascript\\\">var m = require(&#39;mithril&#39;),\\n    sugartags = require(&#39;../server/mithril.sugartags.node.js&#39;)(m);\\n\\nvar self = module.exports.index = {\\n    models: {\\n        //    Our model\\n        hello: function(data){\\n            this.who = m.p(data.who);\\n        }\\n    },\\n    controller: function(params) {\\n        this.model = new self.models.hello({who: &quot;world&quot;});\\n        return this;\\n    },\\n    view: function(ctrl) {\\n        var model = ctrl.model;\\n        with(sugartags) {\\n            return [\\n                DIV(&quot;Hello &quot; + model.who())\\n            ];\\n        }\\n    }\\n};\\n</code></pre>\\n<p>This would expose a url /hellos (note: the &#39;s&#39;), and would display &quot;Hello world&quot;. (You can change the route using custom routing)</p>\\n<h2><a name=\\\"multi-url-mvc\\\" class=\\\"anchor\\\" href=\\\"#multi-url-mvc\\\"><span class=\\\"header-link\\\">Multi url mvc</span></a></h2><p>In this pattern we expose multiple mvc routes that in turn translate to multiple URLs. This is useful for splitting up your app, and ensuring each mvc has its own sets of concerns.</p>\\n<pre><code class=\\\"lang-javascript\\\">var m = require(&#39;mithril&#39;),\\n    miso = require(&#39;../server/miso.util.js&#39;),\\n    sugartags = require(&#39;../server/mithril.sugartags.node.js&#39;)(m);\\n\\nvar index = module.exports.index = {\\n    models: {\\n        //    Our model\\n        hello: function(data){\\n            this.who = m.p(data.who);\\n        }\\n    },\\n    controller: function(params) {\\n        this.model = new index.models.hello({who: &quot;world&quot;});\\n        return this;\\n    },\\n    view: function(ctrl) {\\n        var model = ctrl.model;\\n        with(sugartags) {\\n            return [\\n                DIV(&quot;Hello &quot; + model.who()),\\n                A({href: &quot;/hello/Leo&quot;, config: m.route}, &quot;Click me for the edit action&quot;)\\n            ];\\n        }\\n    }\\n};\\n\\nvar edit = module.exports.edit = {\\n    controller: function(params) {\\n        var who = miso.getParam(&#39;hello_id&#39;, params);\\n        this.model = new index.models.hello({who: who});\\n        return this;\\n    },\\n    view: function(ctrl) {\\n        var model = ctrl.model;\\n        with(sugartags) {\\n            return [\\n                DIV(&quot;Hello &quot; + model.who())\\n            ];\\n        }\\n    }\\n};\\n</code></pre>\\n<p>Here we also expose a &quot;/hello/[NAME]&quot; url, that will show your name when you visit /hello/[YOUR NAME], so there are now multiple urls for our SPA:</p>\\n<ul>\\n<li><strong>/hellos</strong> - this is intended to be an index page that lists all your &quot;hellos&quot;</li>\\n<li><strong>/hello/[NAME]</strong> - this is intended to be an edit page where you can edit your &quot;hellos&quot;</li>\\n</ul>\\n<p>Note that the anchor tag has <code>config: m.route</code> in it&#39;s options - this is so that we can route automatically though mithril</p>\\n\"}; };","/* NOTE: This is a generated file, please do not modify it, your changes will be lost */\nmodule.exports = function(m){\n\tvar getModelData = function(model){\n\t\tvar i, result = {};\n\t\tfor(i in model) {if(model.hasOwnProperty(i)) {\n\t\t\tif(i !== 'isValid') {\n\t\t\t\tif(i == 'id') {\n\t\t\t\t\tresult['_id'] = (typeof model[i] == 'function')? model[i](): model[i];\n\t\t\t\t} else {\n\t\t\t\t\tresult[i] = (typeof model[i] == 'function')? model[i](): model[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}}\n\t\treturn result;\n\t};\n\treturn {\n'get': function(args, options){\n\targs = args || {};\n\toptions = options || {};\n\tvar requestObj = {\n\t\t\tmethod:'post', \n\t\t\turl: '/api/session/get',\n\t\t\tdata: args\n\t\t},\n\t\trootNode = document.documentElement || document.body;\n\tfor(var i in options) {if(options.hasOwnProperty(i)){\n\t\trequestObj[i] = options[i];\n\t}}\n\tif(args.model) {\n \t\targs.model = getModelData(args.model);\n\t}\n\trootNode.className += ' loading';\n\tvar myDeferred = m.deferred();\n\tm.request(requestObj).then(function(){\n\t\trootNode.className = rootNode.className.split(' loading').join('');\n\t\tmyDeferred.resolve.apply(this, arguments);\n\t\tif(requestObj.background){\n\t\t\tm.redraw(true);\n\t\t}\n\t});\n\treturn myDeferred.promise;\n},\n'set': function(args, options){\n\targs = args || {};\n\toptions = options || {};\n\tvar requestObj = {\n\t\t\tmethod:'post', \n\t\t\turl: '/api/session/set',\n\t\t\tdata: args\n\t\t},\n\t\trootNode = document.documentElement || document.body;\n\tfor(var i in options) {if(options.hasOwnProperty(i)){\n\t\trequestObj[i] = options[i];\n\t}}\n\tif(args.model) {\n \t\targs.model = getModelData(args.model);\n\t}\n\trootNode.className += ' loading';\n\tvar myDeferred = m.deferred();\n\tm.request(requestObj).then(function(){\n\t\trootNode.className = rootNode.className.split(' loading').join('');\n\t\tmyDeferred.resolve.apply(this, arguments);\n\t\tif(requestObj.background){\n\t\t\tm.redraw(true);\n\t\t}\n\t});\n\treturn myDeferred.promise;\n}\n\t};\n};","/* NOTE: This is a generated file, please do not modify it, your changes will be lost */\nmodule.exports = function(m){\n\tvar getModelData = function(model){\n\t\tvar i, result = {};\n\t\tfor(i in model) {if(model.hasOwnProperty(i)) {\n\t\t\tif(i !== 'isValid') {\n\t\t\t\tif(i == 'id') {\n\t\t\t\t\tresult['_id'] = (typeof model[i] == 'function')? model[i](): model[i];\n\t\t\t\t} else {\n\t\t\t\t\tresult[i] = (typeof model[i] == 'function')? model[i](): model[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}}\n\t\treturn result;\n\t};\n\treturn {\n'find': function(args, options){\n\targs = args || {};\n\toptions = options || {};\n\tvar requestObj = {\n\t\t\tmethod:'post', \n\t\t\turl: '/api/flatfiledb/find',\n\t\t\tdata: args\n\t\t},\n\t\trootNode = document.documentElement || document.body;\n\tfor(var i in options) {if(options.hasOwnProperty(i)){\n\t\trequestObj[i] = options[i];\n\t}}\n\tif(args.model) {\n \t\targs.model = getModelData(args.model);\n\t}\n\trootNode.className += ' loading';\n\tvar myDeferred = m.deferred();\n\tm.request(requestObj).then(function(){\n\t\trootNode.className = rootNode.className.split(' loading').join('');\n\t\tmyDeferred.resolve.apply(this, arguments);\n\t\tif(requestObj.background){\n\t\t\tm.redraw(true);\n\t\t}\n\t});\n\treturn myDeferred.promise;\n},\n'save': function(args, options){\n\targs = args || {};\n\toptions = options || {};\n\tvar requestObj = {\n\t\t\tmethod:'post', \n\t\t\turl: '/api/flatfiledb/save',\n\t\t\tdata: args\n\t\t},\n\t\trootNode = document.documentElement || document.body;\n\tfor(var i in options) {if(options.hasOwnProperty(i)){\n\t\trequestObj[i] = options[i];\n\t}}\n\tif(args.model) {\n \t\targs.model = getModelData(args.model);\n\t}\n\trootNode.className += ' loading';\n\tvar myDeferred = m.deferred();\n\tm.request(requestObj).then(function(){\n\t\trootNode.className = rootNode.className.split(' loading').join('');\n\t\tmyDeferred.resolve.apply(this, arguments);\n\t\tif(requestObj.background){\n\t\t\tm.redraw(true);\n\t\t}\n\t});\n\treturn myDeferred.promise;\n},\n'remove': function(args, options){\n\targs = args || {};\n\toptions = options || {};\n\tvar requestObj = {\n\t\t\tmethod:'post', \n\t\t\turl: '/api/flatfiledb/remove',\n\t\t\tdata: args\n\t\t},\n\t\trootNode = document.documentElement || document.body;\n\tfor(var i in options) {if(options.hasOwnProperty(i)){\n\t\trequestObj[i] = options[i];\n\t}}\n\tif(args.model) {\n \t\targs.model = getModelData(args.model);\n\t}\n\trootNode.className += ' loading';\n\tvar myDeferred = m.deferred();\n\tm.request(requestObj).then(function(){\n\t\trootNode.className = rootNode.className.split(' loading').join('');\n\t\tmyDeferred.resolve.apply(this, arguments);\n\t\tif(requestObj.background){\n\t\t\tm.redraw(true);\n\t\t}\n\t});\n\treturn myDeferred.promise;\n},\n'authenticate': function(args, options){\n\targs = args || {};\n\toptions = options || {};\n\tvar requestObj = {\n\t\t\tmethod:'post', \n\t\t\turl: '/api/flatfiledb/authenticate',\n\t\t\tdata: args\n\t\t},\n\t\trootNode = document.documentElement || document.body;\n\tfor(var i in options) {if(options.hasOwnProperty(i)){\n\t\trequestObj[i] = options[i];\n\t}}\n\tif(args.model) {\n \t\targs.model = getModelData(args.model);\n\t}\n\trootNode.className += ' loading';\n\tvar myDeferred = m.deferred();\n\tm.request(requestObj).then(function(){\n\t\trootNode.className = rootNode.className.split(' loading').join('');\n\t\tmyDeferred.resolve.apply(this, arguments);\n\t\tif(requestObj.background){\n\t\t\tm.redraw(true);\n\t\t}\n\t});\n\treturn myDeferred.promise;\n}\n\t};\n};","var m = (function app(window, undefined) {\r\n\tvar OBJECT = \"[object Object]\", ARRAY = \"[object Array]\", STRING = \"[object String]\", FUNCTION = \"function\";\r\n\tvar type = {}.toString;\r\n\tvar parser = /(?:(^|#|\\.)([^#\\.\\[\\]]+))|(\\[.+?\\])/g, attrParser = /\\[(.+?)(?:=(\"|'|)(.*?)\\2)?\\]/;\r\n\tvar voidElements = /^(AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TRACK|WBR)$/;\r\n\r\n\t// caching commonly used variables\r\n\tvar $document, $location, $requestAnimationFrame, $cancelAnimationFrame;\r\n\r\n\t// self invoking function needed because of the way mocks work\r\n\tfunction initialize(window){\r\n\t\t$document = window.document;\r\n\t\t$location = window.location;\r\n\t\t$cancelAnimationFrame = window.cancelAnimationFrame || window.clearTimeout;\r\n\t\t$requestAnimationFrame = window.requestAnimationFrame || window.setTimeout;\r\n\t}\r\n\r\n\tinitialize(window);\r\n\r\n\r\n\t/**\r\n\t * @typedef {String} Tag\r\n\t * A string that looks like -> div.classname#id[param=one][param2=two]\r\n\t * Which describes a DOM node\r\n\t */\r\n\r\n\t/**\r\n\t *\r\n\t * @param {Tag} The DOM node tag\r\n\t * @param {Object=[]} optional key-value pairs to be mapped to DOM attrs\r\n\t * @param {...mNode=[]} Zero or more Mithril child nodes. Can be an array, or splat (optional)\r\n\t *\r\n\t */\r\n\tfunction m() {\r\n\t\tvar args = [].slice.call(arguments);\r\n\t\tvar hasAttrs = args[1] != null && type.call(args[1]) === OBJECT && !(\"tag\" in args[1]) && !(\"subtree\" in args[1]);\r\n\t\tvar attrs = hasAttrs ? args[1] : {};\r\n\t\tvar classAttrName = \"class\" in attrs ? \"class\" : \"className\";\r\n\t\tvar cell = {tag: \"div\", attrs: {}};\r\n\t\tvar match, classes = [];\r\n\t\tif (type.call(args[0]) != STRING) throw new Error(\"selector in m(selector, attrs, children) should be a string\")\r\n\t\twhile (match = parser.exec(args[0])) {\r\n\t\t\tif (match[1] === \"\" && match[2]) cell.tag = match[2];\r\n\t\t\telse if (match[1] === \"#\") cell.attrs.id = match[2];\r\n\t\t\telse if (match[1] === \".\") classes.push(match[2]);\r\n\t\t\telse if (match[3][0] === \"[\") {\r\n\t\t\t\tvar pair = attrParser.exec(match[3]);\r\n\t\t\t\tcell.attrs[pair[1]] = pair[3] || (pair[2] ? \"\" :true)\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (classes.length > 0) cell.attrs[classAttrName] = classes.join(\" \");\r\n\r\n\r\n\t\tvar children = hasAttrs ? args[2] : args[1];\r\n\t\tif (type.call(children) === ARRAY) {\r\n\t\t\tcell.children = children\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcell.children = hasAttrs ? args.slice(2) : args.slice(1)\r\n\t\t}\r\n\r\n\t\tfor (var attrName in attrs) {\r\n\t\t\tif (attrName === classAttrName) {\r\n\t\t\t\tif (attrs[attrName] !== \"\") cell.attrs[attrName] = (cell.attrs[attrName] || \"\") + \" \" + attrs[attrName];\r\n\t\t\t}\r\n\t\t\telse cell.attrs[attrName] = attrs[attrName]\r\n\t\t}\r\n\t\treturn cell\r\n\t}\r\n\tfunction build(parentElement, parentTag, parentCache, parentIndex, data, cached, shouldReattach, index, editable, namespace, configs) {\r\n\t\t//`build` is a recursive function that manages creation/diffing/removal of DOM elements based on comparison between `data` and `cached`\r\n\t\t//the diff algorithm can be summarized as this:\r\n\t\t//1 - compare `data` and `cached`\r\n\t\t//2 - if they are different, copy `data` to `cached` and update the DOM based on what the difference is\r\n\t\t//3 - recursively apply this algorithm for every array and for the children of every virtual element\r\n\r\n\t\t//the `cached` data structure is essentially the same as the previous redraw's `data` data structure, with a few additions:\r\n\t\t//- `cached` always has a property called `nodes`, which is a list of DOM elements that correspond to the data represented by the respective virtual element\r\n\t\t//- in order to support attaching `nodes` as a property of `cached`, `cached` is *always* a non-primitive object, i.e. if the data was a string, then cached is a String instance. If data was `null` or `undefined`, cached is `new String(\"\")`\r\n\t\t//- `cached also has a `configContext` property, which is the state storage object exposed by config(element, isInitialized, context)\r\n\t\t//- when `cached` is an Object, it represents a virtual element; when it's an Array, it represents a list of elements; when it's a String, Number or Boolean, it represents a text node\r\n\r\n\t\t//`parentElement` is a DOM element used for W3C DOM API calls\r\n\t\t//`parentTag` is only used for handling a corner case for textarea values\r\n\t\t//`parentCache` is used to remove nodes in some multi-node cases\r\n\t\t//`parentIndex` and `index` are used to figure out the offset of nodes. They're artifacts from before arrays started being flattened and are likely refactorable\r\n\t\t//`data` and `cached` are, respectively, the new and old nodes being diffed\r\n\t\t//`shouldReattach` is a flag indicating whether a parent node was recreated (if so, and if this node is reused, then this node must reattach itself to the new parent)\r\n\t\t//`editable` is a flag that indicates whether an ancestor is contenteditable\r\n\t\t//`namespace` indicates the closest HTML namespace as it cascades down from an ancestor\r\n\t\t//`configs` is a list of config functions to run after the topmost `build` call finishes running\r\n\r\n\t\t//there's logic that relies on the assumption that null and undefined data are equivalent to empty strings\r\n\t\t//- this prevents lifecycle surprises from procedural helpers that mix implicit and explicit return statements (e.g. function foo() {if (cond) return m(\"div\")}\r\n\t\t//- it simplifies diffing code\r\n\t\t//data.toString() is null if data is the return value of Console.log in Firefox\r\n\t\tif (data == null || data.toString() == null) data = \"\";\r\n\t\tif (data.subtree === \"retain\") return cached;\r\n\t\tvar cachedType = type.call(cached), dataType = type.call(data);\r\n\t\tif (cached == null || cachedType !== dataType) {\r\n\t\t\tif (cached != null) {\r\n\t\t\t\tif (parentCache && parentCache.nodes) {\r\n\t\t\t\t\tvar offset = index - parentIndex;\r\n\t\t\t\t\tvar end = offset + (dataType === ARRAY ? data : cached.nodes).length;\r\n\t\t\t\t\tclear(parentCache.nodes.slice(offset, end), parentCache.slice(offset, end))\r\n\t\t\t\t}\r\n\t\t\t\telse if (cached.nodes) clear(cached.nodes, cached)\r\n\t\t\t}\r\n\t\t\tcached = new data.constructor;\r\n\t\t\tif (cached.tag) cached = {}; //if constructor creates a virtual dom element, use a blank object as the base cached node instead of copying the virtual el (#277)\r\n\t\t\tcached.nodes = []\r\n\t\t}\r\n\r\n\t\tif (dataType === ARRAY) {\r\n\t\t\t//recursively flatten array\r\n\t\t\tfor (var i = 0, len = data.length; i < len; i++) {\r\n\t\t\t\tif (type.call(data[i]) === ARRAY) {\r\n\t\t\t\t\tdata = data.concat.apply([], data);\r\n\t\t\t\t\ti-- //check current index again and flatten until there are no more nested arrays at that index\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar nodes = [], intact = cached.length === data.length, subArrayCount = 0;\r\n\r\n\t\t\t//keys algorithm: sort elements without recreating them if keys are present\r\n\t\t\t//1) create a map of all existing keys, and mark all for deletion\r\n\t\t\t//2) add new keys to map and mark them for addition\r\n\t\t\t//3) if key exists in new list, change action from deletion to a move\r\n\t\t\t//4) for each key, handle its corresponding action as marked in previous steps\r\n\t\t\t//5) copy unkeyed items into their respective gaps\r\n\t\t\tvar DELETION = 1, INSERTION = 2 , MOVE = 3;\r\n\t\t\tvar existing = {}, unkeyed = [], shouldMaintainIdentities = false;\r\n\t\t\tfor (var i = 0; i < cached.length; i++) {\r\n\t\t\t\tif (cached[i] && cached[i].attrs && cached[i].attrs.key != null) {\r\n\t\t\t\t\tshouldMaintainIdentities = true;\r\n\t\t\t\t\texisting[cached[i].attrs.key] = {action: DELETION, index: i}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (shouldMaintainIdentities) {\r\n\t\t\t\tif (data.indexOf(null) > -1) data = data.filter(function(x) {return x != null})\r\n\t\t\t\t\r\n\t\t\t\tvar keysDiffer = false\r\n\t\t\t\tif (data.length != cached.length) keysDiffer = true\r\n\t\t\t\telse for (var i = 0, cachedCell, dataCell; cachedCell = cached[i], dataCell = data[i]; i++) {\r\n\t\t\t\t\tif (cachedCell.attrs && dataCell.attrs && cachedCell.attrs.key != dataCell.attrs.key) {\r\n\t\t\t\t\t\tkeysDiffer = true\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (keysDiffer) {\r\n\t\t\t\t\tfor (var i = 0, len = data.length; i < len; i++) {\r\n\t\t\t\t\t\tif (data[i] && data[i].attrs) {\r\n\t\t\t\t\t\t\tif (data[i].attrs.key != null) {\r\n\t\t\t\t\t\t\t\tvar key = data[i].attrs.key;\r\n\t\t\t\t\t\t\t\tif (!existing[key]) existing[key] = {action: INSERTION, index: i};\r\n\t\t\t\t\t\t\t\telse existing[key] = {\r\n\t\t\t\t\t\t\t\t\taction: MOVE,\r\n\t\t\t\t\t\t\t\t\tindex: i,\r\n\t\t\t\t\t\t\t\t\tfrom: existing[key].index,\r\n\t\t\t\t\t\t\t\t\telement: cached.nodes[existing[key].index] || $document.createElement(\"div\")\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse unkeyed.push({index: i, element: parentElement.childNodes[i] || $document.createElement(\"div\")})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar actions = []\r\n\t\t\t\t\tfor (var prop in existing) actions.push(existing[prop])\r\n\t\t\t\t\tvar changes = actions.sort(sortChanges);\r\n\t\t\t\t\tvar newCached = new Array(cached.length)\r\n\r\n\t\t\t\t\tfor (var i = 0, change; change = changes[i]; i++) {\r\n\t\t\t\t\t\tif (change.action === DELETION) {\r\n\t\t\t\t\t\t\tclear(cached[change.index].nodes, cached[change.index]);\r\n\t\t\t\t\t\t\tnewCached.splice(change.index, 1)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (change.action === INSERTION) {\r\n\t\t\t\t\t\t\tvar dummy = $document.createElement(\"div\");\r\n\t\t\t\t\t\t\tdummy.key = data[change.index].attrs.key;\r\n\t\t\t\t\t\t\tparentElement.insertBefore(dummy, parentElement.childNodes[change.index] || null);\r\n\t\t\t\t\t\t\tnewCached.splice(change.index, 0, {attrs: {key: data[change.index].attrs.key}, nodes: [dummy]})\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (change.action === MOVE) {\r\n\t\t\t\t\t\t\tif (parentElement.childNodes[change.index] !== change.element && change.element !== null) {\r\n\t\t\t\t\t\t\t\tparentElement.insertBefore(change.element, parentElement.childNodes[change.index] || null)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tnewCached[change.index] = cached[change.from]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (var i = 0, len = unkeyed.length; i < len; i++) {\r\n\t\t\t\t\t\tvar change = unkeyed[i];\r\n\t\t\t\t\t\tparentElement.insertBefore(change.element, parentElement.childNodes[change.index] || null);\r\n\t\t\t\t\t\tnewCached[change.index] = cached[change.index]\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcached = newCached;\r\n\t\t\t\t\tcached.nodes = new Array(parentElement.childNodes.length);\r\n\t\t\t\t\tfor (var i = 0, child; child = parentElement.childNodes[i]; i++) cached.nodes[i] = child\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//end key algorithm\r\n\r\n\t\t\tfor (var i = 0, cacheCount = 0, len = data.length; i < len; i++) {\r\n\t\t\t\t//diff each item in the array\r\n\t\t\t\tvar item = build(parentElement, parentTag, cached, index, data[i], cached[cacheCount], shouldReattach, index + subArrayCount || subArrayCount, editable, namespace, configs);\r\n\t\t\t\tif (item === undefined) continue;\r\n\t\t\t\tif (!item.nodes.intact) intact = false;\r\n\t\t\t\tif (item.$trusted) {\r\n\t\t\t\t\t//fix offset of next element if item was a trusted string w/ more than one html element\r\n\t\t\t\t\t//the first clause in the regexp matches elements\r\n\t\t\t\t\t//the second clause (after the pipe) matches text nodes\r\n\t\t\t\t\tsubArrayCount += (item.match(/<[^\\/]|\\>\\s*[^<]/g) || []).length\r\n\t\t\t\t}\r\n\t\t\t\telse subArrayCount += type.call(item) === ARRAY ? item.length : 1;\r\n\t\t\t\tcached[cacheCount++] = item\r\n\t\t\t}\r\n\t\t\tif (!intact) {\r\n\t\t\t\t//diff the array itself\r\n\t\t\t\t\r\n\t\t\t\t//update the list of DOM nodes by collecting the nodes from each item\r\n\t\t\t\tfor (var i = 0, len = data.length; i < len; i++) {\r\n\t\t\t\t\tif (cached[i] != null) nodes.push.apply(nodes, cached[i].nodes)\r\n\t\t\t\t}\r\n\t\t\t\t//remove items from the end of the array if the new array is shorter than the old one\r\n\t\t\t\t//if errors ever happen here, the issue is most likely a bug in the construction of the `cached` data structure somewhere earlier in the program\r\n\t\t\t\tfor (var i = 0, node; node = cached.nodes[i]; i++) {\r\n\t\t\t\t\tif (node.parentNode != null && nodes.indexOf(node) < 0) clear([node], [cached[i]])\r\n\t\t\t\t}\r\n\t\t\t\tif (data.length < cached.length) cached.length = data.length;\r\n\t\t\t\tcached.nodes = nodes\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (data != null && dataType === OBJECT) {\r\n\t\t\tif (!data.attrs) data.attrs = {};\r\n\t\t\tif (!cached.attrs) cached.attrs = {};\r\n\r\n\t\t\tvar dataAttrKeys = Object.keys(data.attrs)\r\n\t\t\tvar hasKeys = dataAttrKeys.length > (\"key\" in data.attrs ? 1 : 0)\r\n\t\t\t//if an element is different enough from the one in cache, recreate it\r\n\t\t\tif (data.tag != cached.tag || dataAttrKeys.join() != Object.keys(cached.attrs).join() || data.attrs.id != cached.attrs.id) {\r\n\t\t\t\tif (cached.nodes.length) clear(cached.nodes);\r\n\t\t\t\tif (cached.configContext && typeof cached.configContext.onunload === FUNCTION) cached.configContext.onunload()\r\n\t\t\t}\r\n\t\t\tif (type.call(data.tag) != STRING) return;\r\n\r\n\t\t\tvar node, isNew = cached.nodes.length === 0;\r\n\t\t\tif (data.attrs.xmlns) namespace = data.attrs.xmlns;\r\n\t\t\telse if (data.tag === \"svg\") namespace = \"http://www.w3.org/2000/svg\";\r\n\t\t\telse if (data.tag === \"math\") namespace = \"http://www.w3.org/1998/Math/MathML\";\r\n\t\t\tif (isNew) {\r\n\t\t\t\tif (data.attrs.is) node = namespace === undefined ? $document.createElement(data.tag, data.attrs.is) : $document.createElementNS(namespace, data.tag, data.attrs.is);\r\n\t\t\t\telse node = namespace === undefined ? $document.createElement(data.tag) : $document.createElementNS(namespace, data.tag);\r\n\t\t\t\tcached = {\r\n\t\t\t\t\ttag: data.tag,\r\n\t\t\t\t\t//set attributes first, then create children\r\n\t\t\t\t\tattrs: hasKeys ? setAttributes(node, data.tag, data.attrs, {}, namespace) : data.attrs,\r\n\t\t\t\t\tchildren: data.children != null && data.children.length > 0 ?\r\n\t\t\t\t\t\tbuild(node, data.tag, undefined, undefined, data.children, cached.children, true, 0, data.attrs.contenteditable ? node : editable, namespace, configs) :\r\n\t\t\t\t\t\tdata.children,\r\n\t\t\t\t\tnodes: [node]\r\n\t\t\t\t};\r\n\t\t\t\tif (cached.children && !cached.children.nodes) cached.children.nodes = [];\r\n\t\t\t\t//edge case: setting value on <select> doesn't work before children exist, so set it again after children have been created\r\n\t\t\t\tif (data.tag === \"select\" && data.attrs.value) setAttributes(node, data.tag, {value: data.attrs.value}, {}, namespace);\r\n\t\t\t\tparentElement.insertBefore(node, parentElement.childNodes[index] || null)\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnode = cached.nodes[0];\r\n\t\t\t\tif (hasKeys) setAttributes(node, data.tag, data.attrs, cached.attrs, namespace);\r\n\t\t\t\tcached.children = build(node, data.tag, undefined, undefined, data.children, cached.children, false, 0, data.attrs.contenteditable ? node : editable, namespace, configs);\r\n\t\t\t\tcached.nodes.intact = true;\r\n\t\t\t\tif (shouldReattach === true && node != null) parentElement.insertBefore(node, parentElement.childNodes[index] || null)\r\n\t\t\t}\r\n\t\t\t//schedule configs to be called. They are called after `build` finishes running\r\n\t\t\tif (typeof data.attrs[\"config\"] === FUNCTION) {\r\n\t\t\t\tvar context = cached.configContext = cached.configContext || {};\r\n\r\n\t\t\t\t// bind\r\n\t\t\t\tvar callback = function(data, args) {\r\n\t\t\t\t\treturn function() {\r\n\t\t\t\t\t\treturn data.attrs[\"config\"].apply(data, args)\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tconfigs.push(callback(data, [node, !isNew, context, cached]))\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (typeof dataType != FUNCTION) {\r\n\t\t\t//handle text nodes\r\n\t\t\tvar nodes;\r\n\t\t\tif (cached.nodes.length === 0) {\r\n\t\t\t\tif (data.$trusted) {\r\n\t\t\t\t\tnodes = injectHTML(parentElement, index, data)\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tnodes = [$document.createTextNode(data)];\r\n\t\t\t\t\tif (!parentElement.nodeName.match(voidElements)) parentElement.insertBefore(nodes[0], parentElement.childNodes[index] || null)\r\n\t\t\t\t}\r\n\t\t\t\tcached = \"string number boolean\".indexOf(typeof data) > -1 ? new data.constructor(data) : data;\r\n\t\t\t\tcached.nodes = nodes\r\n\t\t\t}\r\n\t\t\telse if (cached.valueOf() !== data.valueOf() || shouldReattach === true) {\r\n\t\t\t\tnodes = cached.nodes;\r\n\t\t\t\tif (!editable || editable !== $document.activeElement) {\r\n\t\t\t\t\tif (data.$trusted) {\r\n\t\t\t\t\t\tclear(nodes, cached);\r\n\t\t\t\t\t\tnodes = injectHTML(parentElement, index, data)\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t//corner case: replacing the nodeValue of a text node that is a child of a textarea/contenteditable doesn't work\r\n\t\t\t\t\t\t//we need to update the value property of the parent textarea or the innerHTML of the contenteditable element instead\r\n\t\t\t\t\t\tif (parentTag === \"textarea\") parentElement.value = data;\r\n\t\t\t\t\t\telse if (editable) editable.innerHTML = data;\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tif (nodes[0].nodeType === 1 || nodes.length > 1) { //was a trusted string\r\n\t\t\t\t\t\t\t\tclear(cached.nodes, cached);\r\n\t\t\t\t\t\t\t\tnodes = [$document.createTextNode(data)]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tparentElement.insertBefore(nodes[0], parentElement.childNodes[index] || null);\r\n\t\t\t\t\t\t\tnodes[0].nodeValue = data\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcached = new data.constructor(data);\r\n\t\t\t\tcached.nodes = nodes\r\n\t\t\t}\r\n\t\t\telse cached.nodes.intact = true\r\n\t\t}\r\n\r\n\t\treturn cached\r\n\t}\r\n\tfunction sortChanges(a, b) {return a.action - b.action || a.index - b.index}\r\n\tfunction setAttributes(node, tag, dataAttrs, cachedAttrs, namespace) {\r\n\t\tfor (var attrName in dataAttrs) {\r\n\t\t\tvar dataAttr = dataAttrs[attrName];\r\n\t\t\tvar cachedAttr = cachedAttrs[attrName];\r\n\t\t\tif (!(attrName in cachedAttrs) || (cachedAttr !== dataAttr)) {\r\n\t\t\t\tcachedAttrs[attrName] = dataAttr;\r\n\t\t\t\ttry {\r\n\t\t\t\t\t//`config` isn't a real attributes, so ignore it\r\n\t\t\t\t\tif (attrName === \"config\" || attrName == \"key\") continue;\r\n\t\t\t\t\t//hook event handlers to the auto-redrawing system\r\n\t\t\t\t\telse if (typeof dataAttr === FUNCTION && attrName.indexOf(\"on\") === 0) {\r\n\t\t\t\t\t\tnode[attrName] = autoredraw(dataAttr, node)\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//handle `style: {...}`\r\n\t\t\t\t\telse if (attrName === \"style\" && dataAttr != null && type.call(dataAttr) === OBJECT) {\r\n\t\t\t\t\t\tfor (var rule in dataAttr) {\r\n\t\t\t\t\t\t\tif (cachedAttr == null || cachedAttr[rule] !== dataAttr[rule]) node.style[rule] = dataAttr[rule]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (var rule in cachedAttr) {\r\n\t\t\t\t\t\t\tif (!(rule in dataAttr)) node.style[rule] = \"\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//handle SVG\r\n\t\t\t\t\telse if (namespace != null) {\r\n\t\t\t\t\t\tif (attrName === \"href\") node.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\", dataAttr);\r\n\t\t\t\t\t\telse if (attrName === \"className\") node.setAttribute(\"class\", dataAttr);\r\n\t\t\t\t\t\telse node.setAttribute(attrName, dataAttr)\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//handle cases that are properties (but ignore cases where we should use setAttribute instead)\r\n\t\t\t\t\t//- list and form are typically used as strings, but are DOM element references in js\r\n\t\t\t\t\t//- when using CSS selectors (e.g. `m(\"[style='']\")`), style is used as a string, but it's an object in js\r\n\t\t\t\t\telse if (attrName in node && !(attrName === \"list\" || attrName === \"style\" || attrName === \"form\" || attrName === \"type\")) {\r\n\t\t\t\t\t\t//#348 don't set the value if not needed otherwise cursor placement breaks in Chrome\r\n\t\t\t\t\t\tif (tag !== \"input\" || node[attrName] !== dataAttr) node[attrName] = dataAttr\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse node.setAttribute(attrName, dataAttr)\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\t//swallow IE's invalid argument errors to mimic HTML's fallback-to-doing-nothing-on-invalid-attributes behavior\r\n\t\t\t\t\tif (e.message.indexOf(\"Invalid argument\") < 0) throw e\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//#348 dataAttr may not be a string, so use loose comparison (double equal) instead of strict (triple equal)\r\n\t\t\telse if (attrName === \"value\" && tag === \"input\" && node.value != dataAttr) {\r\n\t\t\t\tnode.value = dataAttr\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn cachedAttrs\r\n\t}\r\n\tfunction clear(nodes, cached) {\r\n\t\tfor (var i = nodes.length - 1; i > -1; i--) {\r\n\t\t\tif (nodes[i] && nodes[i].parentNode) {\r\n\t\t\t\ttry {nodes[i].parentNode.removeChild(nodes[i])}\r\n\t\t\t\tcatch (e) {} //ignore if this fails due to order of events (see http://stackoverflow.com/questions/21926083/failed-to-execute-removechild-on-node)\r\n\t\t\t\tcached = [].concat(cached);\r\n\t\t\t\tif (cached[i]) unload(cached[i])\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (nodes.length != 0) nodes.length = 0\r\n\t}\r\n\tfunction unload(cached) {\r\n\t\tif (cached.configContext && typeof cached.configContext.onunload === FUNCTION) cached.configContext.onunload();\r\n\t\tif (cached.children) {\r\n\t\t\tif (type.call(cached.children) === ARRAY) {\r\n\t\t\t\tfor (var i = 0, child; child = cached.children[i]; i++) unload(child)\r\n\t\t\t}\r\n\t\t\telse if (cached.children.tag) unload(cached.children)\r\n\t\t}\r\n\t}\r\n\tfunction injectHTML(parentElement, index, data) {\r\n\t\tvar nextSibling = parentElement.childNodes[index];\r\n\t\tif (nextSibling) {\r\n\t\t\tvar isElement = nextSibling.nodeType != 1;\r\n\t\t\tvar placeholder = $document.createElement(\"span\");\r\n\t\t\tif (isElement) {\r\n\t\t\t\tparentElement.insertBefore(placeholder, nextSibling || null);\r\n\t\t\t\tplaceholder.insertAdjacentHTML(\"beforebegin\", data);\r\n\t\t\t\tparentElement.removeChild(placeholder)\r\n\t\t\t}\r\n\t\t\telse nextSibling.insertAdjacentHTML(\"beforebegin\", data)\r\n\t\t}\r\n\t\telse parentElement.insertAdjacentHTML(\"beforeend\", data);\r\n\t\tvar nodes = [];\r\n\t\twhile (parentElement.childNodes[index] !== nextSibling) {\r\n\t\t\tnodes.push(parentElement.childNodes[index]);\r\n\t\t\tindex++\r\n\t\t}\r\n\t\treturn nodes\r\n\t}\r\n\tfunction autoredraw(callback, object) {\r\n\t\treturn function(e) {\r\n\t\t\te = e || event;\r\n\t\t\tm.redraw.strategy(\"diff\");\r\n\t\t\tm.startComputation();\r\n\t\t\ttry {return callback.call(object, e)}\r\n\t\t\tfinally {\r\n\t\t\t\tendFirstComputation()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar html;\r\n\tvar documentNode = {\r\n\t\tappendChild: function(node) {\r\n\t\t\tif (html === undefined) html = $document.createElement(\"html\");\r\n\t\t\tif ($document.documentElement && $document.documentElement !== node) {\r\n\t\t\t\t$document.replaceChild(node, $document.documentElement)\r\n\t\t\t}\r\n\t\t\telse $document.appendChild(node);\r\n\t\t\tthis.childNodes = $document.childNodes\r\n\t\t},\r\n\t\tinsertBefore: function(node) {\r\n\t\t\tthis.appendChild(node)\r\n\t\t},\r\n\t\tchildNodes: []\r\n\t};\r\n\tvar nodeCache = [], cellCache = {};\r\n\tm.render = function(root, cell, forceRecreation) {\r\n\t\tvar configs = [];\r\n\t\tif (!root) throw new Error(\"Please ensure the DOM element exists before rendering a template into it.\");\r\n\t\tvar id = getCellCacheKey(root);\r\n\t\tvar isDocumentRoot = root === $document;\r\n\t\tvar node = isDocumentRoot || root === $document.documentElement ? documentNode : root;\r\n\t\tif (isDocumentRoot && cell.tag != \"html\") cell = {tag: \"html\", attrs: {}, children: cell};\r\n\t\tif (cellCache[id] === undefined) clear(node.childNodes);\r\n\t\tif (forceRecreation === true) reset(root);\r\n\t\tcellCache[id] = build(node, null, undefined, undefined, cell, cellCache[id], false, 0, null, undefined, configs);\r\n\t\tfor (var i = 0, len = configs.length; i < len; i++) configs[i]()\r\n\t};\r\n\tfunction getCellCacheKey(element) {\r\n\t\tvar index = nodeCache.indexOf(element);\r\n\t\treturn index < 0 ? nodeCache.push(element) - 1 : index\r\n\t}\r\n\r\n\tm.trust = function(value) {\r\n\t\tvalue = new String(value);\r\n\t\tvalue.$trusted = true;\r\n\t\treturn value\r\n\t};\r\n\r\n\tfunction gettersetter(store) {\r\n\t\tvar prop = function() {\r\n\t\t\tif (arguments.length) store = arguments[0];\r\n\t\t\treturn store\r\n\t\t};\r\n\r\n\t\tprop.toJSON = function() {\r\n\t\t\treturn store\r\n\t\t};\r\n\r\n\t\treturn prop\r\n\t}\r\n\r\n\tm.prop = function (store) {\r\n\t\t//note: using non-strict equality check here because we're checking if store is null OR undefined\r\n\t\tif (((store != null && type.call(store) === OBJECT) || typeof store === FUNCTION) && typeof store.then === FUNCTION) {\r\n\t\t\treturn propify(store)\r\n\t\t}\r\n\r\n\t\treturn gettersetter(store)\r\n\t};\r\n\r\n\tvar roots = [], modules = [], controllers = [], lastRedrawId = null, lastRedrawCallTime = 0, computePostRedrawHook = null, prevented = false, topModule;\r\n\tvar FRAME_BUDGET = 16; //60 frames per second = 1 call per 16 ms\r\n\tm.module = function(root, module) {\r\n\t\tif (!root) throw new Error(\"Please ensure the DOM element exists before rendering a template into it.\");\r\n\t\tvar index = roots.indexOf(root);\r\n\t\tif (index < 0) index = roots.length;\r\n\t\tvar isPrevented = false;\r\n\t\tif (controllers[index] && typeof controllers[index].onunload === FUNCTION) {\r\n\t\t\tvar event = {\r\n\t\t\t\tpreventDefault: function() {isPrevented = true}\r\n\t\t\t};\r\n\t\t\tcontrollers[index].onunload(event)\r\n\t\t}\r\n\t\tif (!isPrevented) {\r\n\t\t\tm.redraw.strategy(\"all\");\r\n\t\t\tm.startComputation();\r\n\t\t\troots[index] = root;\r\n\t\t\tvar currentModule = topModule = module = module || {};\r\n\t\t\tvar controller = new (module.controller || function() {});\r\n\t\t\t//controllers may call m.module recursively (via m.route redirects, for example)\r\n\t\t\t//this conditional ensures only the last recursive m.module call is applied\r\n\t\t\tif (currentModule === topModule) {\r\n\t\t\t\tcontrollers[index] = controller;\r\n\t\t\t\tmodules[index] = module\r\n\t\t\t}\r\n\t\t\tendFirstComputation();\r\n\t\t\treturn controllers[index]\r\n\t\t}\r\n\t};\r\n\tm.redraw = function(force) {\r\n\t\t//lastRedrawId is a positive number if a second redraw is requested before the next animation frame\r\n\t\t//lastRedrawID is null if it's the first redraw and not an event handler\r\n\t\tif (lastRedrawId && force !== true) {\r\n\t\t\t//when setTimeout: only reschedule redraw if time between now and previous redraw is bigger than a frame, otherwise keep currently scheduled timeout\r\n\t\t\t//when rAF: always reschedule redraw\r\n\t\t\tif (new Date - lastRedrawCallTime > FRAME_BUDGET || $requestAnimationFrame === window.requestAnimationFrame) {\r\n\t\t\t\tif (lastRedrawId > 0) $cancelAnimationFrame(lastRedrawId);\r\n\t\t\t\tlastRedrawId = $requestAnimationFrame(redraw, FRAME_BUDGET)\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tredraw();\r\n\t\t\tlastRedrawId = $requestAnimationFrame(function() {lastRedrawId = null}, FRAME_BUDGET)\r\n\t\t}\r\n\t};\r\n\tm.redraw.strategy = m.prop();\r\n\tvar blank = function() {return \"\"}\r\n\tfunction redraw() {\r\n\t\tvar forceRedraw = m.redraw.strategy() === \"all\";\r\n\t\tfor (var i = 0, root; root = roots[i]; i++) {\r\n\t\t\tif (controllers[i]) {\r\n\t\t\t\tm.render(root, modules[i].view ? modules[i].view(controllers[i]) : blank(), forceRedraw)\r\n\t\t\t}\r\n\t\t}\r\n\t\t//after rendering within a routed context, we need to scroll back to the top, and fetch the document title for history.pushState\r\n\t\tif (computePostRedrawHook) {\r\n\t\t\tcomputePostRedrawHook();\r\n\t\t\tcomputePostRedrawHook = null\r\n\t\t}\r\n\t\tlastRedrawId = null;\r\n\t\tlastRedrawCallTime = new Date;\r\n\t\tm.redraw.strategy(\"diff\")\r\n\t}\r\n\r\n\tvar pendingRequests = 0;\r\n\tm.startComputation = function() {pendingRequests++};\r\n\tm.endComputation = function() {\r\n\t\tpendingRequests = Math.max(pendingRequests - 1, 0);\r\n\t\tif (pendingRequests === 0) m.redraw()\r\n\t};\r\n\tvar endFirstComputation = function() {\r\n\t\tif (m.redraw.strategy() == \"none\") {\r\n\t\t\tpendingRequests--\r\n\t\t\tm.redraw.strategy(\"diff\")\r\n\t\t}\r\n\t\telse m.endComputation();\r\n\t}\r\n\r\n\tm.withAttr = function(prop, withAttrCallback) {\r\n\t\treturn function(e) {\r\n\t\t\te = e || event;\r\n\t\t\tvar currentTarget = e.currentTarget || this;\r\n\t\t\twithAttrCallback(prop in currentTarget ? currentTarget[prop] : currentTarget.getAttribute(prop))\r\n\t\t}\r\n\t};\r\n\r\n\t//routing\r\n\tvar modes = {pathname: \"\", hash: \"#\", search: \"?\"};\r\n\tvar redirect = function() {}, routeParams, currentRoute;\r\n\tm.route = function() {\r\n\t\t//m.route()\r\n\t\tif (arguments.length === 0) return currentRoute;\r\n\t\t//m.route(el, defaultRoute, routes)\r\n\t\telse if (arguments.length === 3 && type.call(arguments[1]) === STRING) {\r\n\t\t\tvar root = arguments[0], defaultRoute = arguments[1], router = arguments[2];\r\n\t\t\tredirect = function(source) {\r\n\t\t\t\tvar path = currentRoute = normalizeRoute(source);\r\n\t\t\t\tif (!routeByValue(root, router, path)) {\r\n\t\t\t\t\tm.route(defaultRoute, true)\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tvar listener = m.route.mode === \"hash\" ? \"onhashchange\" : \"onpopstate\";\r\n\t\t\twindow[listener] = function() {\r\n\t\t\t\tvar path = $location[m.route.mode]\r\n\t\t\t\tif (m.route.mode === \"pathname\") path += $location.search\r\n\t\t\t\tif (currentRoute != normalizeRoute(path)) {\r\n\t\t\t\t\tredirect(path)\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tcomputePostRedrawHook = setScroll;\r\n\t\t\twindow[listener]()\r\n\t\t}\r\n\t\t//config: m.route\r\n\t\telse if (arguments[0].addEventListener) {\r\n\t\t\tvar element = arguments[0];\r\n\t\t\tvar isInitialized = arguments[1];\r\n\t\t\tvar context = arguments[2];\r\n\t\t\telement.href = (m.route.mode !== 'pathname' ? $location.pathname : '') + modes[m.route.mode] + this.attrs.href;\r\n\t\t\telement.removeEventListener(\"click\", routeUnobtrusive);\r\n\t\t\telement.addEventListener(\"click\", routeUnobtrusive)\r\n\t\t}\r\n\t\t//m.route(route, params)\r\n\t\telse if (type.call(arguments[0]) === STRING) {\r\n\t\t\tvar oldRoute = currentRoute;\r\n\t\t\tcurrentRoute = arguments[0];\r\n\t\t\tvar args = arguments[1] || {}\r\n\t\t\tvar queryIndex = currentRoute.indexOf(\"?\")\r\n\t\t\tvar params = queryIndex > -1 ? parseQueryString(currentRoute.slice(queryIndex + 1)) : {}\r\n\t\t\tfor (var i in args) params[i] = args[i]\r\n\t\t\tvar querystring = buildQueryString(params)\r\n\t\t\tvar currentPath = queryIndex > -1 ? currentRoute.slice(0, queryIndex) : currentRoute\r\n\t\t\tif (querystring) currentRoute = currentPath + (currentPath.indexOf(\"?\") === -1 ? \"?\" : \"&\") + querystring;\r\n\r\n\t\t\tvar shouldReplaceHistoryEntry = (arguments.length === 3 ? arguments[2] : arguments[1]) === true || oldRoute === arguments[0];\r\n\r\n\t\t\tif (window.history.pushState) {\r\n\t\t\t\tcomputePostRedrawHook = function() {\r\n\t\t\t\t\twindow.history[shouldReplaceHistoryEntry ? \"replaceState\" : \"pushState\"](null, $document.title, modes[m.route.mode] + currentRoute);\r\n\t\t\t\t\tsetScroll()\r\n\t\t\t\t};\r\n\t\t\t\tvar myRedir = modes[m.route.mode] + currentRoute;\r\n\t\t\t\tredirect(myRedir)\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t$location[m.route.mode] = currentRoute;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tm.route.param = function(key) {\r\n\t\tif (!routeParams) throw new Error(\"You must call m.route(element, defaultRoute, routes) before calling m.route.param()\")\r\n\t\treturn routeParams[key]\r\n\t};\r\n\tm.route.mode = \"search\";\r\n\tfunction normalizeRoute(route) {\r\n\t\treturn route.slice(modes[m.route.mode].length)\r\n\t}\r\n\tfunction routeByValue(root, router, path) {\r\n\t\trouteParams = {};\r\n\r\n\t\tvar queryStart = path.indexOf(\"?\");\r\n\t\tif (queryStart !== -1) {\r\n\t\t\trouteParams = parseQueryString(path.substr(queryStart + 1, path.length));\r\n\t\t\tpath = path.substr(0, queryStart)\r\n\t\t}\r\n\r\n\t\tfor (var route in router) {\r\n\t\t\tif (route === path) {\r\n\t\t\t\tm.module(root, router[route]);\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\r\n\t\t\tvar matcher = new RegExp(\"^\" + route.replace(/:[^\\/]+?\\.{3}/g, \"(.*?)\").replace(/:[^\\/]+/g, \"([^\\\\/]+)\") + \"\\/?$\");\r\n\r\n\t\t\tif (matcher.test(path)) {\r\n\t\t\t\tpath.replace(matcher, function() {\r\n\t\t\t\t\tvar keys = route.match(/:[^\\/]+/g) || [];\r\n\t\t\t\t\tvar values = [].slice.call(arguments, 1, -2);\r\n\t\t\t\t\tfor (var i = 0, len = keys.length; i < len; i++) routeParams[keys[i].replace(/:|\\./g, \"\")] = decodeURIComponent(values[i])\r\n\t\t\t\t\tm.module(root, router[route])\r\n\t\t\t\t});\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tfunction routeUnobtrusive(e) {\r\n\t\te = e || event;\r\n\t\tif (e.ctrlKey || e.metaKey || e.which === 2) return;\r\n\t\tif (e.preventDefault) e.preventDefault();\r\n\t\telse e.returnValue = false;\r\n\t\tvar currentTarget = e.currentTarget || this;\r\n\t\tvar args = m.route.mode === \"pathname\" && currentTarget.search ? parseQueryString(currentTarget.search.slice(1)) : {};\r\n\t\tm.route(currentTarget[m.route.mode].slice(modes[m.route.mode].length), args)\r\n\t}\r\n\tfunction setScroll() {\r\n\t\tif (m.route.mode != \"hash\" && $location.hash) $location.hash = $location.hash;\r\n\t\telse window.scrollTo(0, 0)\r\n\t}\r\n\tfunction buildQueryString(object, prefix) {\r\n\t\tvar str = [];\r\n\t\tfor(var prop in object) {\r\n\t\t\tvar key = prefix ? prefix + \"[\" + prop + \"]\" : prop, value = object[prop];\r\n\t\t\tvar valueType = type.call(value)\r\n\t\t\tvar pair = value != null && (valueType === OBJECT) ?\r\n\t\t\t\tbuildQueryString(value, key) :\r\n\t\t\t\tvalueType === ARRAY ?\r\n\t\t\t\t\tvalue.map(function(item) {return encodeURIComponent(key + \"[]\") + \"=\" + encodeURIComponent(item)}).join(\"&\") :\r\n\t\t\t\t\tencodeURIComponent(key) + \"=\" + encodeURIComponent(value)\r\n\t\t\tstr.push(pair)\r\n\t\t}\r\n\t\treturn str.join(\"&\")\r\n\t}\r\n\t\r\n\tfunction parseQueryString(str) {\r\n\t\tvar pairs = str.split(\"&\"), params = {};\r\n\t\tfor (var i = 0, len = pairs.length; i < len; i++) {\r\n\t\t\tvar pair = pairs[i].split(\"=\");\r\n\t\t\tparams[decodeURIComponent(pair[0])] = pair[1] ? decodeURIComponent(pair[1]) : \"\"\r\n\t\t}\r\n\t\treturn params\r\n\t}\r\n\tfunction reset(root) {\r\n\t\tvar cacheKey = getCellCacheKey(root);\r\n\t\tclear(root.childNodes, cellCache[cacheKey]);\r\n\t\tcellCache[cacheKey] = undefined\r\n\t}\r\n\r\n\tm.deferred = function () {\r\n\t\tvar deferred = new Deferred();\r\n\t\tdeferred.promise = propify(deferred.promise);\r\n\t\treturn deferred\r\n\t};\r\n\tfunction propify(promise) {\r\n\t\tvar prop = m.prop();\r\n\t\tpromise.then(prop);\r\n\t\tprop.then = function(resolve, reject) {\r\n\t\t\treturn propify(promise.then(resolve, reject))\r\n\t\t};\r\n\t\treturn prop\r\n\t}\r\n\t//Promiz.mithril.js | Zolmeister | MIT\r\n\t//a modified version of Promiz.js, which does not conform to Promises/A+ for two reasons:\r\n\t//1) `then` callbacks are called synchronously (because setTimeout is too slow, and the setImmediate polyfill is too big\r\n\t//2) throwing subclasses of Error cause the error to be bubbled up instead of triggering rejection (because the spec does not account for the important use case of default browser error handling, i.e. message w/ line number)\r\n\tfunction Deferred(successCallback, failureCallback) {\r\n\t\tvar RESOLVING = 1, REJECTING = 2, RESOLVED = 3, REJECTED = 4;\r\n\t\tvar self = this, state = 0, promiseValue = 0, next = [];\r\n\r\n\t\tself[\"promise\"] = {};\r\n\r\n\t\tself[\"resolve\"] = function(value) {\r\n\t\t\tif (!state) {\r\n\t\t\t\tpromiseValue = value;\r\n\t\t\t\tstate = RESOLVING;\r\n\r\n\t\t\t\tfire()\r\n\t\t\t}\r\n\t\t\treturn this\r\n\t\t};\r\n\r\n\t\tself[\"reject\"] = function(value) {\r\n\t\t\tif (!state) {\r\n\t\t\t\tpromiseValue = value;\r\n\t\t\t\tstate = REJECTING;\r\n\r\n\t\t\t\tfire()\r\n\t\t\t}\r\n\t\t\treturn this\r\n\t\t};\r\n\r\n\t\tself.promise[\"then\"] = function(successCallback, failureCallback) {\r\n\t\t\tvar deferred = new Deferred(successCallback, failureCallback);\r\n\t\t\tif (state === RESOLVED) {\r\n\t\t\t\tdeferred.resolve(promiseValue)\r\n\t\t\t}\r\n\t\t\telse if (state === REJECTED) {\r\n\t\t\t\tdeferred.reject(promiseValue)\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnext.push(deferred)\r\n\t\t\t}\r\n\t\t\treturn deferred.promise\r\n\t\t};\r\n\r\n\t\tfunction finish(type) {\r\n\t\t\tstate = type || REJECTED;\r\n\t\t\tnext.map(function(deferred) {\r\n\t\t\t\tstate === RESOLVED && deferred.resolve(promiseValue) || deferred.reject(promiseValue)\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tfunction thennable(then, successCallback, failureCallback, notThennableCallback) {\r\n\t\t\tif (((promiseValue != null && type.call(promiseValue) === OBJECT) || typeof promiseValue === FUNCTION) && typeof then === FUNCTION) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// count protects against abuse calls from spec checker\r\n\t\t\t\t\tvar count = 0;\r\n\t\t\t\t\tthen.call(promiseValue, function(value) {\r\n\t\t\t\t\t\tif (count++) return;\r\n\t\t\t\t\t\tpromiseValue = value;\r\n\t\t\t\t\t\tsuccessCallback()\r\n\t\t\t\t\t}, function (value) {\r\n\t\t\t\t\t\tif (count++) return;\r\n\t\t\t\t\t\tpromiseValue = value;\r\n\t\t\t\t\t\tfailureCallback()\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\tm.deferred.onerror(e);\r\n\t\t\t\t\tpromiseValue = e;\r\n\t\t\t\t\tfailureCallback()\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tnotThennableCallback()\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction fire() {\r\n\t\t\t// check if it's a thenable\r\n\t\t\tvar then;\r\n\t\t\ttry {\r\n\t\t\t\tthen = promiseValue && promiseValue.then\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\tm.deferred.onerror(e);\r\n\t\t\t\tpromiseValue = e;\r\n\t\t\t\tstate = REJECTING;\r\n\t\t\t\treturn fire()\r\n\t\t\t}\r\n\t\t\tthennable(then, function() {\r\n\t\t\t\tstate = RESOLVING;\r\n\t\t\t\tfire()\r\n\t\t\t}, function() {\r\n\t\t\t\tstate = REJECTING;\r\n\t\t\t\tfire()\r\n\t\t\t}, function() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (state === RESOLVING && typeof successCallback === FUNCTION) {\r\n\t\t\t\t\t\tpromiseValue = successCallback(promiseValue)\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (state === REJECTING && typeof failureCallback === \"function\") {\r\n\t\t\t\t\t\tpromiseValue = failureCallback(promiseValue);\r\n\t\t\t\t\t\tstate = RESOLVING\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\tm.deferred.onerror(e);\r\n\t\t\t\t\tpromiseValue = e;\r\n\t\t\t\t\treturn finish()\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (promiseValue === self) {\r\n\t\t\t\t\tpromiseValue = TypeError();\r\n\t\t\t\t\tfinish()\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthennable(then, function () {\r\n\t\t\t\t\t\tfinish(RESOLVED)\r\n\t\t\t\t\t}, finish, function () {\r\n\t\t\t\t\t\tfinish(state === RESOLVING && RESOLVED)\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tm.deferred.onerror = function(e) {\r\n\t\tif (type.call(e) === \"[object Error]\" && !e.constructor.toString().match(/ Error/)) throw e\r\n\t};\r\n\r\n\tm.sync = function(args) {\r\n\t\tvar method = \"resolve\";\r\n\t\tfunction synchronizer(pos, resolved) {\r\n\t\t\treturn function(value) {\r\n\t\t\t\tresults[pos] = value;\r\n\t\t\t\tif (!resolved) method = \"reject\";\r\n\t\t\t\tif (--outstanding === 0) {\r\n\t\t\t\t\tdeferred.promise(results);\r\n\t\t\t\t\tdeferred[method](results)\r\n\t\t\t\t}\r\n\t\t\t\treturn value\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar deferred = m.deferred();\r\n\t\tvar outstanding = args.length;\r\n\t\tvar results = new Array(outstanding);\r\n\t\tif (args.length > 0) {\r\n\t\t\tfor (var i = 0; i < args.length; i++) {\r\n\t\t\t\targs[i].then(synchronizer(i, true), synchronizer(i, false))\r\n\t\t\t}\r\n\t\t}\r\n\t\telse deferred.resolve([]);\r\n\r\n\t\treturn deferred.promise\r\n\t};\r\n\tfunction identity(value) {return value}\r\n\r\n\tfunction ajax(options) {\r\n\t\tif (options.dataType && options.dataType.toLowerCase() === \"jsonp\") {\r\n\t\t\tvar callbackKey = \"mithril_callback_\" + new Date().getTime() + \"_\" + (Math.round(Math.random() * 1e16)).toString(36);\r\n\t\t\tvar script = $document.createElement(\"script\");\r\n\r\n\t\t\twindow[callbackKey] = function(resp) {\r\n\t\t\t\tscript.parentNode.removeChild(script);\r\n\t\t\t\toptions.onload({\r\n\t\t\t\t\ttype: \"load\",\r\n\t\t\t\t\ttarget: {\r\n\t\t\t\t\t\tresponseText: resp\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\twindow[callbackKey] = undefined\r\n\t\t\t};\r\n\r\n\t\t\tscript.onerror = function(e) {\r\n\t\t\t\tscript.parentNode.removeChild(script);\r\n\r\n\t\t\t\toptions.onerror({\r\n\t\t\t\t\ttype: \"error\",\r\n\t\t\t\t\ttarget: {\r\n\t\t\t\t\t\tstatus: 500,\r\n\t\t\t\t\t\tresponseText: JSON.stringify({error: \"Error making jsonp request\"})\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\twindow[callbackKey] = undefined;\r\n\r\n\t\t\t\treturn false\r\n\t\t\t};\r\n\r\n\t\t\tscript.onload = function(e) {\r\n\t\t\t\treturn false\r\n\t\t\t};\r\n\r\n\t\t\tscript.src = options.url\r\n\t\t\t\t+ (options.url.indexOf(\"?\") > 0 ? \"&\" : \"?\")\r\n\t\t\t\t+ (options.callbackKey ? options.callbackKey : \"callback\")\r\n\t\t\t\t+ \"=\" + callbackKey\r\n\t\t\t\t+ \"&\" + buildQueryString(options.data || {});\r\n\t\t\t$document.body.appendChild(script)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar xhr = new window.XMLHttpRequest;\r\n\t\t\txhr.open(options.method, options.url, true, options.user, options.password);\r\n\t\t\txhr.onreadystatechange = function() {\r\n\t\t\t\tif (xhr.readyState === 4) {\r\n\t\t\t\t\tif (xhr.status >= 200 && xhr.status < 300) options.onload({type: \"load\", target: xhr});\r\n\t\t\t\t\telse options.onerror({type: \"error\", target: xhr})\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tif (options.serialize === JSON.stringify && options.data && options.method !== \"GET\") {\r\n\t\t\t\txhr.setRequestHeader(\"Content-Type\", \"application/json; charset=utf-8\")\r\n\t\t\t}\r\n\t\t\tif (options.deserialize === JSON.parse) {\r\n\t\t\t\txhr.setRequestHeader(\"Accept\", \"application/json, text/*\");\r\n\t\t\t}\r\n\t\t\tif (typeof options.config === FUNCTION) {\r\n\t\t\t\tvar maybeXhr = options.config(xhr, options);\r\n\t\t\t\tif (maybeXhr != null) xhr = maybeXhr\r\n\t\t\t}\r\n\r\n\t\t\tvar data = options.method === \"GET\" || !options.data ? \"\" : options.data\r\n\t\t\tif (data && (type.call(data) != STRING && data.constructor != window.FormData)) {\r\n\t\t\t\tthrow \"Request data should be either be a string or FormData. Check the `serialize` option in `m.request`\";\r\n\t\t\t}\r\n\t\t\txhr.send(data);\r\n\t\t\treturn xhr\r\n\t\t}\r\n\t}\r\n\tfunction bindData(xhrOptions, data, serialize) {\r\n\t\tif (xhrOptions.method === \"GET\" && xhrOptions.dataType != \"jsonp\") {\r\n\t\t\tvar prefix = xhrOptions.url.indexOf(\"?\") < 0 ? \"?\" : \"&\";\r\n\t\t\tvar querystring = buildQueryString(data);\r\n\t\t\txhrOptions.url = xhrOptions.url + (querystring ? prefix + querystring : \"\")\r\n\t\t}\r\n\t\telse xhrOptions.data = serialize(data);\r\n\t\treturn xhrOptions\r\n\t}\r\n\tfunction parameterizeUrl(url, data) {\r\n\t\tvar tokens = url.match(/:[a-z]\\w+/gi);\r\n\t\tif (tokens && data) {\r\n\t\t\tfor (var i = 0; i < tokens.length; i++) {\r\n\t\t\t\tvar key = tokens[i].slice(1);\r\n\t\t\t\turl = url.replace(tokens[i], data[key]);\r\n\t\t\t\tdelete data[key]\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn url\r\n\t}\r\n\r\n\tm.request = function(xhrOptions) {\r\n\t\tif (xhrOptions.background !== true) m.startComputation();\r\n\t\tvar deferred = m.deferred();\r\n\t\tvar isJSONP = xhrOptions.dataType && xhrOptions.dataType.toLowerCase() === \"jsonp\";\r\n\t\tvar serialize = xhrOptions.serialize = isJSONP ? identity : xhrOptions.serialize || JSON.stringify;\r\n\t\tvar deserialize = xhrOptions.deserialize = isJSONP ? identity : xhrOptions.deserialize || JSON.parse;\r\n\t\tvar extract = xhrOptions.extract || function(xhr) {\r\n\t\t\treturn xhr.responseText.length === 0 && deserialize === JSON.parse ? null : xhr.responseText\r\n\t\t};\r\n\t\txhrOptions.url = parameterizeUrl(xhrOptions.url, xhrOptions.data);\r\n\t\txhrOptions = bindData(xhrOptions, xhrOptions.data, serialize);\r\n\t\txhrOptions.onload = xhrOptions.onerror = function(e) {\r\n\t\t\ttry {\r\n\t\t\t\te = e || event;\r\n\t\t\t\tvar unwrap = (e.type === \"load\" ? xhrOptions.unwrapSuccess : xhrOptions.unwrapError) || identity;\r\n\t\t\t\tvar response = unwrap(deserialize(extract(e.target, xhrOptions)));\r\n\t\t\t\tif (e.type === \"load\") {\r\n\t\t\t\t\tif (type.call(response) === ARRAY && xhrOptions.type) {\r\n\t\t\t\t\t\tfor (var i = 0; i < response.length; i++) response[i] = new xhrOptions.type(response[i])\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (xhrOptions.type) response = new xhrOptions.type(response)\r\n\t\t\t\t}\r\n\t\t\t\tdeferred[e.type === \"load\" ? \"resolve\" : \"reject\"](response)\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\tm.deferred.onerror(e);\r\n\t\t\t\tdeferred.reject(e)\r\n\t\t\t}\r\n\t\t\tif (xhrOptions.background !== true) m.endComputation()\r\n\t\t};\r\n\t\tajax(xhrOptions);\r\n\t\tdeferred.promise(xhrOptions.initialValue);\r\n\t\treturn deferred.promise\r\n\t};\r\n\r\n\t//testing API\r\n\tm.deps = function(mock) {\r\n\t\tinitialize(window = mock || window);\r\n\t\treturn window;\r\n\t};\r\n\t//for internal testing only, do not use `m.deps.factory`\r\n\tm.deps.factory = app;\r\n\r\n\treturn m\r\n})(typeof window != \"undefined\" ? window : {});\r\n\r\nif (typeof module != \"undefined\" && module !== null && module.exports) module.exports = m;\r\nelse if (typeof define === \"function\" && define.amd) define(function() {return m});\r\n","//\tMithril sugar tags.\n//\tCopyright (C) 2015 jsguy (Mikkel Bergmann)\n//\tMIT licensed\n(function(){\nvar mithrilSugartags = function(m, scope){\n\tm.sugarTags = m.sugarTags || {};\n\tscope = scope || m;\n\n\tvar arg = function(l1, l2){\n\t\t\tvar i;\n\t\t\tfor (i in l2) {if(l2.hasOwnProperty(i)) {\n\t\t\t\tl1.push(l2[i]);\n\t\t\t}}\n\t\t\treturn l1;\n\t\t}, \n\t\tgetClassList = function(args){\n\t\t\tvar i, result;\n\t\t\tfor(i in args) {\n\t\t\t\tif(args[i] && args[i].class) {\n\t\t\t\t\treturn typeof (args[i].class == \"string\")? \n\t\t\t\t\t\targs[i].class.split(\" \"):\n\t\t\t\t\t\tfalse;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmakeSugarTag = function(tag) {\n\t\t\tvar c, el;\n\t\t\treturn function() {\n\t\t\t\tvar args = Array.prototype.slice.call(arguments);\n\t\t\t\t//\tif class is string, allow use of cache\n\t\t\t\tif(c = getClassList(args)) {\n\t\t\t\t\tel = [tag + \".\" + c.join(\".\")];\n\t\t\t\t\t//\tRemove class tag, so we don't duplicate\n\t\t\t\t\tfor(var i in args) {\n\t\t\t\t\t\tif(args[i] && args[i].class) {\n\t\t\t\t\t\t\tdelete args[i].class;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tel = [tag];\n\t\t\t\t}\n\t\t\t\treturn (m.e? m.e: m).apply(this, arg(el, args));\n\t\t\t};\n\t\t},\n\t\ttagList = [\"A\",\"ABBR\",\"ACRONYM\",\"ADDRESS\",\"AREA\",\"ARTICLE\",\"ASIDE\",\"AUDIO\",\"B\",\"BDI\",\"BDO\",\"BIG\",\"BLOCKQUOTE\",\"BODY\",\"BR\",\"BUTTON\",\"CANVAS\",\"CAPTION\",\"CITE\",\"CODE\",\"COL\",\"COLGROUP\",\"COMMAND\",\"DATALIST\",\"DD\",\"DEL\",\"DETAILS\",\"DFN\",\"DIV\",\"DL\",\"DT\",\"EM\",\"EMBED\",\"FIELDSET\",\"FIGCAPTION\",\"FIGURE\",\"FOOTER\",\"FORM\",\"FRAME\",\"FRAMESET\",\"H1\",\"H2\",\"H3\",\"H4\",\"H5\",\"H6\",\"HEAD\",\"HEADER\",\"HGROUP\",\"HR\",\"HTML\",\"I\",\"IFRAME\",\"IMG\",\"INPUT\",\"INS\",\"KBD\",\"KEYGEN\",\"LABEL\",\"LEGEND\",\"LI\",\"LINK\",\"MAP\",\"MARK\",\"META\",\"METER\",\"NAV\",\"NOSCRIPT\",\"OBJECT\",\"OL\",\"OPTGROUP\",\"OPTION\",\"OUTPUT\",\"P\",\"PARAM\",\"PRE\",\"PROGRESS\",\"Q\",\"RP\",\"RT\",\"RUBY\",\"SAMP\",\"SCRIPT\",\"SECTION\",\"SELECT\",\"SMALL\",\"SOURCE\",\"SPAN\",\"SPLIT\",\"STRONG\",\"STYLE\",\"SUB\",\"SUMMARY\",\"SUP\",\"TABLE\",\"TBODY\",\"TD\",\"TEXTAREA\",\"TFOOT\",\"TH\",\"THEAD\",\"TIME\",\"TITLE\",\"TR\",\"TRACK\",\"TT\",\"UL\",\"VAR\",\"VIDEO\",\"WBR\"],\n\t\tlowerTagCache = {},\n\t\ti;\n\n\t//\tCreate sugar'd functions in the required scopes\n\tfor (i in tagList) {if(tagList.hasOwnProperty(i)) {\n\t\t(function(tag){\n\t\t\tvar lowerTag = tag.toLowerCase();\n\t\t\tscope[tag] = lowerTagCache[lowerTag] = makeSugarTag(lowerTag);\n\t\t}(tagList[i]));\n\t}}\n\n\t//\tLowercased sugar tags\n\tm.sugarTags.lower = function(){\n\t\treturn lowerTagCache;\n\t};\n\n\treturn scope;\n};\n\nif (typeof module != \"undefined\" && module !== null && module.exports) {\n\tmodule.exports = mithrilSugartags;\n} else if (typeof define === \"function\" && define.amd) {\n\tdefine(function() {\n\t\treturn mithrilSugartags;\n\t});\n} else {\n\tmithrilSugartags(\n\t\ttypeof window != \"undefined\"? window.m || {}: {},\n\t\ttypeof window != \"undefined\"? window: {}\n\t);\n}\n\n}());","//\tMithril bindings.\n//\tCopyright (C) 2014 jsguy (Mikkel Bergmann)\n//\tMIT licensed\n(function(){\nvar mithrilBindings = function(m){\n\tm.bindings = m.bindings || {};\n\n\t//\tPub/Sub based extended properties\n\tm.p = function(value) {\n\t\tvar self = this,\n\t\t\tsubs = [],\n\t\t\tprevValue,\n\t\t\tdelay = false,\n\t\t\t//  Send notifications to subscribers\n\t\t\tnotify = function (value, prevValue) {\n\t\t\t\tvar i;\n\t\t\t\tfor (i = 0; i < subs.length; i += 1) {\n\t\t\t\t\tsubs[i].func.apply(subs[i].context, [value, prevValue]);\n\t\t\t\t}\n\t\t\t},\n\t\t\tprop = function() {\n\t\t\t\tif (arguments.length) {\n\t\t\t\t\tvalue = arguments[0];\n\t\t\t\t\tif (prevValue !== value) {\n\t\t\t\t\t\tvar tmpPrev = prevValue;\n\t\t\t\t\t\tprevValue = value;\n\t\t\t\t\t\tnotify(value, tmpPrev);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t};\n\n\t\t//\tAllow push on arrays\n\t\tprop.push = function(val) {\n\t\t\tif(value.push && typeof value.length !== \"undefined\") {\n\t\t\t\tvalue.push(val);\n\t\t\t}\n\t\t\tprop(value);\n\t\t};\n\n\t\t//\tSubscribe for when the value changes\n\t\tprop.subscribe = function (func, context) {\n\t\t\tsubs.push({ func: func, context: context || self });\n\t\t\treturn prop;\n\t\t};\n\n\t\t//\tAllow property to not automatically render\n\t\tprop.delay = function(value) {\n\t\t\tdelay = !!value;\n\t\t\treturn prop;\n\t\t};\n\n\t\t//\tAutomatically update rendering when a value changes\n\t\t//\tAs mithril waits for a request animation frame, this should be ok.\n\t\t//\tYou can use .delay(true) to be able to manually handle updates\n\t\tprop.subscribe(function(val){\n\t\t\tif(!delay) {\n\t\t\t\tm.startComputation();\n\t\t\t\tm.endComputation();\n\t\t\t}\n\t\t\treturn prop;\n\t\t});\n\n\t\treturn prop;\n\t};\n\n\t//\tElement function that applies our extended bindings\n\t//\tNote: \n\t//\t\t. Some attributes can be removed when applied, eg: custom attributes\n\t//\t\n\tm.e = function(element, attrs, children) {\n\t\tfor (var name in attrs) {\n\t\t\tif (m.bindings[name]) {\n\t\t\t\tm.bindings[name].func.apply(attrs, [attrs[name]]);\n\t\t\t\tif(m.bindings[name].removeable) {\n\t\t\t\t\tdelete attrs[name];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn m(element, attrs, children);\n\t};\n\n\t//\tAdd bindings method\n\t//\tNon-standard attributes do not need to be rendered, eg: valueInput\n\t//\tso they are set as removable\n\tm.addBinding = function(name, func, removeable){\n\t\tm.bindings[name] = {\n\t\t\tfunc: func,\n\t\t\tremoveable: removeable\n\t\t};\n\t};\n\n\t//\tGet the underlying value of a property\n\tm.unwrap = function(prop) {\n\t\treturn (typeof prop == \"function\")? prop(): prop;\n\t};\n\n\t//\tBi-directional binding of value\n\tm.addBinding(\"value\", function(prop) {\n\t\tif (typeof prop == \"function\") {\n\t\t\tthis.value = prop();\n\t\t\tthis.onchange = m.withAttr(\"value\", prop);\n\t\t} else {\n\t\t\tthis.value = prop;\n\t\t}\n\t});\n\n\t//\tBi-directional binding of checked property\n\tm.addBinding(\"checked\", function(prop) {\n\t\tif (typeof prop == \"function\") {\n\t\t\tthis.checked = prop();\n\t\t\tthis.onchange = m.withAttr(\"checked\", prop);\n\t\t} else {\n\t\t\tthis.checked = prop;\n\t\t}\n\t});\n\n\t//\tHide node\n\tm.addBinding(\"hide\", function(prop){\n\t\tthis.style = {\n\t\t\tdisplay: m.unwrap(prop)? \"none\" : \"\"\n\t\t};\n\t}, true);\n\n\t//\tToggle value(s) on click\n\tm.addBinding('toggle', function(prop){\n\t\tthis.onclick = function(){\n\t\t\t//\tToggle allows an enum list to be toggled, eg: [prop, value2, value2]\n\t\t\tvar isFunc = typeof prop === 'function', tmp, i, vals = [], val, tVal;\n\n\t\t\t//\tToggle boolean\n\t\t\tif(isFunc) {\n\t\t\t\tvalue = prop();\n\t\t\t\tprop(!value);\n\t\t\t} else {\n\t\t\t\t//\tToggle enumeration\n\t\t\t\ttmp = prop[0];\n\t\t\t\tval = tmp();\n\t\t\t\tvals = prop.slice(1);\n\t\t\t\ttVal = vals[0];\n\n\t\t\t\tfor(i = 0; i < vals.length; i += 1) {\n\t\t\t\t\tif(val == vals[i]) {\n\t\t\t\t\t\tif(typeof vals[i+1] !== 'undefined') {\n\t\t\t\t\t\t\ttVal = vals[i+1];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttmp(tVal);\n\t\t\t}\n\t\t};\n\t}, true);\n\n\t//\tSet hover states, a'la jQuery pattern\n\tm.addBinding('hover', function(prop){\n\t\tthis.onmouseover = prop[0];\n\t\tif(prop[1]) {\n\t\t\tthis.onmouseout = prop[1];\n\t\t}\n\t}, true );\n\n\t//\tAdd value bindings for various event types \n\tvar events = [\"Input\", \"Keyup\", \"Keypress\"],\n\t\tcreateBinding = function(name, eve){\n\t\t\t//\tBi-directional binding of value\n\t\t\tm.addBinding(name, function(prop) {\n\t\t\t\tif (typeof prop == \"function\") {\n\t\t\t\t\tthis.value = prop();\n\t\t\t\t\tthis[eve] = m.withAttr(\"value\", prop);\n\t\t\t\t} else {\n\t\t\t\t\tthis.value = prop;\n\t\t\t\t}\n\t\t\t}, true);\n\t\t};\n\n\tfor(var i = 0; i < events.length; i += 1) {\n\t\tvar eve = events[i];\n\t\tcreateBinding(\"value\" + eve, \"on\" + eve.toLowerCase());\n\t}\n\n\n\t//\tSet a value on a property\n\tm.set = function(prop, value){\n\t\treturn function() {\n\t\t\tprop(value);\n\t\t};\n\t};\n\n\t/*\tReturns a function that can trigger a binding \n\t\tUsage: onclick: m.trigger('binding', prop)\n\t*/\n\tm.trigger = function(){\n\t\tvar args = Array.prototype.slice.call(arguments);\n\t\treturn function(){\n\t\t\tvar name = args[0],\n\t\t\t\targList = args.slice(1);\n\t\t\tif (m.bindings[name]) {\n\t\t\t\tm.bindings[name].func.apply(this, argList);\n\t\t\t}\n\t\t};\n\t};\n\n\treturn m.bindings;\n};\n\nif (typeof module != \"undefined\" && module !== null && module.exports) {\n\tmodule.exports = mithrilBindings;\n} else if (typeof define === \"function\" && define.amd) {\n\tdefine(function() {\n\t\treturn mithrilBindings;\n\t});\n} else {\n\tmithrilBindings(typeof window != \"undefined\"? window.m || {}: {});\n}\n\n}());","var validator = require('validator');\n\n/* \tThis binder allows you to create a validation method on a model, (plain \n\tjavascript function that defines some properties), that can return a set \n\tof error messages for invalid values.\n\t\n\tThe validations are from https://github.com/chriso/validator.js\t\n\n\t## Example\n\n\tSay you have an object like so:\n\n\t\tvar User = function(){\n\t\t\tthis.name = \"bob\";\n\t\t\tthis.email = \"bob_at_email.com\";\n\t\t}, user = new User();\n\n\tNow if you wanted to create an isValid function that can be used to ensure \n\tyou don't have an invalid email address, you simply add:\n\n\n\tTo your model, so you get:\n\n\t\tvar User = function(){\n\t\t\tthis.name = \"bob\";\n\t\t\tthis.email = \"bob_at_email.com\";\n\t\t\tthis.isValid = modelbinder.bind(this, {\n\t\t\t\temail: {\n\t\t\t\t\t'isEmail': \"Must be a valid email address\"\n\t\t\t\t}\n\t\t\t});\n\t\t}, user = new User();\n\n\tThen just call the `isValid` method to see if it is valid - if it is\n\tinvalid, (as it will be in this case), you will get an object like so:\n\n\t\tuser.isValid()\n\t\t//\tReturns: { email: [\"Must be a valid email address\"] }\n\n\tYou can also check if a particular field is valid like so:\n\n\t\tuser.isValid('email');\n\n */\nmodule.exports = {\n\tbind: function(self, vObj){\n\t\treturn function(name){\n\t\t\tvar result = {},\n\t\t\t\ttmp,\n\t\t\t\thasInvalidField = false,\n\t\t\t\t//\tFor some reason node-validator doesn't have this...\n\t\t\t\tisNotEmpty = function(value){\n\t\t\t\t\treturn typeof value !== \"undefined\" && value !== \"\" && value !== null;\n\t\t\t\t},\n\t\t\t\t//\tGet value of property from 'self', which can be a function.\n\t\t\t\tgetValue = function(name){\n\t\t\t\t\treturn typeof self[name] == \"function\"? self[name](): self[name];\n\t\t\t\t},\n\t\t\t\t//\tValidates a value against a set of validations\n\t\t\t\t//\tReturns true if the value is valid, or an object \n\t\t\t\tvalidate = function(name, value, validations) {\n\t\t\t\t\tvar validation,\n\t\t\t\t\t\ttmp,\n\t\t\t\t\t\tresult = [];\n\t\t\t\t\tfor(validation in validations) {\n\t\t\t\t\t\tif(validation == \"isRequired\") {\n\t\t\t\t\t\t\t//\tuse our \"isRequired\" function\n\t\t\t\t\t\t\ttmp = isNotEmpty(value)? true: validations[validation]; \n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t//\tUse validator method\n\t\t\t\t\t\t\ttmp = validator[validation](value)? true: validations[validation]; \n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//\tHandle multiple messages\n\t\t\t\t\t\tif(tmp !== true) {\n\t\t\t\t\t\t\tresult = (result === true || result == \"undefined\")? []: result;\n\t\t\t\t\t\t\tresult.push(tmp);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t\t};\n\n\t\t\tif(name) {\n\t\t\t\tresult = validate(name, getValue(name), vObj[name]);\n\t\t\t} else {\n\t\t\t\t//\tValidate the whole model\n\t\t\t\tfor(name in vObj) {\n\t\t\t\t\ttmp = validate(name, getValue(name), vObj[name]);\n\t\t\t\t\tif(tmp !== true) {\n\t\t\t\t\t\thasInvalidField = true;\n\t\t\t\t\t}\n\t\t\t\t\tresult[name] = tmp;\n\t\t\t\t}\n\t\t\t\tif(!hasInvalidField) {\n\t\t\t\t\tresult = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t}\n};","/*!\n * Copyright (c) 2014 Chris O'Hara <cohara87@gmail.com>\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * \"Software\"), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE\n * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n(function (name, definition) {\n    if (typeof exports !== 'undefined' && typeof module !== 'undefined') {\n        module.exports = definition();\n    } else if (typeof define === 'function' && typeof define.amd === 'object') {\n        define(definition);\n    } else {\n        this[name] = definition();\n    }\n})('validator', function (validator) {\n\n    'use strict';\n\n    validator = { version: '3.27.0' };\n\n    var email = /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))$/i;\n\n    var creditCard = /^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\\d{3})\\d{11})$/;\n\n    var isbn10Maybe = /^(?:[0-9]{9}X|[0-9]{10})$/\n      , isbn13Maybe = /^(?:[0-9]{13})$/;\n\n    var ipv4Maybe = /^(\\d?\\d?\\d)\\.(\\d?\\d?\\d)\\.(\\d?\\d?\\d)\\.(\\d?\\d?\\d)$/\n      , ipv6 = /^::|^::1|^([a-fA-F0-9]{1,4}::?){1,7}([a-fA-F0-9]{1,4})$/;\n\n    var uuid = {\n        '3': /^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i\n      , '4': /^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i\n      , '5': /^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i\n      , all: /^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i\n    };\n\n    var alpha = /^[a-zA-Z]+$/\n      , alphanumeric = /^[a-zA-Z0-9]+$/\n      , numeric = /^-?[0-9]+$/\n      , int = /^(?:-?(?:0|[1-9][0-9]*))$/\n      , float = /^(?:-?(?:[0-9]+))?(?:\\.[0-9]*)?(?:[eE][\\+\\-]?(?:[0-9]+))?$/\n      , hexadecimal = /^[0-9a-fA-F]+$/\n      , hexcolor = /^#?([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/;\n\n    var ascii = /^[\\x00-\\x7F]+$/\n      , multibyte = /[^\\x00-\\x7F]/\n      , fullWidth = /[^\\u0020-\\u007E\\uFF61-\\uFF9F\\uFFA0-\\uFFDC\\uFFE8-\\uFFEE0-9a-zA-Z]/\n      , halfWidth = /[\\u0020-\\u007E\\uFF61-\\uFF9F\\uFFA0-\\uFFDC\\uFFE8-\\uFFEE0-9a-zA-Z]/;\n\n    var surrogatePair = /[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/;\n\n    var base64 = /^(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+\\/]{3}=|[A-Za-z0-9+\\/]{4})$/;\n\n    var phones = {\n      'zh-CN': /^(\\+?0?86\\-?)?1[345789][0-9]{9}$/,\n      'en-ZA': /^(\\+?27|0)(\\d{9})$/,\n      'en-AU': /^(\\+?61|0)4(\\d{8})/\n    };\n\n    validator.extend = function (name, fn) {\n        validator[name] = function () {\n            var args = Array.prototype.slice.call(arguments);\n            args[0] = validator.toString(args[0]);\n            return fn.apply(validator, args);\n        };\n    };\n\n    //Right before exporting the validator object, pass each of the builtins\n    //through extend() so that their first argument is coerced to a string\n    validator.init = function () {\n        for (var name in validator) {\n            if (typeof validator[name] !== 'function' || name === 'toString' ||\n                    name === 'toDate' || name === 'extend' || name === 'init') {\n                continue;\n            }\n            validator.extend(name, validator[name]);\n        }\n    };\n\n    validator.toString = function (input) {\n        if (typeof input === 'object' && input !== null && input.toString) {\n            input = input.toString();\n        } else if (input === null || typeof input === 'undefined' || (isNaN(input) && !input.length)) {\n            input = '';\n        } else if (typeof input !== 'string') {\n            input += '';\n        }\n        return input;\n    };\n\n    validator.toDate = function (date) {\n        if (Object.prototype.toString.call(date) === '[object Date]') {\n            return date;\n        }\n        date = Date.parse(date);\n        return !isNaN(date) ? new Date(date) : null;\n    };\n\n    validator.toFloat = function (str) {\n        return parseFloat(str);\n    };\n\n    validator.toInt = function (str, radix) {\n        return parseInt(str, radix || 10);\n    };\n\n    validator.toBoolean = function (str, strict) {\n        if (strict) {\n            return str === '1' || str === 'true';\n        }\n        return str !== '0' && str !== 'false' && str !== '';\n    };\n\n    validator.equals = function (str, comparison) {\n        return str === validator.toString(comparison);\n    };\n\n    validator.contains = function (str, elem) {\n        return str.indexOf(validator.toString(elem)) >= 0;\n    };\n\n    validator.matches = function (str, pattern, modifiers) {\n        if (Object.prototype.toString.call(pattern) !== '[object RegExp]') {\n            pattern = new RegExp(pattern, modifiers);\n        }\n        return pattern.test(str);\n    };\n\n    validator.isEmail = function (str) {\n        return email.test(str);\n    };\n\n    var default_url_options = {\n        protocols: [ 'http', 'https', 'ftp' ]\n      , require_tld: true\n      , require_protocol: false\n      , allow_underscores: false\n      , allow_trailing_dot: false\n    };\n\n    validator.isURL = function (url, options) {\n        if (!url || url.length >= 2083) {\n            return false;\n        }\n        if (url.indexOf('mailto:') === 0) {\n            return false;\n        }\n        options = merge(options, default_url_options);\n        var protocol, user, pass, auth, host, hostname, port,\n            port_str, path, query, hash, split;\n        split = url.split('://');\n        if (split.length > 1) {\n            protocol = split.shift();\n            if (options.protocols.indexOf(protocol) === -1) {\n                return false;\n            }\n        } else if (options.require_protocol) {\n            return false;\n        }\n        url = split.join('://');\n        split = url.split('#');\n        url = split.shift();\n        hash = split.join('#');\n        if (hash && /\\s/.test(hash)) {\n            return false;\n        }\n        split = url.split('?');\n        url = split.shift();\n        query = split.join('?');\n        if (query && /\\s/.test(query)) {\n            return false;\n        }\n        split = url.split('/');\n        url = split.shift();\n        path = split.join('/');\n        if (path && /\\s/.test(path)) {\n            return false;\n        }\n        split = url.split('@');\n        if (split.length > 1) {\n            auth = split.shift();\n            if (auth.indexOf(':') >= 0) {\n                auth = auth.split(':');\n                user = auth.shift();\n                if (!/^\\S+$/.test(user)) {\n                    return false;\n                }\n                pass = auth.join(':');\n                if (!/^\\S*$/.test(user)) {\n                    return false;\n                }\n            }\n        }\n        hostname = split.join('@');\n        split = hostname.split(':');\n        host = split.shift();\n        if (split.length) {\n            port_str = split.join(':');\n            port = parseInt(port_str, 10);\n            if (!/^[0-9]+$/.test(port_str) || port <= 0 || port > 65535) {\n                return false;\n            }\n        }\n        if (!validator.isIP(host) && !validator.isFQDN(host, options) &&\n                host !== 'localhost') {\n            return false;\n        }\n        if (options.host_whitelist &&\n                options.host_whitelist.indexOf(host) === -1) {\n            return false;\n        }\n        if (options.host_blacklist &&\n                options.host_blacklist.indexOf(host) !== -1) {\n            return false;\n        }\n        return true;\n    };\n\n    validator.isIP = function (str, version) {\n        version = validator.toString(version);\n        if (!version) {\n            return validator.isIP(str, 4) || validator.isIP(str, 6);\n        } else if (version === '4') {\n            if (!ipv4Maybe.test(str)) {\n                return false;\n            }\n            var parts = str.split('.').sort(function (a, b) {\n                return a - b;\n            });\n            return parts[3] <= 255;\n        }\n        return version === '6' && ipv6.test(str);\n    };\n\n    var default_fqdn_options = {\n        require_tld: true\n      , allow_underscores: false\n      , allow_trailing_dot: false\n    };\n\n    validator.isFQDN = function (str, options) {\n        options = merge(options, default_fqdn_options);\n\n        /* Remove the optional trailing dot before checking validity */\n        if (options.allow_trailing_dot && str[str.length - 1] === '.') {\n            str = str.substring(0, str.length - 1);\n        }\n        var parts = str.split('.');\n        if (options.require_tld) {\n            var tld = parts.pop();\n            if (!parts.length || !/^[a-z]{2,}$/i.test(tld)) {\n                return false;\n            }\n        }\n        for (var part, i = 0; i < parts.length; i++) {\n            part = parts[i];\n            if (options.allow_underscores) {\n                if (part.indexOf('__') >= 0) {\n                    return false;\n                }\n                part = part.replace(/_/g, '');\n            }\n            if (!/^[a-z\\u00a1-\\uffff0-9-]+$/i.test(part)) {\n                return false;\n            }\n            if (part[0] === '-' || part[part.length - 1] === '-' ||\n                    part.indexOf('---') >= 0) {\n                return false;\n            }\n        }\n        return true;\n    };\n\n    validator.isAlpha = function (str) {\n        return alpha.test(str);\n    };\n\n    validator.isAlphanumeric = function (str) {\n        return alphanumeric.test(str);\n    };\n\n    validator.isNumeric = function (str) {\n        return numeric.test(str);\n    };\n\n    validator.isHexadecimal = function (str) {\n        return hexadecimal.test(str);\n    };\n\n    validator.isHexColor = function (str) {\n        return hexcolor.test(str);\n    };\n\n    validator.isLowercase = function (str) {\n        return str === str.toLowerCase();\n    };\n\n    validator.isUppercase = function (str) {\n        return str === str.toUpperCase();\n    };\n\n    validator.isInt = function (str) {\n        return int.test(str);\n    };\n\n    validator.isFloat = function (str) {\n        return str !== '' && float.test(str);\n    };\n\n    validator.isDivisibleBy = function (str, num) {\n        return validator.toFloat(str) % validator.toInt(num) === 0;\n    };\n\n    validator.isNull = function (str) {\n        return str.length === 0;\n    };\n\n    validator.isLength = function (str, min, max) {\n        var surrogatePairs = str.match(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g) || [];\n        var len = str.length - surrogatePairs.length;\n        return len >= min && (typeof max === 'undefined' || len <= max);\n    };\n\n    validator.isByteLength = function (str, min, max) {\n        return str.length >= min && (typeof max === 'undefined' || str.length <= max);\n    };\n\n    validator.isUUID = function (str, version) {\n        var pattern = uuid[version ? version : 'all'];\n        return pattern && pattern.test(str);\n    };\n\n    validator.isDate = function (str) {\n        return !isNaN(Date.parse(str));\n    };\n\n    validator.isAfter = function (str, date) {\n        var comparison = validator.toDate(date || new Date())\n          , original = validator.toDate(str);\n        return !!(original && comparison && original > comparison);\n    };\n\n    validator.isBefore = function (str, date) {\n        var comparison = validator.toDate(date || new Date())\n          , original = validator.toDate(str);\n        return original && comparison && original < comparison;\n    };\n\n    validator.isIn = function (str, options) {\n        var i;\n        if (Object.prototype.toString.call(options) === '[object Array]') {\n            var array = [];\n            for (i in options) {\n                array[i] = validator.toString(options[i]);\n            }\n            return array.indexOf(str) >= 0;\n        } else if (typeof options === 'object') {\n            return options.hasOwnProperty(str);\n        } else if (options && typeof options.indexOf === 'function') {\n            return options.indexOf(str) >= 0;\n        }\n        return false;\n    };\n\n    validator.isCreditCard = function (str) {\n        var sanitized = str.replace(/[^0-9]+/g, '');\n        if (!creditCard.test(sanitized)) {\n            return false;\n        }\n        var sum = 0, digit, tmpNum, shouldDouble;\n        for (var i = sanitized.length - 1; i >= 0; i--) {\n            digit = sanitized.substring(i, (i + 1));\n            tmpNum = parseInt(digit, 10);\n            if (shouldDouble) {\n                tmpNum *= 2;\n                if (tmpNum >= 10) {\n                    sum += ((tmpNum % 10) + 1);\n                } else {\n                    sum += tmpNum;\n                }\n            } else {\n                sum += tmpNum;\n            }\n            shouldDouble = !shouldDouble;\n        }\n        return !!((sum % 10) === 0 ? sanitized : false);\n    };\n\n    validator.isISBN = function (str, version) {\n        version = validator.toString(version);\n        if (!version) {\n            return validator.isISBN(str, 10) || validator.isISBN(str, 13);\n        }\n        var sanitized = str.replace(/[\\s-]+/g, '')\n          , checksum = 0, i;\n        if (version === '10') {\n            if (!isbn10Maybe.test(sanitized)) {\n                return false;\n            }\n            for (i = 0; i < 9; i++) {\n                checksum += (i + 1) * sanitized.charAt(i);\n            }\n            if (sanitized.charAt(9) === 'X') {\n                checksum += 10 * 10;\n            } else {\n                checksum += 10 * sanitized.charAt(9);\n            }\n            if ((checksum % 11) === 0) {\n                return !!sanitized;\n            }\n        } else  if (version === '13') {\n            if (!isbn13Maybe.test(sanitized)) {\n                return false;\n            }\n            var factor = [ 1, 3 ];\n            for (i = 0; i < 12; i++) {\n                checksum += factor[i % 2] * sanitized.charAt(i);\n            }\n            if (sanitized.charAt(12) - ((10 - (checksum % 10)) % 10) === 0) {\n                return !!sanitized;\n            }\n        }\n        return false;\n    };\n\n    validator.isMobilePhone = function(str, locale) {\n        if (locale in phones) {\n            return phones[locale].test(str);\n        }\n        return false;\n    };\n\n    validator.isJSON = function (str) {\n        try {\n            JSON.parse(str);\n        } catch (e) {\n            return false;\n        }\n        return true;\n    };\n\n    validator.isMultibyte = function (str) {\n        return multibyte.test(str);\n    };\n\n    validator.isAscii = function (str) {\n        return ascii.test(str);\n    };\n\n    validator.isFullWidth = function (str) {\n        return fullWidth.test(str);\n    };\n\n    validator.isHalfWidth = function (str) {\n        return halfWidth.test(str);\n    };\n\n    validator.isVariableWidth = function (str) {\n        return fullWidth.test(str) && halfWidth.test(str);\n    };\n\n    validator.isSurrogatePair = function (str) {\n        return surrogatePair.test(str);\n    };\n\n    validator.isBase64 = function (str) {\n        return base64.test(str);\n    };\n\n    validator.isMongoId = function (str) {\n        return validator.isHexadecimal(str) && str.length === 24;\n    };\n\n    validator.ltrim = function (str, chars) {\n        var pattern = chars ? new RegExp('^[' + chars + ']+', 'g') : /^\\s+/g;\n        return str.replace(pattern, '');\n    };\n\n    validator.rtrim = function (str, chars) {\n        var pattern = chars ? new RegExp('[' + chars + ']+$', 'g') : /\\s+$/g;\n        return str.replace(pattern, '');\n    };\n\n    validator.trim = function (str, chars) {\n        var pattern = chars ? new RegExp('^[' + chars + ']+|[' + chars + ']+$', 'g') : /^\\s+|\\s+$/g;\n        return str.replace(pattern, '');\n    };\n\n    validator.escape = function (str) {\n        return (str.replace(/&/g, '&amp;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&#x27;')\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/\\//g, '&#x2F;'));\n    };\n\n    validator.stripLow = function (str, keep_new_lines) {\n        var chars = keep_new_lines ? '\\x00-\\x09\\x0B\\x0C\\x0E-\\x1F\\x7F' : '\\x00-\\x1F\\x7F';\n        return validator.blacklist(str, chars);\n    };\n\n    validator.whitelist = function (str, chars) {\n        return str.replace(new RegExp('[^' + chars + ']+', 'g'), '');\n    };\n\n    validator.blacklist = function (str, chars) {\n        return str.replace(new RegExp('[' + chars + ']+', 'g'), '');\n    };\n\n    var default_normalize_email_options = {\n        lowercase: true\n    };\n\n    validator.normalizeEmail = function (email, options) {\n        options = merge(options, default_normalize_email_options);\n        if (!validator.isEmail(email)) {\n            return false;\n        }\n        var parts = email.split('@', 2);\n        parts[1] = parts[1].toLowerCase();\n        if (options.lowercase) {\n            parts[0] = parts[0].toLowerCase();\n        }\n        if (parts[1] === 'gmail.com' || parts[1] === 'googlemail.com') {\n            if (!options.lowercase) {\n                parts[0] = parts[0].toLowerCase();\n            }\n            parts[0] = parts[0].replace(/\\./g, '').split('+')[0];\n            parts[1] = 'gmail.com';\n        }\n        return parts.join('@');\n    };\n\n    function merge(obj, defaults) {\n        obj = obj || {};\n        for (var key in defaults) {\n            if (typeof obj[key] === 'undefined') {\n                obj[key] = defaults[key];\n            }\n        }\n        return obj;\n    }\n\n    validator.init();\n\n    return validator;\n\n});\n"]}